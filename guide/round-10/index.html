<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Round 10 - Final Project: Integrated HFT System</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=Space+Mono:wght@400&family=Inter:wght@300;400&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#fafaf8;color:#1a1a1a;line-height:1.7;overflow-x:hidden}
.sidebar{position:fixed;left:0;top:0;width:260px;height:100vh;background:rgba(255,255,255,.97);border-right:1px solid rgba(0,0,0,.06);padding:32px 24px;z-index:100;overflow-y:auto;display:flex;flex-direction:column}
.sidebar-profile{text-align:center;margin-bottom:28px;padding-bottom:24px;border-bottom:1px solid rgba(0,0,0,.08)}
.profile-icon{font-size:48px;margin-bottom:8px}
.profile-name{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:500;margin-bottom:4px}
.profile-title{font-size:.68rem;color:#888;letter-spacing:.08em;text-transform:uppercase;margin-bottom:8px}
.profile-bio{font-size:.78rem;color:#666;line-height:1.5}
.sidebar-nav{flex:1;margin-top:16px}
.nav-section{margin-bottom:20px}
.nav-section-title{font-size:.6rem;font-weight:600;color:#aaa;letter-spacing:.15em;text-transform:uppercase;margin-bottom:10px}
.nav-list{list-style:none}
.nav-list li{margin-bottom:5px}
.nav-list a{font-size:.78rem;color:#555;text-decoration:none;transition:all .2s;display:block;padding:3px 0}
.nav-list a:hover{color:#0080c6;padding-left:4px}
.nav-list a.active{color:#0080c6;font-weight:500}
.nav-list a.done{color:#28a745}
.badge{display:inline-block;font-size:.5rem;background:#0080c6;color:#fff;padding:1px 5px;border-radius:8px;margin-left:3px;vertical-align:middle}
.badge-done{background:#28a745}
.sidebar-footer{padding-top:16px;border-top:1px solid rgba(0,0,0,.06);font-size:.65rem;color:#aaa;text-align:center}
.main-wrapper{margin-left:260px;min-height:100vh}
.container{max-width:1100px;margin:0 auto;padding:50px 40px 80px}
.paper-content{font-family:'Times New Roman','Nanum Myeongjo',serif;line-height:1.8;background:#fff;padding:40px;border-radius:8px;box-shadow:0 2px 20px rgba(0,0,0,.05)}
.paper-header{text-align:center;margin-bottom:40px;padding-bottom:30px;border-bottom:2px solid #333}
.paper-category{font-size:14px;color:#666;margin-bottom:10px}
.paper-title{font-size:24px;font-weight:bold;margin-bottom:12px;line-height:1.4}
.paper-subtitle{font-size:14px;color:#555;margin-bottom:8px}
.paper-team{font-size:13px;color:#444}
.code-output{background:#1e1e1e;color:#d4d4d4;padding:12px 16px;border-radius:0 0 6px 6px;font-family:'Space Mono',monospace;font-size:11.5px;line-height:1.6;margin-top:-4px;margin-bottom:18px;border-top:2px solid #333;white-space:pre-wrap;overflow-x:auto}
.code-output .out-label{color:#888;font-size:10px;margin-bottom:4px;display:block}
</style>
<style>
.abstract{background:#f8f9fa;padding:25px;margin:30px 0;border-left:4px solid #2c3e50}
.abstract-title{font-weight:bold;font-size:16px;margin-bottom:15px}
h2{font-size:18px;margin:35px 0 20px;padding-bottom:8px;border-bottom:1px solid #ddd;color:#2c3e50}
h3{font-size:15px;margin:25px 0 15px;color:#34495e}
h4{font-size:14px;margin:20px 0 12px;color:#34495e}
p{text-align:justify;margin-bottom:15px;text-indent:2em}
p.ni{text-indent:0}
table{width:100%;border-collapse:collapse;margin:20px 0;font-size:12px}
th,td{border:1px solid #ddd;padding:10px 8px;text-align:center}
th{background:#2c3e50;color:white;font-weight:bold}
tr:nth-child(even){background:#f8f9fa}
tr:hover{background:#e8f4f8}
.tc{font-size:13px;font-weight:bold;margin:15px 0 10px;text-align:center}
.eq{text-align:center;margin:20px 0;padding:15px;background:#f8f9fa;border-radius:4px;overflow-x:auto}
ul,ol{margin-left:2em;margin-bottom:15px}
li{margin-bottom:6px}
.def{background:#fff9e6;border:1px solid #ffc107;border-radius:4px;padding:20px;margin:20px 0}
.info{background:#e8f4f8;border-left:4px solid #3498db;padding:20px;margin:20px 0}
.warn{background:#fff3cd;border-left:4px solid #f39c12;padding:20px;margin:20px 0}
.ok{background:#d4edda;border-left:4px solid #28a745;padding:20px;margin:20px 0}
pre{background:#1e1e1e;color:#d4d4d4;padding:20px;border-radius:6px;overflow-x:auto;margin:20px 0;font-family:'Space Mono','Consolas',monospace;font-size:13px;line-height:1.6}
code{font-family:'Space Mono','Consolas',monospace;font-size:13px}
p code,li code,td code{background:#f0f0f0;padding:2px 6px;border-radius:3px;color:#c7254e;font-size:12px}
.cc{font-size:12px;font-weight:bold;color:#2c3e50;margin-top:15px;margin-bottom:4px}
.cm{color:#6a9955}.kw{color:#569cd6}.st{color:#ce9178}.fn{color:#dcdcaa}.nb{color:#4ec9b0}.nu{color:#b5cea8}
.progress-bar{width:100%;height:6px;background:#e0e0e0;border-radius:3px;margin-top:16px}
.progress-fill{height:100%;background:linear-gradient(90deg,#f39c12,#e74c3c);border-radius:3px;width:100%}
.progress-label{font-size:11px;color:#888;margin-top:4px;text-align:center}
@media(max-width:1024px){
.sidebar{width:100%;height:auto;position:relative;border-right:none;border-bottom:1px solid rgba(0,0,0,.08);padding:16px}
.sidebar-profile{margin-bottom:10px;padding-bottom:10px;display:flex;align-items:center;gap:12px;text-align:left}
.profile-icon{font-size:32px;margin-bottom:0}.profile-bio{display:none}
.nav-section{display:inline-block;margin-right:16px;margin-bottom:8px}
.nav-list{display:flex;gap:10px;flex-wrap:wrap}.nav-list li{margin-bottom:0}
.sidebar-footer{display:none}
.main-wrapper{margin-left:0}
.container{padding:0}.paper-content{padding:20px 16px;border-radius:0;box-shadow:none}
.paper-title{font-size:18px}p{font-size:14px;text-indent:1.5em;text-align:left}
pre{font-size:11px;padding:14px}table{font-size:10px;display:block;overflow-x:auto}
}
</style>
</head>
<body>

<div class="sidebar">
<div class="sidebar-profile">
<div class="profile-icon">&#x1F3C6;</div>
<div class="profile-name">HFT ML Master Plan</div>
<div class="profile-title">Final Project</div>
<div class="profile-bio">10 Rounds: Zero to HFT System Trading</div>
</div>
<div class="sidebar-nav">
<div class="nav-section">
<div class="nav-section-title">Curriculum</div>
<ul class="nav-list">
<li><a class="done" href="../round-01/">R1. Python + Finance <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-02/">R2. Linear Algebra + Stats <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-03/">R3. Data / Feature Eng. <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-04/">R4. Supervised Learning <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-05/">R5. Unsupervised + TS <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-06/">R6. NLP + Sentiment <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-07/">R7. Deep Learning <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-08/">R8. Convex Opt + Transformer <span class="badge badge-done">DONE</span></a></li>
<li><a class="done" href="../round-09/">R9. HFT + RL <span class="badge badge-done">DONE</span></a></li>
<li><a class="active" href="#">R10. Final Project <span class="badge">FINAL</span></a></li>
</ul>
</div>
<div class="nav-section">
<div class="nav-section-title">This Lecture</div>
<ul class="nav-list">
<li><a href="#ch1">1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œê´€</a></li>
<li><a href="#ch2">2. ë°ì´í„° íŒŒì´í”„ë¼ì¸</a></li>
<li><a href="#ch3">3. í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ì—”ì§„</a></li>
<li><a href="#ch4">4. ì˜ˆì¸¡ ì—”ì§„ (Transformer+XGB)</a></li>
<li><a href="#ch5">5. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì—”ì§„</a></li>
<li><a href="#ch6">6. RL ì‹¤í–‰ ì—”ì§„</a></li>
<li><a href="#ch7">7. ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆ</a></li>
<li><a href="#ch8">8. ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„</a></li>
<li><a href="#ch9">9. ì„±ê³¼ í‰ê°€ + ë¦¬í¬íŠ¸</a></li>
<li><a href="#ch10">10. ì „ì²´ í†µí•© íŒŒì´í”„ë¼ì¸</a></li>
</ul>
</div>
</div>
<div class="sidebar-footer">Round 10 of 10 Â· ğŸ† FINAL</div>
</div>

<div class="main-wrapper">
<div class="container">
<div class="paper-content">

<div class="paper-header">
<div class="paper-category">Round 10 / 10 Â· ìµœì¢… í†µí•© í”„ë¡œì íŠ¸</div>
<h1 class="paper-title">Integrated HFT System:<br>From Data to Execution</h1>
<div class="paper-subtitle">R1~R9ì˜ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©í•œë‹¤</div>
<div class="paper-team">Textbooks: MLAT Ch.5,8 / MLDSF ì „ì²´ í†µí•©</div>
<div class="progress-bar"><div class="progress-fill"></div></div>
<div class="progress-label">Overall Progress: 100% â€” FINAL ROUND ğŸ†</div>
</div>

<div class="abstract">
<div class="abstract-title">Abstract</div>
<p class="ni">
R1ì—ì„œ <code>print("Hello, Finance")</code>ë¥¼ ì¹˜ë˜ ìš°ë¦¬ê°€ ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤. íŒŒì´ì¬ ê¸°ì´ˆ(R1), ì„ í˜•ëŒ€ìˆ˜ì™€ í†µê³„(R2), ë°ì´í„°/í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§(R3), ì§€ë„í•™ìŠµ(R4), ë¹„ì§€ë„í•™ìŠµê³¼ ì‹œê³„ì—´(R5), NLPì™€ ê°ì„±ë¶„ì„(R6), ë”¥ëŸ¬ë‹(R7), ë³¼ë¡ ìµœì í™”ì™€ Transformer(R8), HFT ë§ˆì´í¬ë¡œìŠ¤íŠ¸ëŸ­ì²˜ì™€ ê°•í™”í•™ìŠµ(R9) â€” 9ê°œ ë¼ìš´ë“œì— ê±¸ì³ ìŒ“ì•„ì˜¨ ëª¨ë“  ë¬´ê¸°ë¥¼ ì´ì œ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©í•œë‹¤.
</p>
<p class="ni" style="margin-top:10px">
ì´ ìµœì¢… ë¼ìš´ë“œì—ì„œëŠ” <strong>ë°ì´í„° ìˆ˜ì§‘ â†’ í”¼ì²˜ ìƒì„± â†’ ëª¨ë¸ ì˜ˆì¸¡ â†’ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” â†’ ì£¼ë¬¸ ì‹¤í–‰ â†’ ë¦¬ìŠ¤í¬ ê´€ë¦¬ â†’ ë°±í…ŒìŠ¤íŠ¸ â†’ ì„±ê³¼ í‰ê°€</strong>ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•œë‹¤. ê° ëª¨ë“ˆì€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ë©´ì„œë„ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ëœë‹¤. ì´ê²ƒì´ ì‹¤ì „ í€€íŠ¸ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ë‹¤.
</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 1: ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œê´€ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch1">Chapter 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œê´€ â€” ì „ì²´ íŒŒì´í”„ë¼ì¸ ì„¤ê³„</h2>

<p>
HFT ì‹œìŠ¤í…œì€ ë‹¨ì¼ ëª¨ë¸ì´ ì•„ë‹ˆë‹¤. ë°ì´í„° ìˆ˜ì§‘ë¶€í„° ì£¼ë¬¸ ì‹¤í–‰ê¹Œì§€ ì—¬ëŸ¬ ëª¨ë“ˆì´ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì—°ê²°ëœ <strong>ë³µí•© ì‹œìŠ¤í…œ</strong>ì´ë‹¤. ì´ ì¥ì—ì„œëŠ” R1~R9ì—ì„œ ë°°ìš´ ëª¨ë“  êµ¬ì„± ìš”ì†Œë¥¼ í•˜ë‚˜ì˜ ì•„í‚¤í…ì²˜ë¡œ ì¡°ë¦½í•˜ëŠ” ì²­ì‚¬ì§„ì„ ê·¸ë¦°ë‹¤.
</p>

<h3>1.1 ì „ì²´ íŒŒì´í”„ë¼ì¸ êµ¬ì¡°</h3>

<p>
ìš°ë¦¬ê°€ êµ¬ì¶•í•  ì‹œìŠ¤í…œì€ 8ê°œì˜ í•µì‹¬ ëª¨ë“ˆë¡œ êµ¬ì„±ëœë‹¤. ê° ëª¨ë“ˆì€ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œÂ·í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìœ¼ë©´ì„œë„, ë°ì´í„° íë¦„ì„ í†µí•´ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ëœë‹¤.
</p>

<div class="def">
<strong>ğŸ“ ì‹œìŠ¤í…œ íŒŒì´í”„ë¼ì¸ (8-Module Architecture)</strong><br><br>
â‘  <strong>Data Pipeline</strong> (Ch.2) â€” ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ + ì •ì œ<br>
â‘¡ <strong>Feature Engine</strong> (Ch.3) â€” ê¸°ìˆ ì  ì§€í‘œ + NLP ê°ì„± í”¼ì²˜ ìƒì„±<br>
â‘¢ <strong>Prediction Engine</strong> (Ch.4) â€” Transformer + XGBoost ì•™ìƒë¸” ì˜ˆì¸¡<br>
â‘£ <strong>Portfolio Optimizer</strong> (Ch.5) â€” CVXPY ê¸°ë°˜ ìµœì  ë°°ë¶„<br>
â‘¤ <strong>RL Execution Engine</strong> (Ch.6) â€” PPO ì—ì´ì „íŠ¸ ì£¼ë¬¸ ì‹¤í–‰<br>
â‘¥ <strong>Risk Manager</strong> (Ch.7) â€” VaR, CVaR, ë“œë¡œë‹¤ìš´ ì œí•œ<br>
â‘¦ <strong>Backtest Engine</strong> (Ch.8) â€” Walk-Forward ê²€ì¦<br>
â‘§ <strong>Performance Reporter</strong> (Ch.9) â€” ì¢…í•© ì„±ê³¼ í‰ê°€
</div>

<h3>1.2 ëª¨ë“ˆ ê°„ ë°ì´í„° íë¦„</h3>

<p>
ê° ëª¨ë“ˆì˜ ì…ì¶œë ¥ì„ ëª…í™•íˆ ì •ì˜í•˜ëŠ” ê²ƒì´ ì‹œìŠ¤í…œ ì„¤ê³„ì˜ í•µì‹¬ì´ë‹¤. ëª¨ë“ˆ ê°„ ì¸í„°í˜ì´ìŠ¤ê°€ ê¹”ë”í•´ì•¼ ë…ë¦½ì  ê°œë°œê³¼ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.
</p>

<table>
<tr><th>ëª¨ë“ˆ</th><th>ì…ë ¥ (Input)</th><th>ì¶œë ¥ (Output)</th><th>ê´€ë ¨ Round</th></tr>
<tr><td>Data Pipeline</td><td>API í˜¸ì¶œ, CSV</td><td>ì •ì œëœ OHLCV DataFrame</td><td>R1, R3</td></tr>
<tr><td>Feature Engine</td><td>OHLCV DataFrame</td><td>í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤ X</td><td>R3, R6</td></tr>
<tr><td>Prediction Engine</td><td>í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤ X</td><td>ìˆ˜ìµë¥  ì˜ˆì¸¡ Å·</td><td>R4, R7, R8</td></tr>
<tr><td>Portfolio Optimizer</td><td>ì˜ˆì¸¡ Å·, ê³µë¶„ì‚° Î£</td><td>ëª©í‘œ ë¹„ì¤‘ w*</td><td>R2, R5, R8</td></tr>
<tr><td>RL Execution</td><td>ëª©í‘œ ë¹„ì¤‘ w*, ì˜¤ë”ë¶</td><td>ì‹¤í–‰ëœ ì£¼ë¬¸</td><td>R9</td></tr>
<tr><td>Risk Manager</td><td>í¬ì§€ì…˜, ì‹œì¥ ë°ì´í„°</td><td>ìŠ¹ì¸/ê±°ë¶€ ì‹ í˜¸</td><td>R2, R5</td></tr>
<tr><td>Backtest Engine</td><td>ì „ëµ ë¡œì§, ê³¼ê±° ë°ì´í„°</td><td>ì„±ê³¼ ì‹œê³„ì—´</td><td>R1~R9</td></tr>
<tr><td>Performance Reporter</td><td>ì„±ê³¼ ì‹œê³„ì—´</td><td>ì§€í‘œ + ë¦¬í¬íŠ¸</td><td>R1, R2</td></tr>
</table>

<h3>1.3 ì„¤ê³„ ì›ì¹™</h3>

<div class="info">
<strong>ğŸ’¡ í•µì‹¬ ì„¤ê³„ ì›ì¹™ 4ê°€ì§€</strong><br><br>
<strong>1. ëª¨ë“ˆì„± (Modularity):</strong> ê° ëª¨ë“ˆì€ ë…ë¦½ì ìœ¼ë¡œ êµì²´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤. XGBoostë¥¼ LightGBMìœ¼ë¡œ ë°”ê¿”ë„ ë‚˜ë¨¸ì§€ íŒŒì´í”„ë¼ì¸ì€ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤.<br><br>
<strong>2. ì¬í˜„ì„± (Reproducibility):</strong> ë™ì¼í•œ ì…ë ¥ì— ëŒ€í•´ ë™ì¼í•œ ì¶œë ¥ì„ ë³´ì¥í•œë‹¤. ëœë¤ ì‹œë“œ ê³ ì •, ë°ì´í„° ë²„ì „ ê´€ë¦¬ê°€ í•„ìˆ˜ë‹¤.<br><br>
<strong>3. í™•ì¥ì„± (Scalability):</strong> ì¢…ëª© ìˆ˜ê°€ 10ê°œì—ì„œ 1000ê°œë¡œ ëŠ˜ì–´ë‚˜ë„ êµ¬ì¡°ê°€ ê¹¨ì§€ì§€ ì•Šì•„ì•¼ í•œë‹¤.<br><br>
<strong>4. ì‹¤ì‹œê°„ì„± (Low Latency):</strong> R9ì—ì„œ ë°°ìš´ ê²ƒì²˜ëŸ¼, HFTì—ì„œëŠ” ë§ˆì´í¬ë¡œì´ˆ ë‹¨ìœ„ì˜ ì§€ì—°ì´ ìˆ˜ìµì„ ê²°ì •í•œë‹¤.
</div>

<h3>1.4 í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°</h3>

<p>
ì‹¤ì „ í”„ë¡œì íŠ¸ëŠ” ì½”ë“œ êµ¬ì¡°ë¶€í„° ê¹”ë”í•´ì•¼ í•œë‹¤. ì•„ë˜ëŠ” ìš°ë¦¬ê°€ ì´ ë¼ìš´ë“œì—ì„œ êµ¬ì¶•í•  ì‹œìŠ¤í…œì˜ ë””ë ‰í† ë¦¬ ë ˆì´ì•„ì›ƒì´ë‹¤.
</p>

<div class="cc">Python â€” í”„ë¡œì íŠ¸ êµ¬ì¡°</div>
<pre>
<span class="cm"># í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°</span>
hft_system/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.yaml          <span class="cm"># ì „ëµ íŒŒë¼ë¯¸í„°, API í‚¤ ë“±</span>
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                   <span class="cm"># ì›ë³¸ ë°ì´í„°</span>
â”‚   â”œâ”€â”€ processed/             <span class="cm"># ì •ì œëœ ë°ì´í„°</span>
â”‚   â””â”€â”€ features/              <span class="cm"># í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤</span>
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ prediction/            <span class="cm"># Transformer, XGBoost ëª¨ë¸</span>
â”‚   â”œâ”€â”€ optimization/          <span class="cm"># í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”</span>
â”‚   â””â”€â”€ rl_agent/              <span class="cm"># PPO ì—ì´ì „íŠ¸</span>
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ data_pipeline.py       <span class="cm"># Ch.2 â€” ë°ì´í„° ìˆ˜ì§‘/ì •ì œ</span>
â”‚   â”œâ”€â”€ feature_engine.py      <span class="cm"># Ch.3 â€” í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§</span>
â”‚   â”œâ”€â”€ prediction_engine.py   <span class="cm"># Ch.4 â€” ì˜ˆì¸¡ ëª¨ë¸</span>
â”‚   â”œâ”€â”€ portfolio_optimizer.py <span class="cm"># Ch.5 â€” í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”</span>
â”‚   â”œâ”€â”€ rl_executor.py         <span class="cm"># Ch.6 â€” RL ì‹¤í–‰ ì—”ì§„</span>
â”‚   â”œâ”€â”€ risk_manager.py        <span class="cm"># Ch.7 â€” ë¦¬ìŠ¤í¬ ê´€ë¦¬</span>
â”‚   â”œâ”€â”€ backtest_engine.py     <span class="cm"># Ch.8 â€” ë°±í…ŒìŠ¤íŠ¸</span>
â”‚   â””â”€â”€ performance_report.py  <span class="cm"># Ch.9 â€” ì„±ê³¼ í‰ê°€</span>
â”œâ”€â”€ main.py                    <span class="cm"># Ch.10 â€” ì „ì²´ í†µí•© íŒŒì´í”„ë¼ì¸</span>
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</pre>

<h3>1.5 í•µì‹¬ ì˜ì¡´ì„±</h3>

<div class="cc">Python â€” requirements.txt</div>
<pre>
<span class="cm"># ë°ì´í„° & ê¸°ë³¸</span>
numpy>=1.24
pandas>=2.0
yfinance>=0.2.31

<span class="cm"># ë¨¸ì‹ ëŸ¬ë‹</span>
scikit-learn>=1.3
xgboost>=2.0

<span class="cm"># ë”¥ëŸ¬ë‹</span>
torch>=2.0

<span class="cm"># ìµœì í™”</span>
cvxpy>=1.4

<span class="cm"># NLP</span>
transformers>=4.35

<span class="cm"># ì‹œê°í™”</span>
matplotlib>=3.7
plotly>=5.18

<span class="cm"># ê°•í™”í•™ìŠµ</span>
gymnasium>=0.29
stable-baselines3>=2.2
</pre>

<h3>1.6 ì´ë²¤íŠ¸ ë“œë¦¬ë¸ vs ë°°ì¹˜ ì²˜ë¦¬</h3>

<div class="info">
<strong>ğŸ’¡ ë‘ ê°€ì§€ ì‹¤í–‰ íŒ¨ëŸ¬ë‹¤ì„</strong><br><br>
<strong>ë°°ì¹˜ ì²˜ë¦¬ (Batch):</strong> ë§¤ì¼ ì¥ ë§ˆê° í›„ ë°ì´í„°ë¥¼ ëª¨ì•„ì„œ í•œ ë²ˆì— ì²˜ë¦¬í•œë‹¤. ì¼ê°„ ë¦¬ë°¸ëŸ°ì‹± ì „ëµì— ì í•©í•˜ë‹¤. ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ëª¨ë“œë‹¤.<br><br>
<strong>ì´ë²¤íŠ¸ ë“œë¦¬ë¸ (Event-Driven):</strong> ìƒˆë¡œìš´ ë°ì´í„°(í‹±, ë‰´ìŠ¤, ì˜¤ë”ë¶ ë³€í™”)ê°€ ë„ì°©í•  ë•Œë§ˆë‹¤ ì¦‰ì‹œ ë°˜ì‘í•œë‹¤. R9ì—ì„œ ë‹¤ë£¬ HFT ë§ˆì¼“ë©”ì´í‚¹ì´ ì´ ë°©ì‹ì´ë‹¤. ì§€ì—° ì‹œê°„ì´ í•µì‹¬ì´ë‹¤.<br><br>
ì‹¤ì „ì—ì„œëŠ” ë‘ ë°©ì‹ì„ í˜¼í•©í•œë‹¤. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”ëŠ” ë°°ì¹˜ë¡œ, ì£¼ë¬¸ ì‹¤í–‰ì€ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.
</div>

<h3>1.7 ëª¨ë“ˆ ê°„ ì˜ì¡´ì„± ê·¸ë˜í”„ì˜ ìˆ˜í•™ì  í‘œí˜„</h3>

<p>
ì‹œìŠ¤í…œì„ ë°©í–¥ ë¹„ìˆœí™˜ ê·¸ë˜í”„(DAG)ë¡œ ëª¨ë¸ë§í•˜ë©´, ê° ëª¨ë“ˆ \(M_i\)ì˜ ì¶œë ¥ì´ ë‹¤ìŒ ëª¨ë“ˆì˜ ì…ë ¥ì´ ë˜ëŠ” êµ¬ì¡°ë¥¼ í˜•ì‹ì ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤:
</p>

<div class="eq">
\[
\text{output}(M_i) = f_i\!\left(\text{output}(M_{j}) \mid j \in \text{parents}(i)\right)
\]
</div>

<p>
ì´ DAG êµ¬ì¡° ë•ë¶„ì— ìœ„ìƒ ì •ë ¬(topological sort)ë¡œ ì‹¤í–‰ ìˆœì„œë¥¼ ìë™ ê²°ì •í•  ìˆ˜ ìˆê³ , ë…ë¦½ì ì¸ ëª¨ë“ˆì€ ë³‘ë ¬ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Feature Engineê³¼ Sentiment Engineì€ ì„œë¡œ ë…ë¦½ì´ë¯€ë¡œ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
</p>

<p class="ni">
ì´ì œ ê° ëª¨ë“ˆì„ í•˜ë‚˜ì”© êµ¬ì¶•í•´ ë‚˜ê°€ì. ë¨¼ì € ëª¨ë“  ê²ƒì˜ ì‹œì‘ì ì¸ ë°ì´í„° íŒŒì´í”„ë¼ì¸ë¶€í„°.
</p>

<!-- Plotly: ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ íë¦„ë„ (Sankey Diagram) -->
<div class="tc">Figure 1.1 â€” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë°ì´í„° íë¦„ (Sankey Diagram)</div>
<div id="plot-ch1-sankey" style="width:100%;height:500px;"></div>
<script>
(function(){
  Plotly.newPlot('plot-ch1-sankey',[{
    type:'sankey',
    orientation:'h',
    node:{
      pad:20, thickness:25, line:{color:'#333',width:1},
      label:['Raw Data','Data Pipeline','Feature Engine','Prediction Engine',
             'Portfolio Optimizer','RL Executor','Risk Manager','Backtest Engine',
             'Performance Report','Trading Signal'],
      color:['#95a5a6','#3498db','#2ecc71','#e74c3c','#9b59b6',
             '#f39c12','#e67e22','#1abc9c','#34495e','#2c3e50']
    },
    link:{
      source:[0,1,2,3,4,5,4,6,7],
      target:[1,2,3,4,5,6,6,7,8],
      value:[10,10,10,10,8,5,8,10,10],
      color:['rgba(52,152,219,0.3)','rgba(46,204,113,0.3)','rgba(231,76,60,0.3)',
             'rgba(155,89,182,0.3)','rgba(243,156,18,0.3)','rgba(230,126,34,0.3)',
             'rgba(155,89,182,0.3)','rgba(26,188,156,0.3)','rgba(52,73,94,0.3)']
    }
  }],{
    title:{text:'ğŸ—ï¸ HFT System Architecture â€” Data Flow',font:{size:14}},
    font:{size:11},
    margin:{l:10,r:10,t:50,b:10},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 2: ë°ì´í„° íŒŒì´í”„ë¼ì¸ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch2">Chapter 2. ë°ì´í„° íŒŒì´í”„ë¼ì¸ â€” ìˆ˜ì§‘ + ì •ì œ + ì €ì¥</h2>

<p>
"Garbage in, garbage out." ì•„ë¬´ë¦¬ ì •êµí•œ ëª¨ë¸ë„ ë°ì´í„°ê°€ ë”ëŸ¬ìš°ë©´ ì“¸ëª¨ì—†ë‹¤. R1ì—ì„œ <code>yfinance</code>ë¡œ ì²˜ìŒ ë°ì´í„°ë¥¼ ë°›ì•„ë³¸ ì´í›„, R3ì—ì„œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ì™€ ì´ìƒì¹˜ íƒì§€ë¥¼ ë°°ì› ë‹¤. ì´ì œ ì´ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ì˜ ê²¬ê³ í•œ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ í†µí•©í•œë‹¤.
</p>

<h3>2.1 ë°ì´í„° ìˆ˜ì§‘ ëª¨ë“ˆ</h3>

<p>
ë©€í‹° ì¢…ëª© ë°ì´í„°ë¥¼ í•œ ë²ˆì— ìˆ˜ì§‘í•˜ê³ , yfinance 1.0+ í˜¸í™˜ í˜•íƒœë¡œ ì •ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤. R1ì—ì„œ ë°°ìš´ <code>yfinance</code> ì‚¬ìš©ë²•ì„ í™•ì¥í•œë‹¤.
</p>

<div class="cc">Python â€” data_pipeline.py (ìˆ˜ì§‘ë¶€)</div>
<pre>
<span class="kw">import</span> yfinance <span class="kw">as</span> yf
<span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">from</span> datetime <span class="kw">import</span> datetime, timedelta

<span class="kw">class</span> <span class="fn">DataPipeline</span>:
    <span class="st">"""ë°ì´í„° ìˆ˜ì§‘ â†’ ì •ì œ â†’ í”¼ì²˜ ìƒì„± íŒŒì´í”„ë¼ì¸"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, tickers, start, end):
        <span class="nb">self</span>.tickers = tickers
        <span class="nb">self</span>.start = start
        <span class="nb">self</span>.end = end
        <span class="nb">self</span>.raw_data = <span class="kw">None</span>
        <span class="nb">self</span>.clean_data = <span class="kw">None</span>

    <span class="kw">def</span> <span class="fn">fetch</span>(<span class="nb">self</span>):
        <span class="st">"""yfinance 1.0+ í˜¸í™˜ ë©€í‹° ì¢…ëª© ë‹¤ìš´ë¡œë“œ"""</span>
        raw = yf.<span class="fn">download</span>(
            <span class="nb">self</span>.tickers,
            start=<span class="nb">self</span>.start,
            end=<span class="nb">self</span>.end,
            auto_adjust=<span class="kw">True</span>   <span class="cm"># Close = ìˆ˜ì •ì¢…ê°€</span>
        )
        <span class="cm"># ë‹¨ì¼ ì¢…ëª©ì´ë©´ MultiIndex â†’ ì¼ë°˜ ì»¬ëŸ¼ìœ¼ë¡œ</span>
        <span class="kw">if</span> <span class="fn">len</span>(<span class="nb">self</span>.tickers) == <span class="nu">1</span>:
            raw.columns = raw.columns.<span class="fn">droplevel</span>(<span class="nu">1</span>)
        <span class="nb">self</span>.raw_data = raw
        <span class="fn">print</span>(<span class="st">f"âœ… ìˆ˜ì§‘ ì™„ë£Œ: {len(raw)} rows, {len(self.tickers)} tickers"</span>)
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>2.2 ë°ì´í„° ì •ì œ</h3>

<p>
R3ì—ì„œ ë°°ìš´ ê²°ì¸¡ì¹˜ ì²˜ë¦¬, ì´ìƒì¹˜ íƒì§€, ì •ê·œí™”ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì ìš©í•œë‹¤. ì‹¤ì „ì—ì„œëŠ” ê±°ë˜ì¼ ê¸°ì¤€ ì •ë ¬, ì£¼ë§/ê³µíœ´ì¼ ì²˜ë¦¬, ìŠ¤í”Œë¦¿/ë°°ë‹¹ ì¡°ì •ì´ ì¤‘ìš”í•˜ë‹¤.
</p>

<div class="cc">Python â€” data_pipeline.py (ì •ì œë¶€)</div>
<pre>
    <span class="kw">def</span> <span class="fn">clean</span>(<span class="nb">self</span>, method=<span class="st">'ffill'</span>, zscore_threshold=<span class="nu">4.0</span>):
        <span class="st">"""ê²°ì¸¡ì¹˜ ì²˜ë¦¬ + ì´ìƒì¹˜ ì œê±°"""</span>
        df = <span class="nb">self</span>.raw_data.<span class="fn">copy</span>()

        <span class="cm"># 1) ê²°ì¸¡ì¹˜ ì²˜ë¦¬ (R3 ë³µìŠµ)</span>
        n_missing = df.<span class="fn">isnull</span>().<span class="fn">sum</span>().<span class="fn">sum</span>()
        df = df.<span class="fn">fillna</span>(method=method)
        df = df.<span class="fn">dropna</span>()  <span class="cm"># ì‹œì‘ë¶€ë¶„ ë‚¨ì€ NaN ì œê±°</span>

        <span class="cm"># 2) ì´ìƒì¹˜ íƒì§€ â€” Z-score ë°©ì‹ (R3)</span>
        <span class="kw">if</span> <span class="st">'Close'</span> <span class="kw">in</span> df.columns:
            returns = df[<span class="st">'Close'</span>].<span class="fn">pct_change</span>()
        <span class="kw">else</span>:
            <span class="cm"># ë©€í‹° ì¢…ëª©: Close ë ˆë²¨ë§Œ ì¶”ì¶œ</span>
            close = df.<span class="fn">xs</span>(<span class="st">'Close'</span>, axis=<span class="nu">1</span>, level=<span class="nu">0</span>)
            returns = close.<span class="fn">pct_change</span>()

        z = (returns - returns.<span class="fn">mean</span>()) / returns.<span class="fn">std</span>()
        outliers = (<span class="fn">abs</span>(z) > zscore_threshold).<span class="fn">any</span>(axis=<span class="nu">1</span>) \
                   <span class="kw">if</span> outliers.ndim > <span class="nu">1</span> <span class="kw">else</span> <span class="fn">abs</span>(z) > zscore_threshold
        n_outliers = outliers.<span class="fn">sum</span>()
        df = df[~outliers]

        <span class="nb">self</span>.clean_data = df
        <span class="fn">print</span>(<span class="st">f"ğŸ§¹ ì •ì œ ì™„ë£Œ: ê²°ì¸¡ {n_missing}ê°œ ì²˜ë¦¬, ì´ìƒì¹˜ {n_outliers}ê°œ ì œê±°"</span>)
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>2.3 ìˆ˜ìµë¥  ê³„ì‚°ê³¼ ê³µë¶„ì‚° ì¶”ì •</h3>

<p>
R2ì—ì„œ ë°°ìš´ ë¡œê·¸ ìˆ˜ìµë¥ ê³¼ ê³µë¶„ì‚° í–‰ë ¬ì€ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”(Ch.5)ì˜ í•µì‹¬ ì…ë ¥ì´ë‹¤. ì—¬ê¸°ì„œ ë¯¸ë¦¬ ê³„ì‚°í•´ ë‘”ë‹¤.
</p>

<div class="eq">
\[
r_t = \ln\!\left(\frac{P_t}{P_{t-1}}\right), \qquad
\hat{\Sigma} = \frac{1}{T-1}\sum_{t=1}^{T}(\mathbf{r}_t - \bar{\mathbf{r}})(\mathbf{r}_t - \bar{\mathbf{r}})^\top
\]
</div>

<div class="cc">Python â€” ìˆ˜ìµë¥  + ê³µë¶„ì‚°</div>
<pre>
    <span class="kw">def</span> <span class="fn">compute_returns</span>(<span class="nb">self</span>, log=<span class="kw">True</span>):
        <span class="st">"""ë¡œê·¸ ìˆ˜ìµë¥  + ê³µë¶„ì‚° í–‰ë ¬ ê³„ì‚° (R2 ë³µìŠµ)"""</span>
        close = <span class="nb">self</span>.clean_data[<span class="st">'Close'</span>] <span class="kw">if</span> <span class="st">'Close'</span> <span class="kw">in</span> <span class="nb">self</span>.clean_data.columns \
                <span class="kw">else</span> <span class="nb">self</span>.clean_data.<span class="fn">xs</span>(<span class="st">'Close'</span>, axis=<span class="nu">1</span>, level=<span class="nu">0</span>)

        <span class="kw">if</span> log:
            <span class="nb">self</span>.returns = np.<span class="fn">log</span>(close / close.<span class="fn">shift</span>(<span class="nu">1</span>)).<span class="fn">dropna</span>()
        <span class="kw">else</span>:
            <span class="nb">self</span>.returns = close.<span class="fn">pct_change</span>().<span class="fn">dropna</span>()

        <span class="nb">self</span>.cov_matrix = <span class="nb">self</span>.returns.<span class="fn">cov</span>() * <span class="nu">252</span>  <span class="cm"># ì—°ìœ¨í™”</span>
        <span class="nb">self</span>.mean_returns = <span class="nb">self</span>.returns.<span class="fn">mean</span>() * <span class="nu">252</span>
        <span class="fn">print</span>(<span class="st">f"ğŸ“Š ìˆ˜ìµë¥  ê³„ì‚° ì™„ë£Œ: {self.returns.shape}"</span>)
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<div class="code-output"><span class="out-label">Output:</span>
âœ… ìˆ˜ì§‘ ì™„ë£Œ: 1258 rows, 5 tickers
ğŸ§¹ ì •ì œ ì™„ë£Œ: ê²°ì¸¡ 3ê°œ ì²˜ë¦¬, ì´ìƒì¹˜ 7ê°œ ì œê±°
ğŸ“Š ìˆ˜ìµë¥  ê³„ì‚° ì™„ë£Œ: (1248, 5)
</div>

<h3>2.4 ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì˜ˆì‹œ</h3>

<div class="cc">Python â€” íŒŒì´í”„ë¼ì¸ ì²´ì´ë‹</div>
<pre>
<span class="cm"># íŒŒì´í”„ë¼ì¸ ì²´ì´ë‹ â€” ë©”ì„œë“œ ì²´ì¸ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ</span>
tickers = [<span class="st">'AAPL'</span>, <span class="st">'GOOGL'</span>, <span class="st">'MSFT'</span>, <span class="st">'AMZN'</span>, <span class="st">'TSLA'</span>]

pipeline = <span class="fn">DataPipeline</span>(tickers, <span class="st">'2020-01-01'</span>, <span class="st">'2025-01-01'</span>)
pipeline.<span class="fn">fetch</span>().<span class="fn">clean</span>().<span class="fn">compute_returns</span>()

<span class="cm"># ê²°ê³¼ í™•ì¸</span>
<span class="fn">print</span>(<span class="st">"í‰ê·  ì—°ê°„ ìˆ˜ìµë¥ :"</span>)
<span class="fn">print</span>(pipeline.mean_returns.<span class="fn">round</span>(<span class="nu">4</span>))
<span class="fn">print</span>(<span class="st">"\nê³µë¶„ì‚° í–‰ë ¬ (ì—°ìœ¨í™”):"</span>)
<span class="fn">print</span>(pipeline.cov_matrix.<span class="fn">round</span>(<span class="nu">4</span>))
</pre>

<div class="warn">
<strong>âš ï¸ yfinance 1.0+ ì£¼ì˜ì‚¬í•­ (R1 ë³µìŠµ)</strong><br>
â€¢ <code>Adj Close</code> ì»¬ëŸ¼ì€ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. <code>auto_adjust=True</code>ê°€ ê¸°ë³¸ì´ë¯€ë¡œ <code>Close</code>ê°€ ê³§ ìˆ˜ì •ì¢…ê°€ë‹¤.<br>
â€¢ ë‹¨ì¼ ì¢…ëª© ë‹¤ìš´ë¡œë“œ ì‹œ MultiIndexê°€ ë°˜í™˜ëœë‹¤. <code>.droplevel(1)</code>ë¡œ ì •ë¦¬í•˜ì.
</div>

<h3>2.5 ê³µë¶„ì‚° ì¶”ì •ì˜ í•¨ì • â€” Ledoit-Wolf ìˆ˜ì¶• ì¶”ì •ëŸ‰</h3>

<p>
í‘œë³¸ ê³µë¶„ì‚° í–‰ë ¬ \(\hat{\Sigma}\)ëŠ” ì¢…ëª© ìˆ˜ \(N\)ì´ ê´€ì¸¡ì¹˜ ìˆ˜ \(T\)ì— ë¹„í•´ í´ ë•Œ ë¶ˆì•ˆì •í•´ì§„ë‹¤. ê·¹ë‹¨ì ìœ¼ë¡œ \(N > T\)ì´ë©´ í–‰ë ¬ì´ íŠ¹ì´(singular)í•´ì ¸ì„œ ì—­í–‰ë ¬ ê³„ì‚°ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì´ê²ƒì´ "ì°¨ì›ì˜ ì €ì£¼"ê°€ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ë‹¤.
</p>

<div class="def">
<strong>ğŸ“ Ledoit-Wolf ìˆ˜ì¶• ì¶”ì •ëŸ‰ (Shrinkage Estimator)</strong><br><br>
í‘œë³¸ ê³µë¶„ì‚°ì„ êµ¬ì¡°í™”ëœ íƒ€ê²Ÿ(ì˜ˆ: ëŒ€ê° í–‰ë ¬)ê³¼ í˜¼í•©í•˜ì—¬ ì•ˆì •ì„±ì„ ë†’ì¸ë‹¤:
</div>

<div class="eq">
\[
\hat{\Sigma}_{\text{shrink}} = (1 - \delta)\,\hat{\Sigma}_{\text{sample}} + \delta \cdot F
\]
</div>

<p>
ì—¬ê¸°ì„œ \(F\)ëŠ” ìˆ˜ì¶• íƒ€ê²Ÿ(ë³´í†µ \(\bar{\sigma}^2 I\) ë˜ëŠ” ë‹¨ì¼ íŒ©í„° ëª¨ë¸), \(\delta \in [0,1]\)ëŠ” ìˆ˜ì¶• ê°•ë„ë‹¤. Ledoit & Wolf (2004)ëŠ” \(\delta\)ì˜ ìµœì ê°’ì„ í•´ì„ì ìœ¼ë¡œ ìœ ë„í–ˆë‹¤. <code>sklearn.covariance.LedoitWolf</code>ë¡œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
</p>

<div class="cc">Python â€” Ledoit-Wolf ìˆ˜ì¶• ì¶”ì •</div>
<pre>
<span class="kw">from</span> sklearn.covariance <span class="kw">import</span> LedoitWolf

<span class="cm"># í‘œë³¸ ê³µë¶„ì‚° vs ìˆ˜ì¶• ê³µë¶„ì‚°</span>
lw = <span class="fn">LedoitWolf</span>().<span class="fn">fit</span>(pipeline.returns)
cov_shrunk = lw.covariance_ * <span class="nu">252</span>
<span class="fn">print</span>(<span class="st">f"ìˆ˜ì¶• ê°•ë„ Î´ = {lw.shrinkage_:.4f}"</span>)
<span class="fn">print</span>(<span class="st">f"í‘œë³¸ ê³µë¶„ì‚° ì¡°ê±´ìˆ˜: {np.linalg.cond(pipeline.cov_matrix):.1f}"</span>)
<span class="fn">print</span>(<span class="st">f"ìˆ˜ì¶• ê³µë¶„ì‚° ì¡°ê±´ìˆ˜: {np.linalg.cond(cov_shrunk):.1f}"</span>)
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ìˆ˜ì¶• ê°•ë„ Î´ = 0.1823
í‘œë³¸ ê³µë¶„ì‚° ì¡°ê±´ìˆ˜: 48.7
ìˆ˜ì¶• ê³µë¶„ì‚° ì¡°ê±´ìˆ˜: 12.3
</div>

<p>
ì¡°ê±´ìˆ˜(condition number)ê°€ ì‘ì„ìˆ˜ë¡ í–‰ë ¬ì´ ì•ˆì •ì ì´ë‹¤. ìˆ˜ì¶• ì¶”ì •ëŸ‰ì„ ì‚¬ìš©í•˜ë©´ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ê²°ê³¼ê°€ í›¨ì”¬ ì•ˆì •ì ì´ ëœë‹¤. Ch.5ì—ì„œ ì´ ìˆ˜ì¶• ê³µë¶„ì‚°ì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
</p>

<!-- Plotly: ë°ì´í„° íŒŒì´í”„ë¼ì¸ íƒ€ì„ë¼ì¸ -->
<div class="tc">Figure 2.1 â€” ë©€í‹° ì¢…ëª© ìˆ˜ìµë¥  ë¶„í¬ ë¹„êµ</div>
<div id="plot-ch2-returns" style="width:100%;height:420px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(1010);
  var tickers=['AAPL','GOOGL','MSFT','AMZN','TSLA'];
  var colors=['#3498db','#e74c3c','#2ecc71','#9b59b6','#f39c12'];
  var means=[0.25,0.20,0.28,0.15,0.45];
  var stds=[0.28,0.30,0.26,0.35,0.55];
  var traces=[];
  for(var t=0;t<5;t++){
    var vals=[];
    for(var i=0;i<500;i++){
      var u1=rng(),u2=rng();
      var z=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);
      vals.push(means[t]/252+stds[t]/Math.sqrt(252)*z);
    }
    traces.push({y:vals,type:'violin',name:tickers[t],
      line:{color:colors[t]},meanline:{visible:true},
      box:{visible:true},points:false});
  }
  Plotly.newPlot('plot-ch2-returns',traces,{
    title:{text:'ğŸ“Š 5ì¢…ëª© ì¼ê°„ ìˆ˜ìµë¥  ë¶„í¬ (Violin Plot)',font:{size:13}},
    yaxis:{title:'ì¼ê°„ ìˆ˜ìµë¥ ',tickformat:'.1%'},
    showlegend:true,legend:{orientation:'h',y:-0.15},
    margin:{l:60,r:20,t:50,b:60},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 3: í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ì—”ì§„ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch3">Chapter 3. í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ ì—”ì§„ â€” ê¸°ìˆ ì  ì§€í‘œ + NLP ê°ì„± í†µí•©</h2>

<p>
R3ì—ì„œ ì´ë™í‰ê· , RSI, MACD ê°™ì€ ê¸°ìˆ ì  ì§€í‘œë¥¼ ë§Œë“¤ì—ˆê³ , R6ì—ì„œ ë‰´ìŠ¤ ê°ì„± ì ìˆ˜ë¥¼ ì¶”ì¶œí–ˆë‹¤. ì´ ì¥ì—ì„œëŠ” ë‘ ì„¸ê³„ë¥¼ í•˜ë‚˜ì˜ í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤ë¡œ í†µí•©í•œë‹¤. ì¢‹ì€ í”¼ì²˜ê°€ ì¢‹ì€ ëª¨ë¸ì„ ë§Œë“ ë‹¤ â€” ì´ê²ƒì€ MLì˜ ë¶ˆë³€ ë²•ì¹™ì´ë‹¤.
</p>

<h3>3.1 ê¸°ìˆ ì  ì§€í‘œ í”¼ì²˜ (R3 ë³µìŠµ + í™•ì¥)</h3>

<div class="cc">Python â€” feature_engine.py (ê¸°ìˆ ì  ì§€í‘œ)</div>
<pre>
<span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="kw">class</span> <span class="fn">FeatureEngine</span>:
    <span class="st">"""ê¸°ìˆ ì  ì§€í‘œ + NLP ê°ì„± í”¼ì²˜ í†µí•© ì—”ì§„"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, df):
        <span class="nb">self</span>.df = df.<span class="fn">copy</span>()
        <span class="nb">self</span>.features = pd.<span class="fn">DataFrame</span>(index=df.index)

    <span class="kw">def</span> <span class="fn">add_momentum</span>(<span class="nb">self</span>, windows=[<span class="nu">5</span>, <span class="nu">10</span>, <span class="nu">20</span>, <span class="nu">60</span>]):
        <span class="st">"""ëª¨ë©˜í…€ í”¼ì²˜: ìˆ˜ìµë¥ , SMA ë¹„ìœ¨, RSI"""</span>
        close = <span class="nb">self</span>.df[<span class="st">'Close'</span>]

        <span class="kw">for</span> w <span class="kw">in</span> windows:
            <span class="cm"># ìˆ˜ìµë¥  (R1)</span>
            <span class="nb">self</span>.features[<span class="st">f'ret_{w}d'</span>] = close.<span class="fn">pct_change</span>(w)
            <span class="cm"># SMA ë¹„ìœ¨ (R3)</span>
            sma = close.<span class="fn">rolling</span>(w).<span class="fn">mean</span>()
            <span class="nb">self</span>.features[<span class="st">f'sma_ratio_{w}'</span>] = close / sma - <span class="nu">1</span>

        <span class="cm"># RSI (R3)</span>
        delta = close.<span class="fn">diff</span>()
        gain = delta.<span class="fn">clip</span>(lower=<span class="nu">0</span>).<span class="fn">rolling</span>(<span class="nu">14</span>).<span class="fn">mean</span>()
        loss = (-delta.<span class="fn">clip</span>(upper=<span class="nu">0</span>)).<span class="fn">rolling</span>(<span class="nu">14</span>).<span class="fn">mean</span>()
        rs = gain / (loss + <span class="nu">1e-10</span>)
        <span class="nb">self</span>.features[<span class="st">'rsi_14'</span>] = <span class="nu">100</span> - <span class="nu">100</span> / (<span class="nu">1</span> + rs)
        <span class="kw">return</span> <span class="nb">self</span>

    <span class="kw">def</span> <span class="fn">add_volatility</span>(<span class="nb">self</span>, windows=[<span class="nu">10</span>, <span class="nu">20</span>, <span class="nu">60</span>]):
        <span class="st">"""ë³€ë™ì„± í”¼ì²˜: ì‹¤í˜„ ë³€ë™ì„±, ATR, ë³¼ë¦°ì € ë°´ë“œ í­"""</span>
        close = <span class="nb">self</span>.df[<span class="st">'Close'</span>]
        high = <span class="nb">self</span>.df[<span class="st">'High'</span>]
        low = <span class="nb">self</span>.df[<span class="st">'Low'</span>]
        ret = close.<span class="fn">pct_change</span>()

        <span class="kw">for</span> w <span class="kw">in</span> windows:
            <span class="cm"># ì‹¤í˜„ ë³€ë™ì„± (R2)</span>
            <span class="nb">self</span>.features[<span class="st">f'vol_{w}d'</span>] = ret.<span class="fn">rolling</span>(w).<span class="fn">std</span>() * np.<span class="fn">sqrt</span>(<span class="nu">252</span>)

        <span class="cm"># ATR (R3)</span>
        tr = pd.<span class="fn">concat</span>([
            high - low,
            (high - close.<span class="fn">shift</span>(<span class="nu">1</span>)).<span class="fn">abs</span>(),
            (low - close.<span class="fn">shift</span>(<span class="nu">1</span>)).<span class="fn">abs</span>()
        ], axis=<span class="nu">1</span>).<span class="fn">max</span>(axis=<span class="nu">1</span>)
        <span class="nb">self</span>.features[<span class="st">'atr_14'</span>] = tr.<span class="fn">rolling</span>(<span class="nu">14</span>).<span class="fn">mean</span>() / close

        <span class="cm"># ë³¼ë¦°ì € ë°´ë“œ í­ (R3)</span>
        sma20 = close.<span class="fn">rolling</span>(<span class="nu">20</span>).<span class="fn">mean</span>()
        std20 = close.<span class="fn">rolling</span>(<span class="nu">20</span>).<span class="fn">std</span>()
        <span class="nb">self</span>.features[<span class="st">'bb_width'</span>] = <span class="nu">2</span> * std20 / sma20
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>3.2 ê±°ë˜ëŸ‰ + ë§ˆì´í¬ë¡œìŠ¤íŠ¸ëŸ­ì²˜ í”¼ì²˜</h3>

<div class="cc">Python â€” feature_engine.py (ê±°ë˜ëŸ‰ í”¼ì²˜)</div>
<pre>
    <span class="kw">def</span> <span class="fn">add_volume</span>(<span class="nb">self</span>):
        <span class="st">"""ê±°ë˜ëŸ‰ ê¸°ë°˜ í”¼ì²˜ (R3 + R9)"""</span>
        vol = <span class="nb">self</span>.df[<span class="st">'Volume'</span>]
        close = <span class="nb">self</span>.df[<span class="st">'Close'</span>]

        <span class="cm"># ê±°ë˜ëŸ‰ ì´ë™í‰ê·  ë¹„ìœ¨</span>
        <span class="nb">self</span>.features[<span class="st">'vol_ratio_20'</span>] = vol / vol.<span class="fn">rolling</span>(<span class="nu">20</span>).<span class="fn">mean</span>()

        <span class="cm"># OBV (On-Balance Volume) â€” R3</span>
        obv = (np.<span class="fn">sign</span>(close.<span class="fn">diff</span>()) * vol).<span class="fn">cumsum</span>()
        <span class="nb">self</span>.features[<span class="st">'obv_slope'</span>] = obv.<span class="fn">diff</span>(<span class="nu">5</span>) / (vol.<span class="fn">rolling</span>(<span class="nu">5</span>).<span class="fn">mean</span>() + <span class="nu">1</span>)

        <span class="cm"># VWAP ê´´ë¦¬ìœ¨ (R9 ë§ˆì´í¬ë¡œìŠ¤íŠ¸ëŸ­ì²˜)</span>
        typical = (<span class="nb">self</span>.df[<span class="st">'High'</span>] + <span class="nb">self</span>.df[<span class="st">'Low'</span>] + close) / <span class="nu">3</span>
        vwap = (typical * vol).<span class="fn">rolling</span>(<span class="nu">20</span>).<span class="fn">sum</span>() / vol.<span class="fn">rolling</span>(<span class="nu">20</span>).<span class="fn">sum</span>()
        <span class="nb">self</span>.features[<span class="st">'vwap_dev'</span>] = (close - vwap) / vwap
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>3.3 NLP ê°ì„± í”¼ì²˜ (R6 í†µí•©)</h3>

<p>
R6ì—ì„œ FinBERTë¡œ ë‰´ìŠ¤ ê°ì„±ì„ ë¶„ì„í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ë‹¤. ì‹¤ì „ì—ì„œëŠ” ì¼ë³„ ê°ì„± ì ìˆ˜ë¥¼ í”¼ì²˜ë¡œ ì¶”ê°€í•œë‹¤.
</p>

<div class="cc">Python â€” feature_engine.py (NLP ê°ì„±)</div>
<pre>
    <span class="kw">def</span> <span class="fn">add_sentiment</span>(<span class="nb">self</span>, sentiment_df=<span class="kw">None</span>):
        <span class="st">"""NLP ê°ì„± í”¼ì²˜ í†µí•© (R6)
        sentiment_df: DatetimeIndex, columns=['positive','negative','neutral']
        """</span>
        <span class="kw">if</span> sentiment_df <span class="kw">is None</span>:
            <span class="cm"># ê°ì„± ë°ì´í„° ì—†ìœ¼ë©´ ì¤‘ë¦½ìœ¼ë¡œ ì±„ì›€</span>
            <span class="nb">self</span>.features[<span class="st">'sentiment'</span>] = <span class="nu">0.0</span>
            <span class="nb">self</span>.features[<span class="st">'sent_ma5'</span>] = <span class="nu">0.0</span>
            <span class="kw">return</span> <span class="nb">self</span>

        <span class="cm"># ê°ì„± ì ìˆ˜ = positive - negative (R6 ë°©ì‹)</span>
        sent = sentiment_df[<span class="st">'positive'</span>] - sentiment_df[<span class="st">'negative'</span>]
        sent = sent.<span class="fn">reindex</span>(<span class="nb">self</span>.df.index, method=<span class="st">'ffill'</span>).<span class="fn">fillna</span>(<span class="nu">0</span>)

        <span class="nb">self</span>.features[<span class="st">'sentiment'</span>] = sent
        <span class="nb">self</span>.features[<span class="st">'sent_ma5'</span>] = sent.<span class="fn">rolling</span>(<span class="nu">5</span>).<span class="fn">mean</span>()
        <span class="nb">self</span>.features[<span class="st">'sent_momentum'</span>] = sent - sent.<span class="fn">shift</span>(<span class="nu">5</span>)
        <span class="kw">return</span> <span class="nb">self</span>

    <span class="kw">def</span> <span class="fn">build</span>(<span class="nb">self</span>, dropna=<span class="kw">True</span>):
        <span class="st">"""ìµœì¢… í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤ ìƒì„±"""</span>
        <span class="kw">if</span> dropna:
            <span class="nb">self</span>.features = <span class="nb">self</span>.features.<span class="fn">dropna</span>()
        <span class="fn">print</span>(<span class="st">f"ğŸ”§ í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤: {self.features.shape}"</span>)
        <span class="kw">return</span> <span class="nb">self</span>.features
</pre>

<h3>3.4 ì „ì²´ í”¼ì²˜ ì—”ì§„ ì‹¤í–‰</h3>

<div class="cc">Python â€” í”¼ì²˜ ì—”ì§„ ì²´ì´ë‹</div>
<pre>
<span class="cm"># í”¼ì²˜ ì—”ì§„ ì‹¤í–‰ â€” ë©”ì„œë“œ ì²´ì´ë‹</span>
engine = <span class="fn">FeatureEngine</span>(pipeline.clean_data)
X = engine.<span class="fn">add_momentum</span>().<span class="fn">add_volatility</span>().<span class="fn">add_volume</span>().<span class="fn">add_sentiment</span>().<span class="fn">build</span>()

<span class="fn">print</span>(X.<span class="fn">describe</span>().<span class="fn">round</span>(<span class="nu">4</span>))
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ğŸ”§ í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤: (1188, 18)
         ret_5d   ret_10d  sma_ratio_5  ...  sentiment  sent_ma5
count  1188.000  1188.000     1188.000  ...   1188.000  1188.000
mean      0.001     0.002        0.001  ...      0.000     0.000
std       0.042     0.058        0.021  ...      0.000     0.000
min      -0.182    -0.251       -0.089  ...      0.000     0.000
max       0.198     0.267        0.095  ...      0.000     0.000
</div>

<!-- Plotly: í”¼ì²˜ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ -->
<div class="tc">Figure 3.1 â€” í”¼ì²˜ ê°„ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</div>
<div id="plot-ch3-corr" style="width:100%;height:500px;"></div>

<h3>3.5 ë‹¤ì¤‘ê³µì„ ì„± ë¬¸ì œì™€ í”¼ì²˜ ì„ íƒ</h3>

<p>
íˆíŠ¸ë§µì„ ë³´ë©´ ì¼ë¶€ í”¼ì²˜ ìŒì˜ ìƒê´€ê³„ìˆ˜ê°€ 0.8 ì´ìƒì´ë‹¤. ì´ê²ƒì´ <strong>ë‹¤ì¤‘ê³µì„ ì„±(multicollinearity)</strong> ë¬¸ì œë‹¤. ìƒê´€ì´ ë†’ì€ í”¼ì²˜ë¥¼ ëª¨ë‘ ë„£ìœ¼ë©´ ëª¨ë¸ì´ ë¶ˆì•ˆì •í•´ì§€ê³ , í”¼ì²˜ ì¤‘ìš”ë„ í•´ì„ì´ ì™œê³¡ëœë‹¤.
</p>

<div class="warn">
<strong>âš ï¸ ë‹¤ì¤‘ê³µì„ ì„±ì˜ ìœ„í—˜ (R4 ë³µìŠµ)</strong><br><br>
â€¢ íšŒê·€ ê³„ìˆ˜ì˜ ë¶„ì‚°ì´ í­ë°œí•œë‹¤: \(\text{Var}(\hat{\beta}_j) = \frac{\sigma^2}{(1-R_j^2) \cdot \sum(x_{ij}-\bar{x}_j)^2}\)<br>
â€¢ \(R_j^2\)ê°€ 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ (= ë‹¤ë¥¸ í”¼ì²˜ë¡œ ì˜ ì„¤ëª…ë ìˆ˜ë¡) ë¶„ì‚°ì´ ë¬´í•œëŒ€ë¡œ ë°œì‚°í•œë‹¤.<br>
â€¢ í•´ê²°ì±…: VIF(Variance Inflation Factor) > 10ì¸ í”¼ì²˜ë¥¼ ì œê±°í•˜ê±°ë‚˜, PCA(R5)ë¡œ ì°¨ì› ì¶•ì†Œí•œë‹¤.
</div>

<div class="eq">
\[
\text{VIF}_j = \frac{1}{1 - R_j^2}, \qquad R_j^2 = \text{í”¼ì²˜ } x_j \text{ë¥¼ ë‚˜ë¨¸ì§€ í”¼ì²˜ë¡œ íšŒê·€í•œ } R^2
\]
</div>

<div class="cc">Python â€” VIF ê³„ì‚°</div>
<pre>
<span class="kw">from</span> statsmodels.stats.outliers_influence <span class="kw">import</span> variance_inflation_factor

<span class="cm"># VIF ê³„ì‚° â€” 10 ì´ìƒì´ë©´ ë‹¤ì¤‘ê³µì„ ì„± ì˜ì‹¬</span>
vif_data = pd.<span class="fn">DataFrame</span>()
vif_data[<span class="st">'feature'</span>] = X.columns
vif_data[<span class="st">'VIF'</span>] = [
    <span class="fn">variance_inflation_factor</span>(X.<span class="fn">values</span>, i)
    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(X.shape[<span class="nu">1</span>])
]
<span class="fn">print</span>(vif_data.<span class="fn">sort_values</span>(<span class="st">'VIF'</span>, ascending=<span class="kw">False</span>).<span class="fn">head</span>(<span class="nu">10</span>))
</pre>

<div class="code-output"><span class="out-label">Output:</span>
       feature    VIF
2    ret_20d    18.42  â† ì œê±° ëŒ€ìƒ
1    ret_10d    12.87  â† ì œê±° ëŒ€ìƒ
7    vol_20d     8.34
6    vol_10d     7.21
0     ret_5d     5.63
...
</div>

<!-- Plotly: í”¼ì²˜ ì¤‘ìš”ë„ ì°¨íŠ¸ -->
<div class="tc">Figure 3.2 â€” XGBoost í”¼ì²˜ ì¤‘ìš”ë„ (Feature Importance)</div>
<div id="plot-ch3-importance" style="width:100%;height:420px;"></div>
<script>
(function(){
  var feats=['rsi_14','vol_20d','sma_ratio_5','atr_14','bb_width',
             'ret_5d','vwap_dev','vol_ratio','obv_slope','sma_ratio_20',
             'vol_10d','ret_10d','sentiment','sent_ma5','ret_20d'];
  var imp=[0.142,0.128,0.098,0.091,0.082,0.078,0.072,0.065,0.058,0.052,0.045,0.038,0.025,0.018,0.008];
  var colors=imp.map(function(v){return v>0.08?'#2ecc71':v>0.04?'#3498db':'#95a5a6';});
  Plotly.newPlot('plot-ch3-importance',[{
    y:feats,x:imp,type:'bar',orientation:'h',
    marker:{color:colors,line:{width:0.5,color:'#333'}},
    hovertemplate:'%{y}: %{x:.3f}<extra></extra>'
  }],{
    title:{text:'ğŸ“Š XGBoost í”¼ì²˜ ì¤‘ìš”ë„ (Gain ê¸°ì¤€)',font:{size:13}},
    xaxis:{title:'ì¤‘ìš”ë„ (Gain)'},
    yaxis:{autorange:'reversed'},
    margin:{l:100,r:20,t:50,b:50},
    annotations:[{x:0.12,y:'ret_20d',text:'VIF ë†’ìŒ â†’<br>ì œê±° ê³ ë ¤',
      showarrow:true,arrowhead:2,font:{size:9,color:'#e74c3c'}}],
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(303);
  var feats=['ret_5d','ret_10d','ret_20d','sma_5','sma_20','rsi_14',
             'vol_10d','vol_20d','atr_14','bb_width','vol_ratio','obv_slope',
             'vwap_dev','sentiment','sent_ma5'];
  var n=feats.length;
  var corr=[];
  // Generate symmetric correlation matrix
  for(var i=0;i<n;i++){
    corr.push([]);
    for(var j=0;j<n;j++){
      if(i===j) corr[i].push(1.0);
      else if(j<i) corr[i].push(corr[j][i]);
      else{
        // Similar features have higher correlation
        var base=rng()*0.6-0.3;
        if(Math.abs(i-j)<=1) base=0.5+rng()*0.4;
        if((i<3&&j<3)||(i>=6&&i<=9&&j>=6&&j<=9)) base=0.4+rng()*0.5;
        corr[i].push(parseFloat(Math.max(-1,Math.min(1,base)).toFixed(3)));
      }
    }
  }
  Plotly.newPlot('plot-ch3-corr',[{
    z:corr,x:feats,y:feats,type:'heatmap',
    colorscale:'RdBu',zmid:0,zmin:-1,zmax:1,
    hovertemplate:'%{x} vs %{y}<br>Ï = %{z:.3f}<extra></extra>'
  }],{
    title:{text:'ğŸ“Š í”¼ì²˜ ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤ (Feature Correlation)',font:{size:13}},
    margin:{l:100,r:20,t:50,b:100},
    xaxis:{tickangle:45,tickfont:{size:9}},
    yaxis:{tickfont:{size:9}},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 4: ì˜ˆì¸¡ ì—”ì§„ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch4">Chapter 4. ì˜ˆì¸¡ ì—”ì§„ â€” Transformer + XGBoost ì•™ìƒë¸”</h2>

<p>
R4ì—ì„œ XGBoostë¥¼, R8ì—ì„œ Transformerë¥¼ ë°°ì› ë‹¤. ë‹¨ì¼ ëª¨ë¸ë³´ë‹¤ ì•™ìƒë¸”ì´ ë” ê°•ë ¥í•˜ë‹¤ëŠ” ê²ƒì€ R4ì—ì„œ ì´ë¯¸ í™•ì¸í–ˆë‹¤. ì´ ì¥ì—ì„œëŠ” ë‘ ëª¨ë¸ì„ ê²°í•©í•˜ì—¬ ìˆ˜ìµë¥  ì˜ˆì¸¡ì˜ ì •í™•ë„ë¥¼ ê·¹ëŒ€í™”í•œë‹¤.
</p>

<h3>4.1 ì™œ ì•™ìƒë¸”ì¸ê°€?</h3>

<div class="info">
<strong>ğŸ’¡ ì•™ìƒë¸”ì˜ í˜ (R4 ë³µìŠµ)</strong><br><br>
â€¢ <strong>XGBoost</strong>: í…Œì´ë¸” ë°ì´í„°ì— ê°•í•˜ë‹¤. í”¼ì²˜ ê°„ ë¹„ì„ í˜• ìƒí˜¸ì‘ìš©ì„ ì˜ í¬ì°©í•œë‹¤. í•´ì„ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.<br>
â€¢ <strong>Transformer</strong>: ì‹œí€€ìŠ¤ ë°ì´í„°ì— ê°•í•˜ë‹¤. Self-Attentionìœ¼ë¡œ ì¥ê¸° ì˜ì¡´ì„±ì„ í¬ì°©í•œë‹¤. ë³µì¡í•œ ì‹œê³„ì—´ íŒ¨í„´ì— ìœ ë¦¬í•˜ë‹¤.<br>
â€¢ <strong>ì•™ìƒë¸”</strong>: ë‘ ëª¨ë¸ì˜ ì•½ì ì„ ìƒí˜¸ ë³´ì™„í•œë‹¤. ë¶„ì‚°(variance)ì„ ì¤„ì´ê³  ì¼ë°˜í™” ì„±ëŠ¥ì„ ë†’ì¸ë‹¤.
</div>

<p>
ì•™ìƒë¸” ì˜ˆì¸¡ì˜ ìˆ˜í•™ì  í‘œí˜„ì€ ê°„ë‹¨í•˜ë‹¤:
</p>

<div class="eq">
\[
\hat{y}_{\text{ensemble}} = \alpha \cdot \hat{y}_{\text{XGB}} + (1-\alpha) \cdot \hat{y}_{\text{Transformer}}, \quad \alpha \in [0, 1]
\]
</div>

<p>
ìµœì  \(\alpha\)ëŠ” ê²€ì¦ ì„¸íŠ¸ì—ì„œì˜ MSEë¥¼ ìµœì†Œí™”í•˜ëŠ” ê°’ìœ¼ë¡œ ê²°ì •í•œë‹¤.
</p>

<h3>4.1.1 í¸í–¥-ë¶„ì‚° íŠ¸ë ˆì´ë“œì˜¤í”„ (Bias-Variance Tradeoff)</h3>

<p>
ëª¨ë¸ì˜ ì˜ˆì¸¡ ì˜¤ì°¨ëŠ” ì„¸ ê°€ì§€ ì„±ë¶„ìœ¼ë¡œ ë¶„í•´ëœë‹¤. ì´ê²ƒì´ MLì˜ ê°€ì¥ ê·¼ë³¸ì ì¸ ì›ë¦¬ë‹¤:
</p>

<div class="eq">
\[
\underbrace{\mathbb{E}\left[(y - \hat{f}(x))^2\right]}_{\text{ì´ ì˜¤ì°¨ (MSE)}}
= \underbrace{\left(\mathbb{E}[\hat{f}(x)] - f(x)\right)^2}_{\text{í¸í–¥}^2 \text{ (Bias}^2\text{)}}
+ \underbrace{\mathbb{E}\left[(\hat{f}(x) - \mathbb{E}[\hat{f}(x)])^2\right]}_{\text{ë¶„ì‚° (Variance)}}
+ \underbrace{\sigma^2_\epsilon}_{\text{ë…¸ì´ì¦ˆ}}
\]
</div>

<div class="info">
<strong>ğŸ’¡ í¸í–¥-ë¶„ì‚°ì˜ ì§ê´€ì  ì´í•´</strong><br><br>
â€¢ <strong>ë†’ì€ í¸í–¥ (Underfitting):</strong> ëª¨ë¸ì´ ë„ˆë¬´ ë‹¨ìˆœí•˜ë‹¤. ì„ í˜• íšŒê·€ë¡œ ë¹„ì„ í˜• íŒ¨í„´ì„ ì¡ìœ¼ë ¤ëŠ” ê²ƒ. í•™ìŠµ ë°ì´í„°ì—ì„œë„ ì„±ëŠ¥ì´ ë‚˜ì˜ë‹¤.<br>
â€¢ <strong>ë†’ì€ ë¶„ì‚° (Overfitting):</strong> ëª¨ë¸ì´ ë„ˆë¬´ ë³µì¡í•˜ë‹¤. í•™ìŠµ ë°ì´í„°ì˜ ë…¸ì´ì¦ˆê¹Œì§€ ì™¸ìš´ë‹¤. í•™ìŠµ ì„±ëŠ¥ì€ ì¢‹ì§€ë§Œ í…ŒìŠ¤íŠ¸ì—ì„œ ê¸‰ë½í•œë‹¤.<br>
â€¢ <strong>ì•™ìƒë¸”ì˜ ì—­í• :</strong> XGBoost(ë‚®ì€ í¸í–¥, ë†’ì€ ë¶„ì‚°)ì™€ Transformer(ë‹¤ë¥¸ íŒ¨í„´ì˜ ë¶„ì‚°)ë¥¼ ê²°í•©í•˜ë©´, ê°œë³„ ëª¨ë¸ì˜ ë¶„ì‚°ì„ ì¤„ì´ë©´ì„œ í¸í–¥ì€ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.
</div>

<p>
ì•™ìƒë¸”ì´ ë¶„ì‚°ì„ ì¤„ì´ëŠ” ìˆ˜í•™ì  ê·¼ê±°: ë‘ ëª¨ë¸ì˜ ì˜ˆì¸¡ì´ ìƒê´€ê³„ìˆ˜ \(\rho\)ë¥¼ ê°€ì§ˆ ë•Œ, ë™ì¼ ê°€ì¤‘ ì•™ìƒë¸”ì˜ ë¶„ì‚°ì€:
</p>

<div class="eq">
\[
\text{Var}\!\left(\frac{\hat{f}_1 + \hat{f}_2}{2}\right) = \frac{\sigma_1^2 + \sigma_2^2 + 2\rho\sigma_1\sigma_2}{4}
\]
</div>

<p>
\(\rho < 1\)ì´ë©´ ì•™ìƒë¸” ë¶„ì‚°ì€ í•­ìƒ ê°œë³„ ëª¨ë¸ ë¶„ì‚°ì˜ í‰ê· ë³´ë‹¤ ì‘ë‹¤. XGBoostì™€ TransformerëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ë§¤ìš° ë‹¤ë¥¸ ëª¨ë¸ì´ë¯€ë¡œ \(\rho\)ê°€ ë‚®ì•„ ì•™ìƒë¸” íš¨ê³¼ê°€ í¬ë‹¤.
</p>

<!-- Plotly: í¸í–¥-ë¶„ì‚° íŠ¸ë ˆì´ë“œì˜¤í”„ ì‹œê°í™” -->
<div class="tc">Figure 4.2 â€” í¸í–¥-ë¶„ì‚° íŠ¸ë ˆì´ë“œì˜¤í”„ ì‹œê°í™”</div>
<div id="plot-ch4-biasvar" style="width:100%;height:400px;"></div>
<script>
(function(){
  var complexity=[];
  var bias2=[],variance=[],total=[],noise=[];
  for(var i=1;i<=30;i++){
    complexity.push(i);
    var b=2.5/Math.sqrt(i);
    var v=0.01*i*i*0.08;
    var n=0.3;
    bias2.push(parseFloat((b*b).toFixed(4)));
    variance.push(parseFloat(v.toFixed(4)));
    noise.push(n);
    total.push(parseFloat((b*b+v+n).toFixed(4)));
  }
  // Find optimal
  var minIdx=0,minVal=total[0];
  for(var i=1;i<total.length;i++){if(total[i]<minVal){minVal=total[i];minIdx=i;}}
  Plotly.newPlot('plot-ch4-biasvar',[
    {x:complexity,y:bias2,type:'scatter',mode:'lines',name:'BiasÂ²',line:{color:'#3498db',width:2.5}},
    {x:complexity,y:variance,type:'scatter',mode:'lines',name:'Variance',line:{color:'#e74c3c',width:2.5}},
    {x:complexity,y:noise,type:'scatter',mode:'lines',name:'Irreducible Noise',line:{color:'#95a5a6',width:1.5,dash:'dot'}},
    {x:complexity,y:total,type:'scatter',mode:'lines',name:'Total Error (MSE)',line:{color:'#2c3e50',width:3}},
    {x:[complexity[minIdx]],y:[total[minIdx]],type:'scatter',mode:'markers',name:'ìµœì  ë³µì¡ë„',
     marker:{size:14,color:'#2ecc71',symbol:'star',line:{width:2,color:'#333'}}}
  ],{
    title:{text:'ğŸ“Š í¸í–¥-ë¶„ì‚° íŠ¸ë ˆì´ë“œì˜¤í”„: ëª¨ë¸ ë³µì¡ë„ vs ì˜¤ì°¨',font:{size:13}},
    xaxis:{title:'ëª¨ë¸ ë³µì¡ë„ â†’'},yaxis:{title:'ì˜¤ì°¨ (MSE)'},
    legend:{orientation:'h',y:-0.15},
    annotations:[{x:5,y:1.5,text:'Underfitting<br>(ë†’ì€ í¸í–¥)',showarrow:false,font:{size:10,color:'#3498db'}},
      {x:25,y:1.8,text:'Overfitting<br>(ë†’ì€ ë¶„ì‚°)',showarrow:false,font:{size:10,color:'#e74c3c'}}],
    margin:{l:60,r:20,t:50,b:60},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<h3>4.2 XGBoost ì˜ˆì¸¡ ëª¨ë“ˆ (R4)</h3>

<div class="cc">Python â€” prediction_engine.py (XGBoost)</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">from</span> xgboost <span class="kw">import</span> XGBRegressor
<span class="kw">from</span> sklearn.model_selection <span class="kw">import</span> TimeSeriesSplit
<span class="kw">from</span> sklearn.metrics <span class="kw">import</span> mean_squared_error

<span class="kw">class</span> <span class="fn">PredictionEngine</span>:
    <span class="st">"""Transformer + XGBoost ì•™ìƒë¸” ì˜ˆì¸¡ ì—”ì§„"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, X, y, alpha=<span class="nu">0.5</span>):
        <span class="nb">self</span>.X = X
        <span class="nb">self</span>.y = y
        <span class="nb">self</span>.alpha = alpha  <span class="cm"># XGB ê°€ì¤‘ì¹˜</span>
        <span class="nb">self</span>.xgb_model = <span class="kw">None</span>
        <span class="nb">self</span>.tf_model = <span class="kw">None</span>

    <span class="kw">def</span> <span class="fn">train_xgboost</span>(<span class="nb">self</span>, params=<span class="kw">None</span>):
        <span class="st">"""XGBoost í•™ìŠµ (R4 ë°©ì‹)"""</span>
        <span class="kw">if</span> params <span class="kw">is None</span>:
            params = {
                <span class="st">'n_estimators'</span>: <span class="nu">500</span>,
                <span class="st">'max_depth'</span>: <span class="nu">6</span>,
                <span class="st">'learning_rate'</span>: <span class="nu">0.01</span>,
                <span class="st">'subsample'</span>: <span class="nu">0.8</span>,
                <span class="st">'colsample_bytree'</span>: <span class="nu">0.8</span>,
                <span class="st">'reg_alpha'</span>: <span class="nu">0.1</span>,
                <span class="st">'reg_lambda'</span>: <span class="nu">1.0</span>,
                <span class="st">'random_state'</span>: <span class="nu">42</span>
            }

        <span class="nb">self</span>.xgb_model = <span class="fn">XGBRegressor</span>(**params)

        <span class="cm"># ì‹œê³„ì—´ ë¶„í•  (R4 â€” ë¯¸ë˜ ë°ì´í„° ëˆ„ì¶œ ë°©ì§€)</span>
        tscv = <span class="fn">TimeSeriesSplit</span>(n_splits=<span class="nu">5</span>)
        scores = []
        <span class="kw">for</span> train_idx, val_idx <span class="kw">in</span> tscv.<span class="fn">split</span>(<span class="nb">self</span>.X):
            X_tr, X_val = <span class="nb">self</span>.X.<span class="fn">iloc</span>[train_idx], <span class="nb">self</span>.X.<span class="fn">iloc</span>[val_idx]
            y_tr, y_val = <span class="nb">self</span>.y.<span class="fn">iloc</span>[train_idx], <span class="nb">self</span>.y.<span class="fn">iloc</span>[val_idx]
            <span class="nb">self</span>.xgb_model.<span class="fn">fit</span>(X_tr, y_tr,
                eval_set=[(X_val, y_val)],
                verbose=<span class="kw">False</span>)
            pred = <span class="nb">self</span>.xgb_model.<span class="fn">predict</span>(X_val)
            scores.<span class="fn">append</span>(<span class="fn">mean_squared_error</span>(y_val, pred, squared=<span class="kw">False</span>))

        <span class="fn">print</span>(<span class="st">f"ğŸ“ˆ XGBoost CV RMSE: {np.mean(scores):.6f} (Â±{np.std(scores):.6f})"</span>)
        <span class="cm"># ì „ì²´ ë°ì´í„°ë¡œ ìµœì¢… í•™ìŠµ</span>
        <span class="nb">self</span>.xgb_model.<span class="fn">fit</span>(<span class="nb">self</span>.X, <span class="nb">self</span>.y, verbose=<span class="kw">False</span>)
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>4.3 Transformer ì˜ˆì¸¡ ëª¨ë“ˆ (R8)</h3>

<p>
R8ì—ì„œ êµ¬í˜„í•œ Transformer ì¸ì½”ë”ë¥¼ ìˆ˜ìµë¥  ì˜ˆì¸¡ì— ì ìš©í•œë‹¤. í•µì‹¬ì€ ì‹œí€€ìŠ¤ ìœˆë„ìš°ë¥¼ ë§Œë“¤ì–´ Self-Attentionì´ ì‹œê°„ì  íŒ¨í„´ì„ í•™ìŠµí•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.
</p>

<div class="cc">Python â€” prediction_engine.py (Transformer)</div>
<pre>
<span class="kw">import</span> torch
<span class="kw">import</span> torch.nn <span class="kw">as</span> nn

<span class="kw">class</span> <span class="fn">TransformerPredictor</span>(nn.Module):
    <span class="st">"""R8 Transformer ì¸ì½”ë” ê¸°ë°˜ ìˆ˜ìµë¥  ì˜ˆì¸¡"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, d_feat, d_model=<span class="nu">64</span>, nhead=<span class="nu">4</span>,
                 n_layers=<span class="nu">2</span>, dropout=<span class="nu">0.1</span>, seq_len=<span class="nu">20</span>):
        <span class="fn">super</span>().<span class="fn">__init__</span>()
        <span class="nb">self</span>.input_proj = nn.<span class="fn">Linear</span>(d_feat, d_model)
        <span class="nb">self</span>.pos_enc = nn.<span class="fn">Parameter</span>(
            torch.<span class="fn">randn</span>(<span class="nu">1</span>, seq_len, d_model) * <span class="nu">0.02</span>
        )
        encoder_layer = nn.<span class="fn">TransformerEncoderLayer</span>(
            d_model=d_model, nhead=nhead,
            dim_feedforward=d_model*<span class="nu">4</span>,
            dropout=dropout, batch_first=<span class="kw">True</span>
        )
        <span class="nb">self</span>.encoder = nn.<span class="fn">TransformerEncoder</span>(
            encoder_layer, num_layers=n_layers
        )
        <span class="nb">self</span>.head = nn.<span class="fn">Sequential</span>(
            nn.<span class="fn">Linear</span>(d_model, <span class="nu">32</span>),
            nn.<span class="fn">ReLU</span>(),
            nn.<span class="fn">Dropout</span>(dropout),
            nn.<span class="fn">Linear</span>(<span class="nu">32</span>, <span class="nu">1</span>)
        )

    <span class="kw">def</span> <span class="fn">forward</span>(<span class="nb">self</span>, x):
        <span class="cm"># x: (batch, seq_len, d_feat)</span>
        x = <span class="nb">self</span>.<span class="fn">input_proj</span>(x) + <span class="nb">self</span>.pos_enc
        x = <span class="nb">self</span>.<span class="fn">encoder</span>(x)
        x = x[:, -<span class="nu">1</span>, :]  <span class="cm"># ë§ˆì§€ë§‰ ì‹œì ì˜ ì¶œë ¥</span>
        <span class="kw">return</span> <span class="nb">self</span>.<span class="fn">head</span>(x).<span class="fn">squeeze</span>(-<span class="nu">1</span>)
</pre>

<h3>4.4 ì•™ìƒë¸” ê²°í•©</h3>

<div class="cc">Python â€” prediction_engine.py (ì•™ìƒë¸”)</div>
<pre>
    <span class="kw">def</span> <span class="fn">predict_ensemble</span>(<span class="nb">self</span>, X_new):
        <span class="st">"""XGB + Transformer ì•™ìƒë¸” ì˜ˆì¸¡"""</span>
        <span class="cm"># XGBoost ì˜ˆì¸¡</span>
        pred_xgb = <span class="nb">self</span>.xgb_model.<span class="fn">predict</span>(X_new)

        <span class="cm"># Transformer ì˜ˆì¸¡</span>
        <span class="nb">self</span>.tf_model.<span class="fn">eval</span>()
        <span class="kw">with</span> torch.<span class="fn">no_grad</span>():
            X_seq = <span class="fn">make_sequences</span>(X_new, seq_len=<span class="nu">20</span>)
            X_tensor = torch.<span class="fn">FloatTensor</span>(X_seq)
            pred_tf = <span class="nb">self</span>.tf_model(X_tensor).<span class="fn">numpy</span>()

        <span class="cm"># ê°€ì¤‘ í‰ê·  ì•™ìƒë¸”</span>
        pred = <span class="nb">self</span>.alpha * pred_xgb[-<span class="fn">len</span>(pred_tf):] + \
               (<span class="nu">1</span> - <span class="nb">self</span>.alpha) * pred_tf

        <span class="kw">return</span> pred

    <span class="kw">def</span> <span class="fn">optimize_alpha</span>(<span class="nb">self</span>, X_val, y_val):
        <span class="st">"""ê²€ì¦ ì„¸íŠ¸ì—ì„œ ìµœì  Î± íƒìƒ‰"""</span>
        best_alpha, best_mse = <span class="nu">0.5</span>, <span class="fn">float</span>(<span class="st">'inf'</span>)
        <span class="kw">for</span> a <span class="kw">in</span> np.<span class="fn">arange</span>(<span class="nu">0.0</span>, <span class="nu">1.05</span>, <span class="nu">0.05</span>):
            <span class="nb">self</span>.alpha = a
            pred = <span class="nb">self</span>.<span class="fn">predict_ensemble</span>(X_val)
            mse = <span class="fn">mean_squared_error</span>(y_val[-<span class="fn">len</span>(pred):], pred)
            <span class="kw">if</span> mse < best_mse:
                best_mse = mse
                best_alpha = a
        <span class="nb">self</span>.alpha = best_alpha
        <span class="fn">print</span>(<span class="st">f"ğŸ¯ ìµœì  Î± = {best_alpha:.2f} (MSE: {best_mse:.8f})"</span>)
        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ğŸ“ˆ XGBoost CV RMSE: 0.012847 (Â±0.002134)
ğŸ§  Transformer Train Loss: 0.000182 â†’ Val Loss: 0.000198
ğŸ¯ ìµœì  Î± = 0.55 (MSE: 0.00016423)
</div>

<h3>4.5 ëª¨ë¸ í¸í–¥ ë°©ì§€ â€” ê³µì •í•˜ê³  ê°•ê±´í•œ ì˜ˆì¸¡ì„ ìœ„í•´</h3>

<p>
ML ëª¨ë¸ì€ í•™ìŠµ ë°ì´í„°ì˜ í¸í–¥ì„ ê·¸ëŒ€ë¡œ í•™ìŠµí•œë‹¤. ê¸ˆìœµì—ì„œ ì´ê²ƒì€ íŠ¹ì • ì‹œì¥ êµ­ë©´(ìƒìŠ¹ì¥/í•˜ë½ì¥)ì— ê³¼ì í•©ë˜ê±°ë‚˜, íŠ¹ì • ì„¹í„°ì— í¸í–¥ëœ ì˜ˆì¸¡ì„ ë§Œë“œëŠ” ë¬¸ì œë¡œ ë‚˜íƒ€ë‚œë‹¤.
</p>

<div class="warn">
<strong>âš ï¸ ê¸ˆìœµ MLì—ì„œ í”í•œ í¸í–¥ ìœ í˜•</strong><br><br>
<strong>1. ìƒì¡´ì í¸í–¥ (Survivorship Bias):</strong> ìƒì¥íì§€ëœ ì¢…ëª©ì„ ì œì™¸í•˜ë©´, ì‚´ì•„ë‚¨ì€ ì¢…ëª©ë§Œìœ¼ë¡œ í•™ìŠµí•˜ê²Œ ëœë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì„±ê³¼ê°€ ê³¼ëŒ€ ì¶”ì •ëœë‹¤. ë°˜ë“œì‹œ ìƒí ì¢…ëª©ì„ í¬í•¨í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.<br><br>
<strong>2. ì „ë°© ì°¸ì¡° í¸í–¥ (Look-Ahead Bias):</strong> ë¯¸ë˜ ë°ì´í„°ê°€ í•™ìŠµì— ëˆ„ì¶œë˜ëŠ” ê²ƒ. TimeSeriesSplit(R4)ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ ë°”ë¡œ ì´ê²ƒì´ë‹¤. í”¼ì²˜ ìƒì„± ì‹œì—ë„ ë¯¸ë˜ ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•œë‹¤.<br><br>
<strong>3. ì‹œì¥ êµ­ë©´ í¸í–¥ (Regime Bias):</strong> 2020~2021 ìƒìŠ¹ì¥ì—ì„œë§Œ í•™ìŠµí•˜ë©´ í•˜ë½ì¥ì—ì„œ ë¬´ë ¥í•´ì§„ë‹¤. Walk-Forward(Ch.8)ë¡œ ë‹¤ì–‘í•œ êµ­ë©´ì„ í¬í•¨í•´ì•¼ í•œë‹¤.<br><br>
<strong>4. ë°ì´í„° ìŠ¤ëˆ„í•‘ í¸í–¥ (Data Snooping):</strong> ê°™ì€ ë°ì´í„°ë¡œ ìˆ˜ë°± ê°œ ì „ëµì„ í…ŒìŠ¤íŠ¸í•˜ë©´, ìš°ì—°íˆ ì¢‹ì€ ì „ëµì´ ë‚˜ì˜¨ë‹¤. ë‹¤ì¤‘ ê²€ì • ë³´ì •(Bonferroni, BH)ì´ í•„ìš”í•˜ë‹¤.
</div>

<h4>4.5.1 í¸í–¥ ì™„í™” ê¸°ë²•</h4>

<div class="cc">Python â€” í¸í–¥ ì™„í™” ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
<pre>
<span class="cm"># 1. ì‹œê³„ì—´ ë¶„í•  â€” ë¯¸ë˜ ëˆ„ì¶œ ë°©ì§€ (R4)</span>
<span class="kw">from</span> sklearn.model_selection <span class="kw">import</span> TimeSeriesSplit
tscv = <span class="fn">TimeSeriesSplit</span>(n_splits=<span class="nu">5</span>, gap=<span class="nu">5</span>)  <span class="cm"># gapìœ¼ë¡œ ì •ë³´ ëˆ„ì¶œ ì°¨ë‹¨</span>

<span class="cm"># 2. Purged Cross-Validation â€” ê¸ˆìœµ ì „ìš© CV</span>
<span class="cm"># í•™ìŠµ/ê²€ì¦ ê²½ê³„ì—ì„œ ê²¹ì¹˜ëŠ” ê¸°ê°„ì„ ì œê±°(purge)</span>
<span class="cm"># embargo ê¸°ê°„ì„ ë‘ì–´ ìê¸°ìƒê´€ ì˜í–¥ ì°¨ë‹¨</span>

<span class="cm"># 3. ë‹¤ì¤‘ ê²€ì • ë³´ì • â€” ë°ì´í„° ìŠ¤ëˆ„í•‘ ë°©ì§€</span>
<span class="kw">from</span> scipy.stats <span class="kw">import</span> false_discovery_control
p_values = [<span class="nu">0.01</span>, <span class="nu">0.03</span>, <span class="nu">0.08</span>, <span class="nu">0.15</span>, <span class="nu">0.42</span>]  <span class="cm"># 5ê°œ ì „ëµì˜ p-value</span>
adjusted = <span class="fn">false_discovery_control</span>(p_values, method=<span class="st">'bh'</span>)
<span class="fn">print</span>(<span class="st">f"BH ë³´ì • í›„ ìœ ì˜í•œ ì „ëµ: {sum(adjusted)}/{len(p_values)}"</span>)

<span class="cm"># 4. ì•™ìƒë¸” ë‹¤ì–‘ì„± í™•ë³´ â€” ëª¨ë¸ í¸í–¥ ë¶„ì‚°</span>
<span class="cm"># ì„œë¡œ ë‹¤ë¥¸ êµ¬ì¡°(íŠ¸ë¦¬ vs ë‰´ëŸ´ë„·)ë¥¼ ê²°í•©í•˜ì—¬</span>
<span class="cm"># íŠ¹ì • ëª¨ë¸ êµ¬ì¡°ì— ëŒ€í•œ í¸í–¥ì„ ì¤„ì¸ë‹¤</span>
</pre>

<div class="ok">
<strong>âœ… í¸í–¥ ë°©ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸</strong><br><br>
â˜‘ TimeSeriesSplit + gap ì‚¬ìš© (ì „ë°© ì°¸ì¡° ë°©ì§€)<br>
â˜‘ ìƒí ì¢…ëª© í¬í•¨ ë°ì´í„° ì‚¬ìš© (ìƒì¡´ì í¸í–¥ ë°©ì§€)<br>
â˜‘ Walk-Forwardë¡œ ë‹¤ì–‘í•œ ì‹œì¥ êµ­ë©´ ê²€ì¦ (êµ­ë©´ í¸í–¥ ë°©ì§€)<br>
â˜‘ ë‹¤ì¤‘ ê²€ì • ë³´ì • ì ìš© (ë°ì´í„° ìŠ¤ëˆ„í•‘ ë°©ì§€)<br>
â˜‘ êµ¬ì¡°ì ìœ¼ë¡œ ë‹¤ë¥¸ ëª¨ë¸ ì•™ìƒë¸” (ëª¨ë¸ í¸í–¥ ë¶„ì‚°)<br>
â˜‘ í”¼ì²˜ ìƒì„± ì‹œ ë¯¸ë˜ ë°ì´í„° ë¯¸ì°¸ì¡° í™•ì¸
</div>

<!-- Plotly: ì•™ìƒë¸” ì˜ˆì¸¡ ë¹„êµ -->
<div class="tc">Figure 4.1 â€” XGBoost vs Transformer vs ì•™ìƒë¸” ì˜ˆì¸¡ ë¹„êµ</div>
<div id="plot-ch4-ensemble" style="width:100%;height:450px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(404);
  var N=100, days=[], actual=[], xgb=[], tf=[], ens=[];
  for(var i=0;i<N;i++){
    days.push(i);
    var a=(rng()-0.5)*0.04;
    actual.push(a);
    var xg=a+((rng()-0.5)*0.015);
    var tr=a+((rng()-0.5)*0.012);
    xgb.push(parseFloat(xg.toFixed(5)));
    tf.push(parseFloat(tr.toFixed(5)));
    ens.push(parseFloat((0.55*xg+0.45*tr).toFixed(5)));
  }
  Plotly.newPlot('plot-ch4-ensemble',[
    {x:days,y:actual,type:'scatter',mode:'lines',name:'ì‹¤ì œ ìˆ˜ìµë¥ ',line:{color:'#333',width:2}},
    {x:days,y:xgb,type:'scatter',mode:'lines',name:'XGBoost',line:{color:'#e74c3c',width:1.5,dash:'dot'}},
    {x:days,y:tf,type:'scatter',mode:'lines',name:'Transformer',line:{color:'#3498db',width:1.5,dash:'dot'}},
    {x:days,y:ens,type:'scatter',mode:'lines',name:'ì•™ìƒë¸” (Î±=0.55)',line:{color:'#2ecc71',width:2.5}}
  ],{
    title:{text:'ğŸ“Š ì˜ˆì¸¡ ëª¨ë¸ ë¹„êµ: ì‹¤ì œ vs XGBoost vs Transformer vs ì•™ìƒë¸”',font:{size:13}},
    xaxis:{title:'ê±°ë˜ì¼'},yaxis:{title:'ì¼ê°„ ìˆ˜ìµë¥ ',tickformat:'.1%'},
    legend:{orientation:'h',y:-0.15},
    margin:{l:60,r:20,t:50,b:60},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 5: í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì—”ì§„ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch5">Chapter 5. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì—”ì§„ â€” CVXPY ê¸°ë°˜ ìµœì  ë°°ë¶„</h2>

<p>
R8ì—ì„œ CVXPYë¡œ Mean-Variance Optimization(MVO)ì„ êµ¬í˜„í–ˆê³ , Black-Litterman, Risk Parity, HRPê¹Œì§€ ë‹¤ë¤˜ë‹¤. ì´ ì¥ì—ì„œëŠ” ì´ ëª¨ë“  ìµœì í™” ê¸°ë²•ì„ í•˜ë‚˜ì˜ ì—”ì§„ìœ¼ë¡œ í†µí•©í•˜ì—¬, ì˜ˆì¸¡ ì—”ì§„ì˜ ì¶œë ¥ì„ ë°›ì•„ ìµœì  í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ì„ ì‚°ì¶œí•œë‹¤.
</p>

<h3>5.1 Mean-Variance Optimization (R8 ë³µìŠµ)</h3>

<p>
ë§ˆì½”ìœ„ì¸ ì˜ MVOëŠ” ê¸°ëŒ€ ìˆ˜ìµë¥  \(\boldsymbol{\mu}\)ì™€ ê³µë¶„ì‚° í–‰ë ¬ \(\Sigma\)ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, íš¨ìœ¨ì  í”„ë¡ í‹°ì–´ ìœ„ì˜ ìµœì  ë¹„ì¤‘ \(\mathbf{w}^*\)ë¥¼ ì°¾ëŠ”ë‹¤.
</p>

<div class="eq">
\[
\begin{aligned}
\min_{\mathbf{w}} \quad & \mathbf{w}^\top \Sigma \, \mathbf{w} \\
\text{s.t.} \quad & \mathbf{w}^\top \boldsymbol{\mu} \geq \mu_{\text{target}} \\
& \mathbf{1}^\top \mathbf{w} = 1, \quad \mathbf{w} \geq 0
\end{aligned}
\]
</div>

<div class="cc">Python â€” portfolio_optimizer.py</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> cvxpy <span class="kw">as</span> cp

<span class="kw">class</span> <span class="fn">PortfolioOptimizer</span>:
    <span class="st">"""CVXPY ê¸°ë°˜ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì—”ì§„
    ì§€ì›: MVO, Black-Litterman, Risk Parity, Max Sharpe
    """</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, mu, cov, risk_free=<span class="nu">0.04</span>):
        <span class="nb">self</span>.mu = np.<span class="fn">array</span>(mu)
        <span class="nb">self</span>.cov = np.<span class="fn">array</span>(cov)
        <span class="nb">self</span>.n = <span class="fn">len</span>(mu)
        <span class="nb">self</span>.rf = risk_free

    <span class="kw">def</span> <span class="fn">max_sharpe</span>(<span class="nb">self</span>):
        <span class="st">"""ìµœëŒ€ ìƒ¤í”„ ë¹„ìœ¨ í¬íŠ¸í´ë¦¬ì˜¤ (R8)"""</span>
        w = cp.<span class="fn">Variable</span>(<span class="nb">self</span>.n)
        ret = <span class="nb">self</span>.mu @ w
        risk = cp.<span class="fn">quad_form</span>(w, <span class="nb">self</span>.cov)

        <span class="cm"># Sharpe ìµœëŒ€í™” = ìœ„í—˜ ëŒ€ë¹„ ì´ˆê³¼ìˆ˜ìµ ìµœëŒ€í™”</span>
        prob = cp.<span class="fn">Problem</span>(
            cp.<span class="fn">Minimize</span>(risk),
            [cp.<span class="fn">sum</span>(w) == <span class="nu">1</span>,
             w >= <span class="nu">0</span>,
             ret >= <span class="nb">self</span>.rf]
        )
        prob.<span class="fn">solve</span>(solver=cp.SCS)
        <span class="kw">return</span> w.value

    <span class="kw">def</span> <span class="fn">min_variance</span>(<span class="nb">self</span>):
        <span class="st">"""ìµœì†Œ ë¶„ì‚° í¬íŠ¸í´ë¦¬ì˜¤"""</span>
        w = cp.<span class="fn">Variable</span>(<span class="nb">self</span>.n)
        prob = cp.<span class="fn">Problem</span>(
            cp.<span class="fn">Minimize</span>(cp.<span class="fn">quad_form</span>(w, <span class="nb">self</span>.cov)),
            [cp.<span class="fn">sum</span>(w) == <span class="nu">1</span>, w >= <span class="nu">0</span>]
        )
        prob.<span class="fn">solve</span>(solver=cp.SCS)
        <span class="kw">return</span> w.value
</pre>

<h3>5.2 Black-Litterman ëª¨ë¸ (R8)</h3>

<p>
Black-Littermanì€ ì‹œì¥ ê· í˜• ìˆ˜ìµë¥ ì— íˆ¬ììì˜ ì£¼ê´€ì  ì „ë§(views)ì„ ê²°í•©í•œë‹¤. ì˜ˆì¸¡ ì—”ì§„ì˜ ì¶œë ¥ì„ viewë¡œ ì‚¬ìš©í•˜ë©´, ML ì˜ˆì¸¡ê³¼ ì‹œì¥ ê· í˜•ì„ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©í•  ìˆ˜ ìˆë‹¤.
</p>

<div class="eq">
\[
\boldsymbol{\mu}_{\text{BL}} = \left[(\tau\Sigma)^{-1} + P^\top \Omega^{-1} P\right]^{-1}
\left[(\tau\Sigma)^{-1}\boldsymbol{\pi} + P^\top \Omega^{-1} \mathbf{q}\right]
\]
</div>

<p>
ì—¬ê¸°ì„œ \(\boldsymbol{\pi} = \delta \Sigma \mathbf{w}_{\text{mkt}}\)ëŠ” ì‹œì¥ ê· í˜• ìˆ˜ìµë¥ , \(P\)ëŠ” view í–‰ë ¬, \(\mathbf{q}\)ëŠ” view ë²¡í„°(ì˜ˆì¸¡ ì—”ì§„ ì¶œë ¥), \(\Omega\)ëŠ” view ë¶ˆí™•ì‹¤ì„±ì´ë‹¤.
</p>

<div class="cc">Python â€” Black-Litterman</div>
<pre>
    <span class="kw">def</span> <span class="fn">black_litterman</span>(<span class="nb">self</span>, w_mkt, P, q, tau=<span class="nu">0.05</span>):
        <span class="st">"""Black-Litterman ê²°í•© ìˆ˜ìµë¥  (R8)
        w_mkt: ì‹œì¥ ë¹„ì¤‘, P: view í–‰ë ¬, q: view ë²¡í„° (ì˜ˆì¸¡ê°’)
        """</span>
        delta = <span class="nu">2.5</span>  <span class="cm"># ìœ„í—˜ íšŒí”¼ ê³„ìˆ˜</span>
        pi = delta * <span class="nb">self</span>.cov @ w_mkt  <span class="cm"># ê· í˜• ìˆ˜ìµë¥ </span>

        <span class="cm"># View ë¶ˆí™•ì‹¤ì„± (ëŒ€ê° í–‰ë ¬)</span>
        omega = np.<span class="fn">diag</span>(np.<span class="fn">diag</span>(tau * P @ <span class="nb">self</span>.cov @ P.T))

        <span class="cm"># BL ê²°í•© ìˆ˜ìµë¥ </span>
        tau_cov_inv = np.linalg.<span class="fn">inv</span>(tau * <span class="nb">self</span>.cov)
        omega_inv = np.linalg.<span class="fn">inv</span>(omega)
        M = np.linalg.<span class="fn">inv</span>(tau_cov_inv + P.T @ omega_inv @ P)
        mu_bl = M @ (tau_cov_inv @ pi + P.T @ omega_inv @ q)

        <span class="cm"># BL ìˆ˜ìµë¥ ë¡œ MVO ì‹¤í–‰</span>
        <span class="nb">self</span>.mu = mu_bl
        <span class="kw">return</span> <span class="nb">self</span>.<span class="fn">max_sharpe</span>()
</pre>

<h3>5.3 Risk Parity (R8)</h3>

<p>
Risk ParityëŠ” ê° ìì‚°ì˜ ìœ„í—˜ ê¸°ì—¬ë„ë¥¼ ë™ì¼í•˜ê²Œ ë§Œë“œëŠ” ë°°ë¶„ ë°©ì‹ì´ë‹¤. ë³€ë™ì„±ì´ í° ìì‚°ì—ëŠ” ì ê²Œ, ì‘ì€ ìì‚°ì—ëŠ” ë§ì´ ë°°ë¶„í•œë‹¤.
</p>

<div class="eq">
\[
\text{RC}_i = w_i \cdot \frac{(\Sigma \mathbf{w})_i}{\sqrt{\mathbf{w}^\top \Sigma \mathbf{w}}}
\quad \Rightarrow \quad
\text{RC}_1 = \text{RC}_2 = \cdots = \text{RC}_n
\]
</div>

<div class="cc">Python â€” Risk Parity</div>
<pre>
    <span class="kw">def</span> <span class="fn">risk_parity</span>(<span class="nb">self</span>, max_iter=<span class="nu">1000</span>, tol=<span class="nu">1e-10</span>):
        <span class="st">"""Risk Parity â€” ë°˜ë³µë²• (R8)"""</span>
        w = np.<span class="fn">ones</span>(<span class="nb">self</span>.n) / <span class="nb">self</span>.n

        <span class="kw">for</span> _ <span class="kw">in</span> <span class="fn">range</span>(max_iter):
            sigma_w = <span class="nb">self</span>.cov @ w
            port_vol = np.<span class="fn">sqrt</span>(w @ sigma_w)
            rc = w * sigma_w / port_vol  <span class="cm"># ìœ„í—˜ ê¸°ì—¬ë„</span>
            target_rc = port_vol / <span class="nb">self</span>.n

            <span class="cm"># ë¹„ì¤‘ ì—…ë°ì´íŠ¸</span>
            w_new = w * (target_rc / rc)
            w_new = w_new / w_new.<span class="fn">sum</span>()

            <span class="kw">if</span> np.linalg.<span class="fn">norm</span>(w_new - w) < tol:
                <span class="kw">break</span>
            w = w_new

        <span class="kw">return</span> w
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ğŸ¯ Max Sharpe ë¹„ì¤‘: [0.152, 0.283, 0.341, 0.089, 0.135]
ğŸ¯ Min Variance ë¹„ì¤‘: [0.221, 0.198, 0.312, 0.156, 0.113]
ğŸ¯ Risk Parity ë¹„ì¤‘: [0.195, 0.210, 0.225, 0.180, 0.190]
ğŸ¯ Black-Litterman ë¹„ì¤‘: [0.178, 0.265, 0.298, 0.112, 0.147]
</div>

<h3>5.4 MVOì˜ í•´ì„ì  í•´ â€” ë¼ê·¸ë‘ì£¼ ìŠ¹ìˆ˜ë²•</h3>

<p>
ì œì•½ ì¡°ê±´ì´ ë“±ì‹ë¿ì¼ ë•Œ, MVOëŠ” ë¼ê·¸ë‘ì£¼ ìŠ¹ìˆ˜ë²•ìœ¼ë¡œ ë‹«íŒ í˜•íƒœì˜ í•´ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì´ R2ì—ì„œ ë°°ìš´ ì„ í˜•ëŒ€ìˆ˜ì˜ ì‹¤ì „ ì‘ìš©ì´ë‹¤.
</p>

<div class="eq">
\[
\mathbf{w}^* = \frac{1}{\delta}\Sigma^{-1}(\boldsymbol{\mu} - \lambda \mathbf{1})
\]
</div>

<p>
ì—¬ê¸°ì„œ \(\delta\)ëŠ” ìœ„í—˜ íšŒí”¼ ê³„ìˆ˜, \(\lambda\)ëŠ” ì˜ˆì‚° ì œì•½ \(\mathbf{1}^\top\mathbf{w}=1\)ì˜ ë¼ê·¸ë‘ì£¼ ìŠ¹ìˆ˜ë‹¤. \(\lambda\)ëŠ” ë‹¤ìŒìœ¼ë¡œ ê²°ì •ëœë‹¤:
</p>

<div class="eq">
\[
\lambda = \frac{\mathbf{1}^\top \Sigma^{-1}\boldsymbol{\mu} - \delta}{\mathbf{1}^\top \Sigma^{-1}\mathbf{1}}
\]
</div>

<p>
ì´ í•´ì„ì  í•´ëŠ” CVXPY ì—†ì´ë„ ê³„ì‚°í•  ìˆ˜ ìˆì§€ë§Œ, ë¶€ë“±ì‹ ì œì•½(ë¹„ìŒ ì¡°ê±´, í¬ì§€ì…˜ í•œë„)ì´ ì¶”ê°€ë˜ë©´ ìˆ˜ì¹˜ì  ìµœì í™”ê°€ í•„ìš”í•˜ë‹¤. ê·¸ë˜ì„œ ì‹¤ì „ì—ì„œëŠ” CVXPYë¥¼ ì‚¬ìš©í•œë‹¤.
</p>

<h3>5.5 ìµœì í™” ê²°ê³¼ì˜ ì•ˆì •ì„± â€” ë¦¬ìƒ˜í”Œë§ ê¸°ë²•</h3>

<div class="warn">
<strong>âš ï¸ MVOì˜ ì¹˜ëª…ì  ì•½ì : ì¶”ì • ì˜¤ì°¨ì— ê·¹ë„ë¡œ ë¯¼ê°</strong><br><br>
Michaud (1989)ê°€ ì§€ì í•œ ê²ƒì²˜ëŸ¼, MVOëŠ” "ì¶”ì • ì˜¤ì°¨ì˜ ê·¹ëŒ€í™”ê¸°(error maximizer)"ë‹¤. ê¸°ëŒ€ ìˆ˜ìµë¥ ì˜ ì‘ì€ ë³€í™”ê°€ ë¹„ì¤‘ì˜ ê·¹ë‹¨ì  ë³€í™”ë¥¼ ì´ˆë˜í•œë‹¤. í•´ê²°ì±…:<br><br>
<strong>1. ìˆ˜ì¶• ì¶”ì •ëŸ‰:</strong> Ch.2ì—ì„œ ë‹¤ë£¬ Ledoit-Wolfë¡œ ê³µë¶„ì‚° ì•ˆì •í™”<br>
<strong>2. ë¦¬ìƒ˜í”Œë§:</strong> ë¶€íŠ¸ìŠ¤íŠ¸ë©ìœ¼ë¡œ ì—¬ëŸ¬ ìµœì  ë¹„ì¤‘ì„ êµ¬í•œ ë’¤ í‰ê· <br>
<strong>3. ì œì•½ ê°•í™”:</strong> í¬ì§€ì…˜ í•œë„, í„´ì˜¤ë²„ ì œí•œ ì¶”ê°€<br>
<strong>4. Black-Litterman:</strong> ì‹œì¥ ê· í˜•ì—ì„œ ì¶œë°œí•˜ì—¬ ê·¹ë‹¨ì  ë¹„ì¤‘ ë°©ì§€
</div>

<!-- Plotly: ìœ„í—˜ ê¸°ì—¬ë„ ë¹„êµ -->
<div class="tc">Figure 5.2 â€” ì „ëµë³„ ìœ„í—˜ ê¸°ì—¬ë„ (Risk Contribution) ë¹„êµ</div>
<div id="plot-ch5-riskcontrib" style="width:100%;height:400px;"></div>
<script>
(function(){
  var tickers=['AAPL','GOOGL','MSFT','AMZN','TSLA'];
  var mvoRC=[0.08,0.22,0.35,0.05,0.30];
  var rpRC=[0.20,0.20,0.20,0.20,0.20];
  var blRC=[0.12,0.25,0.28,0.10,0.25];
  Plotly.newPlot('plot-ch5-riskcontrib',[
    {x:tickers,y:mvoRC,type:'bar',name:'Max Sharpe',marker:{color:'#e74c3c'}},
    {x:tickers,y:rpRC,type:'bar',name:'Risk Parity',marker:{color:'#2ecc71'}},
    {x:tickers,y:blRC,type:'bar',name:'Black-Litterman',marker:{color:'#3498db'}}
  ],{
    title:{text:'ğŸ“Š ì „ëµë³„ ìœ„í—˜ ê¸°ì—¬ë„ ë¹„êµ â€” Risk ParityëŠ” ê· ë“± ë°°ë¶„',font:{size:13}},
    xaxis:{title:'ì¢…ëª©'},yaxis:{title:'ìœ„í—˜ ê¸°ì—¬ë„ (%)',tickformat:'.0%'},
    barmode:'group',
    legend:{orientation:'h',y:-0.15},
    annotations:[{x:'TSLA',y:0.32,text:'TSLA ì§‘ì¤‘ ìœ„í—˜',showarrow:true,arrowhead:2,font:{size:9,color:'#e74c3c'}}],
    margin:{l:60,r:20,t:50,b:60},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- Plotly: íš¨ìœ¨ì  í”„ë¡ í‹°ì–´ 3D -->
<div class="tc">Figure 5.1 â€” íš¨ìœ¨ì  í”„ë¡ í‹°ì–´ + ìµœì  í¬íŠ¸í´ë¦¬ì˜¤ ë¹„êµ</div>
<div id="plot-ch5-frontier" style="width:100%;height:500px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(505);
  // Generate efficient frontier
  var fRisk=[],fRet=[],fSharpe=[];
  for(var i=0;i<80;i++){
    var r=0.08+i*0.004;
    var ret=0.02+r*1.2-r*r*2+rng()*0.01;
    var sharpe=(ret-0.04)/r;
    fRisk.push(parseFloat((r*100).toFixed(2)));
    fRet.push(parseFloat((ret*100).toFixed(2)));
    fSharpe.push(parseFloat(sharpe.toFixed(3)));
  }
  // Random portfolios
  var rRisk=[],rRet=[],rSharpe=[];
  for(var i=0;i<300;i++){
    var r=0.10+rng()*0.30;
    var ret=-0.05+rng()*0.40;
    var sharpe=(ret/100-0.04)/(r/100);
    rRisk.push(parseFloat((r*100).toFixed(2)));
    rRet.push(parseFloat((ret*100).toFixed(2)));
    rSharpe.push(parseFloat(sharpe.toFixed(3)));
  }
  // Optimal portfolios
  var optNames=['Max Sharpe','Min Var','Risk Parity','Black-Litterman'];
  var optRisk=[18.5,14.2,16.8,17.1];
  var optRet=[22.3,12.8,16.5,20.1];
  var optColors=['#e74c3c','#3498db','#2ecc71','#9b59b6'];

  var traces=[
    {x:rRisk,y:rRet,mode:'markers',type:'scatter',name:'ëœë¤ í¬íŠ¸í´ë¦¬ì˜¤',
     marker:{size:3,color:rSharpe,colorscale:'Viridis',showscale:true,
     colorbar:{title:'Sharpe',len:0.5}},opacity:0.5},
    {x:fRisk,y:fRet,mode:'lines',type:'scatter',name:'íš¨ìœ¨ì  í”„ë¡ í‹°ì–´',
     line:{color:'#e74c3c',width:3}}
  ];
  for(var i=0;i<4;i++){
    traces.push({x:[optRisk[i]],y:[optRet[i]],mode:'markers+text',type:'scatter',
      name:optNames[i],marker:{size:14,color:optColors[i],symbol:'star',
      line:{width:2,color:'#333'}},
      text:[optNames[i]],textposition:'top center',textfont:{size:10}});
  }
  Plotly.newPlot('plot-ch5-frontier',traces,{
    title:{text:'ğŸ“Š íš¨ìœ¨ì  í”„ë¡ í‹°ì–´ + 4ê°€ì§€ ìµœì í™” ì „ëµ ë¹„êµ',font:{size:13}},
    xaxis:{title:'ì—°ê°„ ë³€ë™ì„± (%)',range:[5,45]},
    yaxis:{title:'ì—°ê°„ ê¸°ëŒ€ìˆ˜ìµë¥  (%)',range:[-10,40]},
    legend:{orientation:'h',y:-0.15,font:{size:10}},
    margin:{l:60,r:20,t:50,b:70},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 6: RL ì‹¤í–‰ ì—”ì§„ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch6">Chapter 6. RL ì‹¤í–‰ ì—”ì§„ â€” PPO ì—ì´ì „íŠ¸ í†µí•©</h2>

<p>
R9ì—ì„œ PPO(Proximal Policy Optimization) ì—ì´ì „íŠ¸ë¥¼ êµ¬í˜„í–ˆë‹¤. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì—”ì§„ì´ "ë¬´ì—‡ì„ ì–¼ë§ˆë‚˜ ì‚¬ì•¼ í•˜ëŠ”ì§€" ê²°ì •í–ˆë‹¤ë©´, RL ì‹¤í–‰ ì—”ì§„ì€ "ì–¸ì œ, ì–´ë–»ê²Œ ì£¼ë¬¸ì„ ë„£ì„ì§€" ê²°ì •í•œë‹¤. ì´ê²ƒì´ ì‹¤í–‰ ìµœì í™”(execution optimization)ì˜ í•µì‹¬ì´ë‹¤.
</p>

<h3>6.1 ì‹¤í–‰ ë¬¸ì œì˜ ì •ì˜</h3>

<div class="def">
<strong>ğŸ“ ì‹¤í–‰ ìµœì í™” ë¬¸ì œ</strong><br><br>
ëª©í‘œ ë¹„ì¤‘ \(\mathbf{w}^*\)ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, í˜„ì¬ ë¹„ì¤‘ \(\mathbf{w}_t\)ì—ì„œ \(\mathbf{w}^*\)ë¡œ ì´ë™í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” <strong>ì‹œì¥ ì¶©ê²©(market impact)</strong>ê³¼ <strong>ê±°ë˜ ë¹„ìš©</strong>ì„ ìµœì†Œí™”í•˜ëŠ” ê²ƒì´ ëª©í‘œë‹¤.
</div>

<div class="eq">
\[
\min_{\{v_t\}} \sum_{t=1}^{T} \left[ \underbrace{\lambda \cdot v_t^2}_{\text{ì‹œì¥ ì¶©ê²©}} + \underbrace{c \cdot |v_t|}_{\text{ê±°ë˜ ë¹„ìš©}} + \underbrace{\sigma^2 (Q_t - Q^*)^2}_{\text{íƒ€ì´ë° ë¦¬ìŠ¤í¬}} \right]
\]
</div>

<p>
ì—¬ê¸°ì„œ \(v_t\)ëŠ” ì‹œì  \(t\)ì˜ ê±°ë˜ëŸ‰, \(Q_t\)ëŠ” ë‚¨ì€ ì£¼ë¬¸ëŸ‰, \(Q^*\)ëŠ” ëª©í‘œ ì£¼ë¬¸ëŸ‰ì´ë‹¤. RL ì—ì´ì „íŠ¸ëŠ” ì´ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ í•™ìŠµí•œë‹¤.
</p>

<h3>6.1.1 Almgren-Chriss ìµœì  ì‹¤í–‰ ëª¨ë¸ â€” í•´ì„ì  í•´</h3>

<p>
RL ì—ì´ì „íŠ¸ê°€ í•™ìŠµí•˜ëŠ” ë¬¸ì œì˜ í•´ì„ì  í•´ê°€ Almgren-Chriss (2001) ëª¨ë¸ì´ë‹¤. ì´ \(X\)ì£¼ë¥¼ \(T\) ê¸°ê°„ì— ê±¸ì³ ì‹¤í–‰í•  ë•Œ, ìµœì  ì‹¤í–‰ ê¶¤ì ì€:
</p>

<div class="eq">
\[
x_j^* = X \cdot \frac{\sinh\!\left(\kappa(T-t_j)\right)}{\sinh(\kappa T)}, \qquad
\kappa = \sqrt{\frac{\lambda \sigma^2}{\eta}}
\]
</div>

<p>
ì—¬ê¸°ì„œ \(\lambda\)ëŠ” ìœ„í—˜ íšŒí”¼ ê³„ìˆ˜, \(\sigma\)ëŠ” ê°€ê²© ë³€ë™ì„±, \(\eta\)ëŠ” ì¼ì‹œì  ì‹œì¥ ì¶©ê²© ê³„ìˆ˜ë‹¤. \(\kappa\)ê°€ í´ìˆ˜ë¡(ìœ„í—˜ íšŒí”¼ê°€ ê°•í• ìˆ˜ë¡) ì´ˆë°˜ì— ë¹ ë¥´ê²Œ ì‹¤í–‰í•˜ê³ , \(\kappa\)ê°€ ì‘ìœ¼ë©´ TWAPì— ê°€ê¹Œì›Œì§„ë‹¤.
</p>

<div class="info">
<strong>ğŸ’¡ Almgren-Chrissì˜ í•µì‹¬ í†µì°°</strong><br><br>
â€¢ <strong>ìœ„í—˜ íšŒí”¼ â†‘:</strong> ë¹¨ë¦¬ ì‹¤í–‰ â†’ ì‹œì¥ ì¶©ê²© ë¹„ìš© â†‘, íƒ€ì´ë° ë¦¬ìŠ¤í¬ â†“<br>
â€¢ <strong>ìœ„í—˜ íšŒí”¼ â†“:</strong> ì²œì²œíˆ ì‹¤í–‰ â†’ ì‹œì¥ ì¶©ê²© ë¹„ìš© â†“, íƒ€ì´ë° ë¦¬ìŠ¤í¬ â†‘<br>
â€¢ RL ì—ì´ì „íŠ¸ëŠ” ì´ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ë°ì´í„°ë¡œë¶€í„° í•™ìŠµí•˜ì—¬, ì‹œì¥ ìƒíƒœì— ë”°ë¼ ë™ì ìœ¼ë¡œ \(\kappa\)ë¥¼ ì¡°ì ˆí•˜ëŠ” ê²ƒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ë‚¸ë‹¤.
</div>

<h3>6.2 PPO ì‹¤í–‰ ì—ì´ì „íŠ¸ (R9 í†µí•©)</h3>

<div class="cc">Python â€” rl_executor.py</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> gymnasium <span class="kw">as</span> gym
<span class="kw">from</span> gymnasium <span class="kw">import</span> spaces
<span class="kw">from</span> stable_baselines3 <span class="kw">import</span> PPO

<span class="kw">class</span> <span class="fn">ExecutionEnv</span>(gym.Env):
    <span class="st">"""ì£¼ë¬¸ ì‹¤í–‰ í™˜ê²½ (R9 í™•ì¥)"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, total_shares=<span class="nu">1000</span>, n_steps=<span class="nu">20</span>,
                 impact_coeff=<span class="nu">0.001</span>, cost_per_share=<span class="nu">0.01</span>):
        <span class="fn">super</span>().<span class="fn">__init__</span>()
        <span class="nb">self</span>.total = total_shares
        <span class="nb">self</span>.n_steps = n_steps
        <span class="nb">self</span>.impact = impact_coeff
        <span class="nb">self</span>.cost = cost_per_share

        <span class="cm"># ìƒíƒœ: [ë‚¨ì€ ë¹„ìœ¨, ë‚¨ì€ ì‹œê°„ ë¹„ìœ¨, ë³€ë™ì„±, ìŠ¤í”„ë ˆë“œ]</span>
        <span class="nb">self</span>.observation_space = spaces.<span class="fn">Box</span>(
            low=<span class="nu">0</span>, high=<span class="nu">1</span>, shape=(<span class="nu">4</span>,), dtype=np.float32
        )
        <span class="cm"># í–‰ë™: ì´ë²ˆ ìŠ¤í…ì—ì„œ ì‹¤í–‰í•  ë¹„ìœ¨ [0, 1]</span>
        <span class="nb">self</span>.action_space = spaces.<span class="fn">Box</span>(
            low=<span class="nu">0</span>, high=<span class="nu">1</span>, shape=(<span class="nu">1</span>,), dtype=np.float32
        )

    <span class="kw">def</span> <span class="fn">reset</span>(<span class="nb">self</span>, seed=<span class="kw">None</span>, options=<span class="kw">None</span>):
        <span class="fn">super</span>().<span class="fn">reset</span>(seed=seed)
        <span class="nb">self</span>.remaining = <span class="nb">self</span>.total
        <span class="nb">self</span>.step_count = <span class="nu">0</span>
        <span class="nb">self</span>.total_cost = <span class="nu">0</span>
        obs = np.<span class="fn">array</span>([<span class="nu">1.0</span>, <span class="nu">1.0</span>, <span class="nu">0.02</span>, <span class="nu">0.001</span>], dtype=np.float32)
        <span class="kw">return</span> obs, {}

    <span class="kw">def</span> <span class="fn">step</span>(<span class="nb">self</span>, action):
        frac = <span class="fn">float</span>(np.<span class="fn">clip</span>(action[<span class="nu">0</span>], <span class="nu">0</span>, <span class="nu">1</span>))
        shares = <span class="fn">int</span>(frac * <span class="nb">self</span>.remaining)

        <span class="cm"># ì‹œì¥ ì¶©ê²© + ê±°ë˜ ë¹„ìš©</span>
        impact_cost = <span class="nb">self</span>.impact * shares ** <span class="nu">2</span>
        trade_cost = <span class="nb">self</span>.cost * shares
        step_cost = impact_cost + trade_cost

        <span class="nb">self</span>.remaining -= shares
        <span class="nb">self</span>.step_count += <span class="nu">1</span>
        <span class="nb">self</span>.total_cost += step_cost

        <span class="cm"># ë³´ìƒ: ë¹„ìš© ìµœì†Œí™” + ì™„ë£Œ ë³´ë„ˆìŠ¤</span>
        reward = -step_cost / <span class="nb">self</span>.total
        done = <span class="nb">self</span>.step_count >= <span class="nb">self</span>.n_steps
        <span class="kw">if</span> done <span class="kw">and</span> <span class="nb">self</span>.remaining > <span class="nu">0</span>:
            reward -= <span class="nu">0.5</span> * <span class="nb">self</span>.remaining / <span class="nb">self</span>.total  <span class="cm"># ë¯¸ì™„ë£Œ í˜ë„í‹°</span>

        time_frac = <span class="nu">1</span> - <span class="nb">self</span>.step_count / <span class="nb">self</span>.n_steps
        obs = np.<span class="fn">array</span>([
            <span class="nb">self</span>.remaining / <span class="nb">self</span>.total,
            time_frac,
            <span class="nu">0.02</span> + np.random.<span class="fn">randn</span>() * <span class="nu">0.005</span>,
            <span class="nu">0.001</span> + np.random.<span class="fn">rand</span>() * <span class="nu">0.002</span>
        ], dtype=np.float32)

        <span class="kw">return</span> obs, reward, done, <span class="kw">False</span>, {<span class="st">'total_cost'</span>: <span class="nb">self</span>.total_cost}
</pre>

<h3>6.3 PPO ì—ì´ì „íŠ¸ í•™ìŠµ</h3>

<div class="cc">Python â€” PPO í•™ìŠµ</div>
<pre>
<span class="cm"># PPO ì—ì´ì „íŠ¸ í•™ìŠµ (R9 ë°©ì‹)</span>
env = <span class="fn">ExecutionEnv</span>(total_shares=<span class="nu">1000</span>, n_steps=<span class="nu">20</span>)

agent = <span class="fn">PPO</span>(
    <span class="st">'MlpPolicy'</span>, env,
    learning_rate=<span class="nu">3e-4</span>,
    n_steps=<span class="nu">2048</span>,
    batch_size=<span class="nu">64</span>,
    n_epochs=<span class="nu">10</span>,
    gamma=<span class="nu">0.99</span>,
    clip_range=<span class="nu">0.2</span>,
    verbose=<span class="nu">0</span>,
    seed=<span class="nu">42</span>
)

agent.<span class="fn">learn</span>(total_timesteps=<span class="nu">100_000</span>)
<span class="fn">print</span>(<span class="st">"âœ… PPO ì‹¤í–‰ ì—ì´ì „íŠ¸ í•™ìŠµ ì™„ë£Œ"</span>)
</pre>

<h3>6.4 TWAP vs VWAP vs RL ë¹„êµ</h3>

<p>
ì „í†µì  ì‹¤í–‰ ì•Œê³ ë¦¬ì¦˜ì¸ TWAP(Time-Weighted Average Price)ê³¼ VWAP(Volume-Weighted Average Price)ì„ RL ì—ì´ì „íŠ¸ì™€ ë¹„êµí•œë‹¤.
</p>

<div class="info">
<strong>ğŸ’¡ ì‹¤í–‰ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ (R9 ë³µìŠµ)</strong><br><br>
â€¢ <strong>TWAP</strong>: ì‹œê°„ ê· ë“± ë¶„í• . ë§¤ ìŠ¤í… ë™ì¼ ìˆ˜ëŸ‰ ì‹¤í–‰. ë‹¨ìˆœí•˜ì§€ë§Œ ì‹œì¥ ìƒí™© ë¬´ì‹œ.<br>
â€¢ <strong>VWAP</strong>: ê±°ë˜ëŸ‰ í”„ë¡œíŒŒì¼ì— ë¹„ë¡€í•˜ì—¬ ì‹¤í–‰. ì‹œì¥ í‰ê·  ê°€ê²©ì— ê·¼ì ‘.<br>
â€¢ <strong>PPO Agent</strong>: ì‹œì¥ ìƒíƒœ(ë³€ë™ì„±, ìŠ¤í”„ë ˆë“œ, ë‚¨ì€ ìˆ˜ëŸ‰)ë¥¼ ê´€ì°°í•˜ì—¬ ë™ì ìœ¼ë¡œ ì‹¤í–‰ ì†ë„ ì¡°ì ˆ.
</div>

<!-- Plotly: RL ì—ì´ì „íŠ¸ ì‹¤í–‰ ë¹„êµ -->
<div class="tc">Figure 6.1 â€” TWAP vs VWAP vs PPO ì‹¤í–‰ ë¹„ìš© ë¹„êµ</div>
<div id="plot-ch6-execution" style="width:100%;height:450px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(606);
  var steps=20, x=[];
  var twapRem=[],vwapRem=[],ppoRem=[];
  var twapCost=[],vwapCost=[],ppoCost=[];
  var total=1000;
  var tr=total,vr=total,pr=total;
  var tc=0,vc=0,pc=0;
  for(var i=0;i<=steps;i++){
    x.push(i);
    twapRem.push(tr); vwapRem.push(vr); ppoRem.push(pr);
    twapCost.push(tc); vwapCost.push(vc); ppoCost.push(pc);
    if(i<steps){
      // TWAP: uniform
      var tw=total/steps;
      tc+=0.001*tw*tw+0.01*tw;
      tr-=tw;
      // VWAP: volume profile (U-shape)
      var vp=0.8+0.4*Math.abs(i/steps-0.5)*2;
      var vw=total*vp/12;
      vc+=0.001*vw*vw+0.01*vw;
      vr-=Math.min(vw,vr);
      // PPO: adaptive (more at start, less in middle, burst at end)
      var pf;
      if(i<5) pf=0.12+rng()*0.03;
      else if(i<15) pf=0.03+rng()*0.02;
      else pf=0.08+rng()*0.04;
      var pw=pr*pf;
      pc+=0.001*pw*pw+0.01*pw;
      pr-=pw;
    }
  }
  Plotly.newPlot('plot-ch6-execution',[
    {x:x,y:twapRem,type:'scatter',mode:'lines',name:'TWAP ì”ëŸ‰',line:{color:'#95a5a6',width:2}},
    {x:x,y:vwapRem,type:'scatter',mode:'lines',name:'VWAP ì”ëŸ‰',line:{color:'#3498db',width:2}},
    {x:x,y:ppoRem,type:'scatter',mode:'lines',name:'PPO ì”ëŸ‰',line:{color:'#2ecc71',width:2.5}},
    {x:x,y:twapCost,type:'scatter',mode:'lines',name:'TWAP ëˆ„ì ë¹„ìš©',line:{color:'#95a5a6',width:1.5,dash:'dot'},yaxis:'y2'},
    {x:x,y:vwapCost,type:'scatter',mode:'lines',name:'VWAP ëˆ„ì ë¹„ìš©',line:{color:'#3498db',width:1.5,dash:'dot'},yaxis:'y2'},
    {x:x,y:ppoCost,type:'scatter',mode:'lines',name:'PPO ëˆ„ì ë¹„ìš©',line:{color:'#2ecc71',width:1.5,dash:'dot'},yaxis:'y2'}
  ],{
    title:{text:'ğŸ“Š ì‹¤í–‰ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ: ì”ëŸ‰ ì†Œì§„ + ëˆ„ì  ë¹„ìš©',font:{size:13}},
    xaxis:{title:'ì‹¤í–‰ ìŠ¤í…'},
    yaxis:{title:'ë‚¨ì€ ì£¼ë¬¸ëŸ‰ (ì£¼)',side:'left'},
    yaxis2:{title:'ëˆ„ì  ë¹„ìš© ($)',overlaying:'y',side:'right',showgrid:false},
    legend:{orientation:'h',y:-0.18,font:{size:9}},
    margin:{l:60,r:60,t:50,b:70},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 7: ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch7">Chapter 7. ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆ â€” VaR, CVaR, ë“œë¡œë‹¤ìš´ ì œí•œ</h2>

<p>
"ìˆ˜ìµì€ ìŠ¤í‚¬ì´ê³ , ë¦¬ìŠ¤í¬ ê´€ë¦¬ëŠ” ìƒì¡´ì´ë‹¤." R2ì—ì„œ VaRì˜ ê°œë…ì„ ë°°ì› ê³ , R5ì—ì„œ ì‹œê³„ì—´ ë³€ë™ì„± ëª¨ë¸ë§ì„ ë‹¤ë¤˜ë‹¤. ì´ ì¥ì—ì„œëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ í¬ì§€ì…˜ì„ ëª¨ë‹ˆí„°ë§í•˜ê³ , ìœ„í—˜ í•œë„ë¥¼ ì´ˆê³¼í•˜ë©´ ìë™ìœ¼ë¡œ í¬ì§€ì…˜ì„ ì¶•ì†Œí•˜ëŠ” ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆì„ êµ¬ì¶•í•œë‹¤.
</p>

<h3>7.1 VaR (Value at Risk)</h3>

<p>
VaRëŠ” "ì£¼ì–´ì§„ ì‹ ë¢° ìˆ˜ì¤€ì—ì„œ ìµœëŒ€ ì†ì‹¤ ê°€ëŠ¥ ê¸ˆì•¡"ì„ ì˜ë¯¸í•œë‹¤. 95% VaR = -2.3%ë¼ë©´, 95% í™•ë¥ ë¡œ ì¼ê°„ ì†ì‹¤ì´ 2.3%ë¥¼ ë„˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì´ë‹¤.
</p>

<div class="eq">
\[
\text{VaR}_\alpha = -\inf\{x : P(L \leq x) \geq \alpha\} = -F_L^{-1}(\alpha)
\]
</div>

<h3>7.2 CVaR (Conditional VaR / Expected Shortfall)</h3>

<p>
CVaRëŠ” VaRë¥¼ ì´ˆê³¼í•˜ëŠ” ì†ì‹¤ì˜ í‰ê· ì´ë‹¤. "ìµœì•…ì˜ 5% ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ í‰ê·  ì–¼ë§ˆë‚˜ ìƒëŠ”ê°€?"ë¥¼ ë‹µí•œë‹¤. VaRë³´ë‹¤ ê¼¬ë¦¬ ìœ„í—˜(tail risk)ì„ ë” ì˜ í¬ì°©í•œë‹¤.
</p>

<div class="eq">
\[
\text{CVaR}_\alpha = -\frac{1}{1-\alpha}\int_\alpha^1 F_L^{-1}(u)\,du
= \mathbb{E}[L \mid L \geq \text{VaR}_\alpha]
\]
</div>

<h3>7.2.1 Cornish-Fisher VaR â€” ë¹„ì •ê·œ ë¶„í¬ ë³´ì •</h3>

<p>
ê¸ˆìœµ ìˆ˜ìµë¥ ì€ ì •ê·œë¶„í¬ê°€ ì•„ë‹ˆë‹¤. ì™œë„(skewness)ì™€ ì²¨ë„(kurtosis)ê°€ ì¡´ì¬í•œë‹¤. Cornish-Fisher í™•ì¥ì€ ì´ë¥¼ ë³´ì •í•œë‹¤:
</p>

<div class="eq">
\[
z_{CF} = z_\alpha + \frac{1}{6}(z_\alpha^2 - 1)S + \frac{1}{24}(z_\alpha^3 - 3z_\alpha)(K-3) - \frac{1}{36}(2z_\alpha^3 - 5z_\alpha)S^2
\]
</div>

<p>
ì—¬ê¸°ì„œ \(z_\alpha\)ëŠ” ì •ê·œë¶„í¬ ë¶„ìœ„ìˆ˜, \(S\)ëŠ” ì™œë„, \(K\)ëŠ” ì²¨ë„ë‹¤. ì´ ë³´ì •ëœ \(z_{CF}\)ë¥¼ ì‚¬ìš©í•˜ë©´:
</p>

<div class="eq">
\[
\text{VaR}_{CF} = -(\mu + z_{CF} \cdot \sigma)
\]
</div>

<div class="cc">Python â€” Cornish-Fisher VaR</div>
<pre>
<span class="kw">from</span> scipy.stats <span class="kw">import</span> norm, skew, kurtosis

<span class="kw">def</span> <span class="fn">cornish_fisher_var</span>(returns, alpha=<span class="nu">0.95</span>):
    <span class="st">"""Cornish-Fisher ë³´ì • VaR"""</span>
    mu = returns.<span class="fn">mean</span>()
    sigma = returns.<span class="fn">std</span>()
    S = <span class="fn">skew</span>(returns)
    K = <span class="fn">kurtosis</span>(returns, fisher=<span class="kw">False</span>)  <span class="cm"># excess=False â†’ ì¼ë°˜ ì²¨ë„</span>
    z = norm.<span class="fn">ppf</span>(<span class="nu">1</span> - alpha)

    <span class="cm"># Cornish-Fisher í™•ì¥</span>
    z_cf = z + (<span class="nu">1</span>/<span class="nu">6</span>)*(z**<span class="nu">2</span> - <span class="nu">1</span>)*S \
         + (<span class="nu">1</span>/<span class="nu">24</span>)*(z**<span class="nu">3</span> - <span class="nu">3</span>*z)*(K - <span class="nu">3</span>) \
         - (<span class="nu">1</span>/<span class="nu">36</span>)*(<span class="nu">2</span>*z**<span class="nu">3</span> - <span class="nu">5</span>*z)*S**<span class="nu">2</span>

    <span class="kw">return</span> -(mu + z_cf * sigma)

<span class="cm"># ë¹„êµ</span>
<span class="fn">print</span>(<span class="st">f"ì •ê·œ VaR:         {parametric_var:.4%}"</span>)
<span class="fn">print</span>(<span class="st">f"Cornish-Fisher VaR: {cornish_fisher_var(returns):.4%}"</span>)
<span class="fn">print</span>(<span class="st">f"Historical VaR:    {historical_var:.4%}"</span>)
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ì •ê·œ VaR:         2.14%
Cornish-Fisher VaR: 2.58%   â† ê¼¬ë¦¬ ìœ„í—˜ ë°˜ì˜ìœ¼ë¡œ ë” ë³´ìˆ˜ì 
Historical VaR:    2.47%
</div>

<div class="info">
<strong>ğŸ’¡ ì™œ Cornish-Fisherê°€ ì¤‘ìš”í•œê°€?</strong><br><br>
ì •ê·œë¶„í¬ ê°€ì •ì˜ VaRëŠ” ê¼¬ë¦¬ ìœ„í—˜ì„ ê³¼ì†Œí‰ê°€í•œë‹¤. ê¸ˆìœµ ìˆ˜ìµë¥ ì˜ ì²¨ë„ëŠ” ë³´í†µ 3ë³´ë‹¤ í¬ê³ (fat tails), ì™œë„ëŠ” ìŒìˆ˜(left skew)ë‹¤. Cornish-Fisher ë³´ì •ì€ ì´ ë¹„ëŒ€ì¹­ì„±ì„ ë°˜ì˜í•˜ì—¬ ë” í˜„ì‹¤ì ì¸ ìœ„í—˜ ì¶”ì •ì¹˜ë¥¼ ì œê³µí•œë‹¤. 2008ë…„ ê¸ˆìœµìœ„ê¸°, 2020ë…„ ì½”ë¡œë‚˜ í­ë½ ê°™ì€ ê·¹ë‹¨ì  ì‚¬ê±´ì—ì„œ ì •ê·œ VaRëŠ” ì‹¤ì œ ì†ì‹¤ì„ í¬ê²Œ ê³¼ì†Œí‰ê°€í–ˆë‹¤.
</div>

<h3>7.3 ë¦¬ìŠ¤í¬ ê´€ë¦¬ í´ë˜ìŠ¤</h3>

<div class="cc">Python â€” risk_manager.py</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> pandas <span class="kw">as</span> pd

<span class="kw">class</span> <span class="fn">RiskManager</span>:
    <span class="st">"""ì‹¤ì‹œê°„ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆ
    VaR, CVaR, ë“œë¡œë‹¤ìš´ ì œí•œ, í¬ì§€ì…˜ í•œë„
    """</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, config=<span class="kw">None</span>):
        <span class="nb">self</span>.config = config <span class="kw">or</span> {
            <span class="st">'var_confidence'</span>: <span class="nu">0.95</span>,
            <span class="st">'var_limit'</span>: <span class="nu">0.03</span>,        <span class="cm"># ì¼ê°„ VaR í•œë„ 3%</span>
            <span class="st">'cvar_limit'</span>: <span class="nu">0.05</span>,       <span class="cm"># CVaR í•œë„ 5%</span>
            <span class="st">'max_drawdown'</span>: <span class="nu">0.15</span>,     <span class="cm"># ìµœëŒ€ ë“œë¡œë‹¤ìš´ 15%</span>
            <span class="st">'max_position'</span>: <span class="nu">0.25</span>,     <span class="cm"># ë‹¨ì¼ ì¢…ëª© ìµœëŒ€ 25%</span>
            <span class="st">'max_leverage'</span>: <span class="nu">1.0</span>,      <span class="cm"># ìµœëŒ€ ë ˆë²„ë¦¬ì§€ 1x</span>
        }
        <span class="nb">self</span>.peak_value = <span class="nu">0</span>
        <span class="nb">self</span>.alerts = []

    <span class="kw">def</span> <span class="fn">compute_var</span>(<span class="nb">self</span>, returns, method=<span class="st">'historical'</span>):
        <span class="st">"""VaR ê³„ì‚° (R2 ë°©ì‹)"""</span>
        alpha = <span class="nb">self</span>.config[<span class="st">'var_confidence'</span>]
        <span class="kw">if</span> method == <span class="st">'historical'</span>:
            var = -np.<span class="fn">percentile</span>(returns, (<span class="nu">1</span> - alpha) * <span class="nu">100</span>)
        <span class="kw">elif</span> method == <span class="st">'parametric'</span>:
            <span class="kw">from</span> scipy.stats <span class="kw">import</span> norm
            var = -(returns.<span class="fn">mean</span>() + norm.<span class="fn">ppf</span>(<span class="nu">1</span> - alpha) * returns.<span class="fn">std</span>())
        <span class="kw">return</span> var

    <span class="kw">def</span> <span class="fn">compute_cvar</span>(<span class="nb">self</span>, returns):
        <span class="st">"""CVaR (Expected Shortfall)"""</span>
        var = <span class="nb">self</span>.<span class="fn">compute_var</span>(returns)
        cvar = -returns[returns <= -var].<span class="fn">mean</span>()
        <span class="kw">return</span> cvar

    <span class="kw">def</span> <span class="fn">check_drawdown</span>(<span class="nb">self</span>, portfolio_value):
        <span class="st">"""ë“œë¡œë‹¤ìš´ ì²´í¬"""</span>
        <span class="nb">self</span>.peak_value = <span class="fn">max</span>(<span class="nb">self</span>.peak_value, portfolio_value)
        dd = (<span class="nb">self</span>.peak_value - portfolio_value) / <span class="nb">self</span>.peak_value
        <span class="kw">return</span> dd

    <span class="kw">def</span> <span class="fn">validate_order</span>(<span class="nb">self</span>, weights, returns_history):
        <span class="st">"""ì£¼ë¬¸ ì „ ë¦¬ìŠ¤í¬ ê²€ì¦ â€” í†µê³¼/ê±°ë¶€ íŒë‹¨"""</span>
        signals = {<span class="st">'approved'</span>: <span class="kw">True</span>, <span class="st">'warnings'</span>: []}

        <span class="cm"># 1) í¬ì§€ì…˜ í•œë„ ì²´í¬</span>
        <span class="kw">if</span> np.<span class="fn">max</span>(np.<span class="fn">abs</span>(weights)) > <span class="nb">self</span>.config[<span class="st">'max_position'</span>]:
            signals[<span class="st">'warnings'</span>].<span class="fn">append</span>(<span class="st">'âš ï¸ ë‹¨ì¼ ì¢…ëª© í•œë„ ì´ˆê³¼'</span>)

        <span class="cm"># 2) VaR ì²´í¬</span>
        port_ret = returns_history @ weights
        var = <span class="nb">self</span>.<span class="fn">compute_var</span>(port_ret)
        <span class="kw">if</span> var > <span class="nb">self</span>.config[<span class="st">'var_limit'</span>]:
            signals[<span class="st">'warnings'</span>].<span class="fn">append</span>(<span class="st">f'ğŸ”´ VaR {var:.2%} > í•œë„ {self.config["var_limit"]:.2%}'</span>)
            signals[<span class="st">'approved'</span>] = <span class="kw">False</span>

        <span class="cm"># 3) CVaR ì²´í¬</span>
        cvar = <span class="nb">self</span>.<span class="fn">compute_cvar</span>(port_ret)
        <span class="kw">if</span> cvar > <span class="nb">self</span>.config[<span class="st">'cvar_limit'</span>]:
            signals[<span class="st">'warnings'</span>].<span class="fn">append</span>(<span class="st">f'ğŸ”´ CVaR {cvar:.2%} > í•œë„ {self.config["cvar_limit"]:.2%}'</span>)
            signals[<span class="st">'approved'</span>] = <span class="kw">False</span>

        <span class="cm"># 4) ë ˆë²„ë¦¬ì§€ ì²´í¬</span>
        leverage = np.<span class="fn">sum</span>(np.<span class="fn">abs</span>(weights))
        <span class="kw">if</span> leverage > <span class="nb">self</span>.config[<span class="st">'max_leverage'</span>]:
            signals[<span class="st">'warnings'</span>].<span class="fn">append</span>(<span class="st">f'âš ï¸ ë ˆë²„ë¦¬ì§€ {leverage:.2f}x > í•œë„'</span>)

        <span class="kw">return</span> signals
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ğŸ“Š ë¦¬ìŠ¤í¬ ê²€ì¦ ê²°ê³¼:
  VaR (95%): 2.14%  âœ… (í•œë„: 3.00%)
  CVaR (95%): 3.28%  âœ… (í•œë„: 5.00%)
  ìµœëŒ€ í¬ì§€ì…˜: 22.1%  âœ… (í•œë„: 25.0%)
  ë ˆë²„ë¦¬ì§€: 1.00x  âœ…
  â†’ ì£¼ë¬¸ ìŠ¹ì¸ âœ…
</div>

<!-- Plotly: VaR ë¶„í¬ -->
<div class="tc">Figure 7.1 â€” í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ìµë¥  ë¶„í¬ + VaR/CVaR ì‹œê°í™”</div>
<div id="plot-ch7-var" style="width:100%;height:450px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(707);
  // Generate portfolio returns (slightly fat-tailed)
  var rets=[];
  for(var i=0;i<2000;i++){
    var u1=rng(),u2=rng();
    var z=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);
    // Add fat tails via mixture
    if(rng()<0.05) z*=2.5;
    rets.push(0.0003+z*0.015);
  }
  rets.sort(function(a,b){return a-b;});
  var var95=-rets[Math.floor(0.05*rets.length)];
  var cvarVals=rets.filter(function(r){return r<=-var95;});
  var cvar95=-cvarVals.reduce(function(a,b){return a+b;},0)/cvarVals.length;

  Plotly.newPlot('plot-ch7-var',[
    {x:rets,type:'histogram',nbinsx:80,name:'ìˆ˜ìµë¥  ë¶„í¬',
     marker:{color:'rgba(52,152,219,0.6)',line:{width:0.5,color:'#2980b9'}}},
    {x:[-var95,-var95],y:[0,120],type:'scatter',mode:'lines',name:'VaR 95% = '+(-var95*100).toFixed(2)+'%',
     line:{color:'#e74c3c',width:3,dash:'dash'}},
    {x:[-cvar95,-cvar95],y:[0,120],type:'scatter',mode:'lines',name:'CVaR 95% = '+(-cvar95*100).toFixed(2)+'%',
     line:{color:'#c0392b',width:3}}
  ],{
    title:{text:'ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ì¼ê°„ ìˆ˜ìµë¥  ë¶„í¬ + VaR / CVaR',font:{size:13}},
    xaxis:{title:'ì¼ê°„ ìˆ˜ìµë¥ ',tickformat:'.1%'},
    yaxis:{title:'ë¹ˆë„'},
    shapes:[{type:'rect',x0:rets[0],x1:-var95,y0:0,y1:120,
      fillcolor:'rgba(231,76,60,0.15)',line:{width:0}}],
    annotations:[{x:(-var95-cvar95)/2,y:100,text:'ê¼¬ë¦¬ ìœ„í—˜<br>(Tail Risk)',
      showarrow:false,font:{size:10,color:'#c0392b'}}],
    legend:{orientation:'h',y:-0.15},
    margin:{l:60,r:20,t:50,b:60},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 8: ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch8">Chapter 8. ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ â€” Walk-Forward + ê±°ë˜ë¹„ìš© + ìŠ¬ë¦¬í”¼ì§€</h2>

<p>
"ë°±í…ŒìŠ¤íŠ¸ì—ì„œ ëˆ ë²„ëŠ” ì „ëµì€ ë§ë‹¤. ì‹¤ì „ì—ì„œ ëˆ ë²„ëŠ” ì „ëµì€ ë“œë¬¼ë‹¤." ì´ ê°„ê·¹ì„ ì¤„ì´ëŠ” ê²ƒì´ ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ì˜ ëª©í‘œë‹¤. R4ì—ì„œ TimeSeriesSplitì„ ë°°ì› ê³ , R9ì—ì„œ ìŠ¬ë¦¬í”¼ì§€ì™€ ì‹œì¥ ì¶©ê²©ì„ ë‹¤ë¤˜ë‹¤. ì´ ì¥ì—ì„œëŠ” í˜„ì‹¤ì ì¸ ë°±í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ êµ¬ì¶•í•œë‹¤.
</p>

<h3>8.1 Walk-Forward ê²€ì¦</h3>

<p>
Walk-ForwardëŠ” ì‹œê³„ì—´ ë°ì´í„°ì—ì„œ ê°€ì¥ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²€ì¦ ë°©ë²•ì´ë‹¤. í•™ìŠµ ìœˆë„ìš°ë¥¼ ì•ìœ¼ë¡œ ì´ë™ì‹œí‚¤ë©´ì„œ ë°˜ë³µ ê²€ì¦í•œë‹¤.
</p>

<div class="def">
<strong>ğŸ“ Walk-Forward í”„ë¡œí† ì½œ</strong><br><br>
Period 1: Train [2019] â†’ Test [2020-Q1]<br>
Period 2: Train [2019~2020-Q1] â†’ Test [2020-Q2]<br>
Period 3: Train [2019~2020-Q2] â†’ Test [2020-Q3]<br>
...<br>
ê° ê¸°ê°„ì—ì„œ ëª¨ë¸ì„ ì¬í•™ìŠµí•˜ê³ , í…ŒìŠ¤íŠ¸ ê¸°ê°„ì˜ ì„±ê³¼ë¥¼ ê¸°ë¡í•œë‹¤.
</div>

<h3>8.2 ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ í´ë˜ìŠ¤</h3>

<div class="cc">Python â€” backtest_engine.py</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> pandas <span class="kw">as</span> pd

<span class="kw">class</span> <span class="fn">BacktestEngine</span>:
    <span class="st">"""Walk-Forward ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„
    ê±°ë˜ë¹„ìš©, ìŠ¬ë¦¬í”¼ì§€, ë¦¬ë°¸ëŸ°ì‹± í¬í•¨
    """</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, returns, initial_capital=<span class="nu">1_000_000</span>):
        <span class="nb">self</span>.returns = returns
        <span class="nb">self</span>.capital = initial_capital
        <span class="nb">self</span>.results = <span class="kw">None</span>

    <span class="kw">def</span> <span class="fn">run</span>(<span class="nb">self</span>, weights_series, cost_bps=<span class="nu">10</span>, slippage_bps=<span class="nu">5</span>):
        <span class="st">"""ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        weights_series: DatetimeIndex, ê° ë‚ ì§œì˜ ëª©í‘œ ë¹„ì¤‘
        cost_bps: ê±°ë˜ ë¹„ìš© (basis points)
        slippage_bps: ìŠ¬ë¦¬í”¼ì§€ (basis points)
        """</span>
        cost_rate = cost_bps / <span class="nu">10000</span>
        slip_rate = slippage_bps / <span class="nu">10000</span>

        dates = <span class="nb">self</span>.returns.index
        pv = [<span class="nb">self</span>.capital]
        turnover = []
        costs = []
        prev_w = np.<span class="fn">zeros</span>(<span class="nb">self</span>.returns.shape[<span class="nu">1</span>])

        <span class="kw">for</span> i, date <span class="kw">in</span> <span class="fn">enumerate</span>(dates):
            <span class="kw">if</span> date <span class="kw">in</span> weights_series.index:
                target_w = weights_series.<span class="fn">loc</span>[date].<span class="fn">values</span>
            <span class="kw">else</span>:
                target_w = prev_w

            <span class="cm"># í„´ì˜¤ë²„ = ë¹„ì¤‘ ë³€í™”ì˜ ì ˆëŒ€ê°’ í•©</span>
            to = np.<span class="fn">sum</span>(np.<span class="fn">abs</span>(target_w - prev_w))
            turnover.<span class="fn">append</span>(to)

            <span class="cm"># ê±°ë˜ ë¹„ìš© + ìŠ¬ë¦¬í”¼ì§€</span>
            trade_cost = to * (cost_rate + slip_rate) * pv[-<span class="nu">1</span>]
            costs.<span class="fn">append</span>(trade_cost)

            <span class="cm"># í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ìµë¥ </span>
            port_ret = np.<span class="fn">dot</span>(target_w, <span class="nb">self</span>.returns.<span class="fn">iloc</span>[i].<span class="fn">values</span>)
            new_pv = pv[-<span class="nu">1</span>] * (<span class="nu">1</span> + port_ret) - trade_cost
            pv.<span class="fn">append</span>(new_pv)
            prev_w = target_w

        <span class="nb">self</span>.results = pd.<span class="fn">DataFrame</span>({
            <span class="st">'portfolio_value'</span>: pv[<span class="nu">1</span>:],
            <span class="st">'turnover'</span>: turnover,
            <span class="st">'costs'</span>: costs
        }, index=dates)

        <span class="kw">return</span> <span class="nb">self</span>
</pre>

<h3>8.3 ìŠ¬ë¦¬í”¼ì§€ ëª¨ë¸</h3>

<p>
R9ì—ì„œ ë°°ìš´ ê²ƒì²˜ëŸ¼, ìŠ¬ë¦¬í”¼ì§€ëŠ” ì£¼ë¬¸ í¬ê¸°ì™€ ì‹œì¥ ìœ ë™ì„±ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ì„ í˜• + ì œê³±ê·¼ ëª¨ë¸ì´ ì‹¤ë¬´ì—ì„œ ë§ì´ ì“°ì¸ë‹¤.
</p>

<div class="eq">
\[
\text{Slippage}(v) = \underbrace{\eta \cdot \sigma \cdot \sqrt{\frac{v}{V}}}_{\text{ì‹œì¥ ì¶©ê²©}} + \underbrace{\frac{s}{2}}_{\text{ìŠ¤í”„ë ˆë“œ ë¹„ìš©}}
\]
</div>

<p>
ì—¬ê¸°ì„œ \(v\)ëŠ” ì£¼ë¬¸ëŸ‰, \(V\)ëŠ” ì¼í‰ê·  ê±°ë˜ëŸ‰, \(\sigma\)ëŠ” ë³€ë™ì„±, \(s\)ëŠ” bid-ask ìŠ¤í”„ë ˆë“œ, \(\eta\)ëŠ” ì¶©ê²© ê³„ìˆ˜ë‹¤.
</p>

<h3>8.4 ë°±í…ŒìŠ¤íŠ¸ì˜ 7ê°€ì§€ í•¨ì •</h3>

<div class="warn">
<strong>âš ï¸ ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë§¹ì‹ í•˜ì§€ ë§ˆë¼ â€” 7 Deadly Sins of Backtesting</strong><br><br>
<strong>1. ìƒì¡´ì í¸í–¥:</strong> ìƒí ì¢…ëª© ë¯¸í¬í•¨ â†’ ì„±ê³¼ ê³¼ëŒ€ ì¶”ì •<br>
<strong>2. ì „ë°© ì°¸ì¡°:</strong> ë¯¸ë˜ ë°ì´í„° ëˆ„ì¶œ â†’ ë¹„í˜„ì‹¤ì  ì„±ê³¼<br>
<strong>3. ê±°ë˜ ë¹„ìš© ë¬´ì‹œ:</strong> ë¹„ìš© ë¯¸ë°˜ì˜ â†’ ì‹¤ì „ ì„±ê³¼ ê¸‰ë½<br>
<strong>4. ìŠ¬ë¦¬í”¼ì§€ ë¬´ì‹œ:</strong> ëŒ€ëŸ‰ ì£¼ë¬¸ì˜ ì‹œì¥ ì¶©ê²© ë¯¸ë°˜ì˜<br>
<strong>5. ê³¼ìµœì í™”:</strong> íŒŒë¼ë¯¸í„°ë¥¼ ê³¼ê±°ì— ë§ì¶° íŠœë‹ â†’ ë¯¸ë˜ì— ë¬´ë ¥<br>
<strong>6. ì²´ë¦¬í”¼í‚¹:</strong> ì¢‹ì€ êµ¬ê°„ë§Œ ì„ íƒì ìœ¼ë¡œ ë³´ì—¬ì¤Œ<br>
<strong>7. ìœ ë™ì„± ë¬´ì‹œ:</strong> ê±°ë˜ëŸ‰ ë¶€ì¡± ì¢…ëª©ì—ì„œ ë¹„í˜„ì‹¤ì  ì²´ê²° ê°€ì •
</div>

<h3>8.5 í†µê³„ì  ìœ ì˜ì„± ê²€ì • â€” ì „ëµì´ ì§„ì§œ ì•ŒíŒŒë¥¼ ê°€ì§€ëŠ”ê°€?</h3>

<p>
ë°±í…ŒìŠ¤íŠ¸ ìƒ¤í”„ ë¹„ìœ¨ì´ 1.0ì´ë¼ê³  í•´ì„œ ì „ëµì´ ìœ ì˜ë¯¸í•œ ê²ƒì€ ì•„ë‹ˆë‹¤. ìš°ì—°ì˜ ê²°ê³¼ì¼ ìˆ˜ ìˆë‹¤. í†µê³„ì  ê²€ì •ì´ í•„ìš”í•˜ë‹¤:
</p>

<div class="eq">
\[
t = \frac{\hat{SR}}{\sqrt{\frac{1 + \frac{\hat{\gamma}_3}{2}\hat{SR} + \frac{\hat{\gamma}_4 - 1}{4}\hat{SR}^2}{T}}}
\]
</div>

<p>
ì—¬ê¸°ì„œ \(\hat{SR}\)ì€ ì¶”ì • ìƒ¤í”„ ë¹„ìœ¨, \(T\)ëŠ” ê´€ì¸¡ ìˆ˜, \(\hat{\gamma}_3\)ì€ ì™œë„, \(\hat{\gamma}_4\)ëŠ” ì²¨ë„ë‹¤. ì´ \(t\)-í†µê³„ëŸ‰ì´ 1.96 ì´ìƒì´ë©´ 95% ì‹ ë¢° ìˆ˜ì¤€ì—ì„œ ìœ ì˜í•˜ë‹¤. Lo (2002)ì˜ ê²°ê³¼ì— ë”°ë¥´ë©´, ì—°ê°„ ìƒ¤í”„ ë¹„ìœ¨ 1.0ë„ 5ë…„ ë°ì´í„°ì—ì„œëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
</p>

<div class="cc">Python â€” ìƒ¤í”„ ë¹„ìœ¨ ìœ ì˜ì„± ê²€ì •</div>
<pre>
<span class="kw">def</span> <span class="fn">sharpe_tstat</span>(returns, rf=<span class="nu">0.04</span>/<span class="nu">252</span>):
    <span class="st">"""Lo (2002) ë³´ì • ìƒ¤í”„ ë¹„ìœ¨ t-í†µê³„ëŸ‰"""</span>
    excess = returns - rf
    sr = excess.<span class="fn">mean</span>() / excess.<span class="fn">std</span>()  <span class="cm"># ì¼ê°„ SR</span>
    T = <span class="fn">len</span>(returns)
    gamma3 = <span class="fn">skew</span>(excess)
    gamma4 = <span class="fn">kurtosis</span>(excess, fisher=<span class="kw">False</span>)

    se = np.<span class="fn">sqrt</span>((<span class="nu">1</span> + <span class="nu">0.5</span>*gamma3*sr + (gamma4-<span class="nu">1</span>)/<span class="nu">4</span>*sr**<span class="nu">2</span>) / T)
    t_stat = sr / se
    <span class="kw">return</span> t_stat, sr * np.<span class="fn">sqrt</span>(<span class="nu">252</span>)  <span class="cm"># ì—°ìœ¨í™” SR</span>

t, annual_sr = <span class="fn">sharpe_tstat</span>(strategy_returns)
<span class="fn">print</span>(<span class="st">f"ì—°ìœ¨í™” Sharpe: {annual_sr:.3f}"</span>)
<span class="fn">print</span>(<span class="st">f"t-í†µê³„ëŸ‰: {t:.3f} {'âœ… ìœ ì˜' if t > 1.96 else 'âŒ ë¹„ìœ ì˜'}"</span>)
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ì—°ìœ¨í™” Sharpe: 1.017
t-í†µê³„ëŸ‰: 2.341 âœ… ìœ ì˜ (p < 0.05)
</div>

<!-- Plotly: Walk-Forward ì—ì¿¼í‹° ì»¤ë¸Œ -->
<div class="tc">Figure 8.1 â€” Walk-Forward ë°±í…ŒìŠ¤íŠ¸ ì—ì¿¼í‹° ì»¤ë¸Œ</div>
<div id="plot-ch8-equity" style="width:100%;height:480px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(808);
  var N=500, days=[];
  var strategy=[1.0], benchmark=[1.0], noCost=[1.0];
  for(var i=0;i<N;i++){
    days.push('2020-01-02');  // placeholder
    var mkt=(rng()-0.48)*0.02;
    var alpha=(rng()-0.45)*0.005;
    var cost=0.0015*(rng()>0.8?1:0); // rebalance cost
    benchmark.push(benchmark[i]*(1+mkt));
    noCost.push(noCost[i]*(1+mkt+alpha));
    strategy.push(strategy[i]*(1+mkt+alpha-cost));
  }
  // Create proper date labels
  var dateLabels=[];
  var d=new Date(2020,0,2);
  for(var i=0;i<=N;i++){
    dateLabels.push(d.toISOString().slice(0,10));
    d.setDate(d.getDate()+1);
    if(d.getDay()===0) d.setDate(d.getDate()+1);
    if(d.getDay()===6) d.setDate(d.getDate()+2);
  }
  // Drawdown
  var dd=[];
  var peak=strategy[0];
  for(var i=0;i<=N;i++){
    if(strategy[i]>peak) peak=strategy[i];
    dd.push((strategy[i]-peak)/peak);
  }
  Plotly.newPlot('plot-ch8-equity',[
    {x:dateLabels,y:benchmark,type:'scatter',mode:'lines',name:'ë²¤ì¹˜ë§ˆí¬ (Buy&Hold)',line:{color:'#95a5a6',width:1.5}},
    {x:dateLabels,y:noCost,type:'scatter',mode:'lines',name:'ì „ëµ (ë¹„ìš© ë¯¸ë°˜ì˜)',line:{color:'#3498db',width:1.5,dash:'dot'}},
    {x:dateLabels,y:strategy,type:'scatter',mode:'lines',name:'ì „ëµ (ë¹„ìš© ë°˜ì˜)',line:{color:'#2ecc71',width:2.5}},
    {x:dateLabels,y:dd,type:'scatter',mode:'lines',name:'ë“œë¡œë‹¤ìš´',line:{color:'#e74c3c',width:1},fill:'tozeroy',fillcolor:'rgba(231,76,60,0.1)',yaxis:'y2'}
  ],{
    title:{text:'ğŸ“Š Walk-Forward ë°±í…ŒìŠ¤íŠ¸: ì—ì¿¼í‹° ì»¤ë¸Œ + ë“œë¡œë‹¤ìš´',font:{size:13}},
    xaxis:{title:'ë‚ ì§œ',tickangle:-30},
    yaxis:{title:'í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ (ì •ê·œí™”)',side:'left'},
    yaxis2:{title:'ë“œë¡œë‹¤ìš´',overlaying:'y',side:'right',showgrid:false,tickformat:'.0%',range:[-0.25,0.05]},
    legend:{orientation:'h',y:-0.2,font:{size:10}},
    margin:{l:60,r:60,t:50,b:80},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 9: ì„±ê³¼ í‰ê°€ + ë¦¬í¬íŠ¸ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch9">Chapter 9. ì„±ê³¼ í‰ê°€ + ë¦¬í¬íŠ¸ ìƒì„±</h2>

<p>
R1ì—ì„œ ìƒ¤í”„ ë¹„ìœ¨ì„ ì²˜ìŒ ê³„ì‚°í–ˆë˜ ê²ƒì„ ê¸°ì–µí•˜ëŠ”ê°€? ì´ì œ ê·¸ ë‹¨ìˆœí•œ ì§€í‘œë¥¼ ë„˜ì–´, ì „ë¬¸ í€€íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ì¢…í•© ì„±ê³¼ ì§€í‘œ ì²´ê³„ë¥¼ êµ¬ì¶•í•œë‹¤. ì†Œë¥´í‹°ë…¸, ì¹¼ë§ˆ, ì •ë³´ ë¹„ìœ¨, ìµœëŒ€ ë“œë¡œë‹¤ìš´ â€” ì´ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ì˜ ë¦¬í¬íŠ¸ë¡œ í†µí•©í•œë‹¤.
</p>

<h3>9.1 í•µì‹¬ ì„±ê³¼ ì§€í‘œ</h3>

<table>
<tr><th>ì§€í‘œ</th><th>ìˆ˜ì‹</th><th>ì˜ë¯¸</th><th>ê´€ë ¨ Round</th></tr>
<tr><td>Sharpe Ratio</td><td>\(\frac{\mu - r_f}{\sigma}\)</td><td>ìœ„í—˜ ëŒ€ë¹„ ì´ˆê³¼ìˆ˜ìµ</td><td>R1</td></tr>
<tr><td>Sortino Ratio</td><td>\(\frac{\mu - r_f}{\sigma_{\text{down}}}\)</td><td>í•˜ë°© ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ</td><td>R2</td></tr>
<tr><td>Calmar Ratio</td><td>\(\frac{\mu}{\text{MDD}}\)</td><td>ë“œë¡œë‹¤ìš´ ëŒ€ë¹„ ìˆ˜ìµ</td><td>R5</td></tr>
<tr><td>Information Ratio</td><td>\(\frac{\mu_\alpha}{\sigma_\alpha}\)</td><td>ë²¤ì¹˜ë§ˆí¬ ëŒ€ë¹„ ì´ˆê³¼ìˆ˜ìµ ì•ˆì •ì„±</td><td>R4</td></tr>
<tr><td>Max Drawdown</td><td>\(\max_t \frac{\text{Peak}_t - \text{Value}_t}{\text{Peak}_t}\)</td><td>ìµœëŒ€ ê³ ì  ëŒ€ë¹„ í•˜ë½í­</td><td>R5</td></tr>
<tr><td>Win Rate</td><td>\(\frac{\text{ìˆ˜ìµ ê±°ë˜ì¼}}{\text{ì „ì²´ ê±°ë˜ì¼}}\)</td><td>ìˆ˜ìµ ë°œìƒ í™•ë¥ </td><td>R1</td></tr>
<tr><td>Profit Factor</td><td>\(\frac{\sum \text{ì´ìµ}}{\sum |\text{ì†ì‹¤}|}\)</td><td>ì´ì´ìµ / ì´ì†ì‹¤</td><td>R1</td></tr>
</table>

<h3>9.1.1 ìƒ¤í”„ ë¹„ìœ¨ì˜ í•œê³„ì™€ ëŒ€ì•ˆ ì§€í‘œ</h3>

<p>
ìƒ¤í”„ ë¹„ìœ¨ì€ ê°€ì¥ ë„ë¦¬ ì“°ì´ì§€ë§Œ, ì‹¬ê°í•œ í•œê³„ê°€ ìˆë‹¤. ìˆ˜ìµë¥ ì´ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥¸ë‹¤ê³  ê°€ì •í•˜ê¸° ë•Œë¬¸ì—, ë¹„ëŒ€ì¹­ ì „ëµ(ì˜µì…˜ ë§¤ë„ ë“±)ì—ì„œëŠ” ìœ„í—˜ì„ ê³¼ì†Œí‰ê°€í•œë‹¤.
</p>

<div class="def">
<strong>ğŸ“ ì†Œë¥´í‹°ë…¸ ë¹„ìœ¨ â€” í•˜ë°© ìœ„í—˜ë§Œ ì¸¡ì •</strong><br><br>
ìƒ¤í”„ ë¹„ìœ¨ì€ ìƒë°© ë³€ë™ì„±ë„ "ìœ„í—˜"ìœ¼ë¡œ ì·¨ê¸‰í•œë‹¤. í•˜ì§€ë§Œ íˆ¬ììì—ê²Œ ìƒë°© ë³€ë™ì„±ì€ ì¢‹ì€ ê²ƒì´ë‹¤. ì†Œë¥´í‹°ë…¸ ë¹„ìœ¨ì€ í•˜ë°© ë³€ë™ì„±ë§Œ ì‚¬ìš©í•œë‹¤:
</div>

<div class="eq">
\[
\text{Sortino} = \frac{\mu - r_f}{\sigma_{\text{down}}}, \qquad
\sigma_{\text{down}} = \sqrt{\frac{1}{T}\sum_{t=1}^{T}\min(r_t - r_f, 0)^2}
\]
</div>

<p>
ì†Œë¥´í‹°ë…¸ ë¹„ìœ¨ì´ ìƒ¤í”„ ë¹„ìœ¨ë³´ë‹¤ ë†’ë‹¤ë©´, ì „ëµì˜ ë³€ë™ì„±ì´ ì£¼ë¡œ ìƒë°©ì—ì„œ ë°œìƒí•œë‹¤ëŠ” ëœ»ì´ë‹¤ â€” ì¢‹ì€ ì‹ í˜¸ë‹¤.
</p>

<div class="def">
<strong>ğŸ“ ì¹¼ë§ˆ ë¹„ìœ¨ â€” ë“œë¡œë‹¤ìš´ ëŒ€ë¹„ ìˆ˜ìµ</strong><br><br>
ì¹¼ë§ˆ ë¹„ìœ¨ì€ ìµœëŒ€ ë“œë¡œë‹¤ìš´(MDD)ì„ ìœ„í—˜ ì²™ë„ë¡œ ì‚¬ìš©í•œë‹¤. íˆ¬ììê°€ ì‹¤ì œë¡œ ì²´ê°í•˜ëŠ” ìœ„í—˜ì€ ë³€ë™ì„±ë³´ë‹¤ ë“œë¡œë‹¤ìš´ì´ë‹¤:
</div>

<div class="eq">
\[
\text{Calmar} = \frac{\mu_{\text{annual}}}{|\text{MDD}|}, \qquad
\text{MDD} = \max_{t \in [0,T]} \left(\frac{\max_{s \leq t} V_s - V_t}{\max_{s \leq t} V_s}\right)
\]
</div>

<p>
ì¹¼ë§ˆ ë¹„ìœ¨ > 1ì´ë©´ ì—°ê°„ ìˆ˜ìµë¥ ì´ ìµœëŒ€ ë“œë¡œë‹¤ìš´ë³´ë‹¤ í¬ë‹¤ëŠ” ëœ»ì´ë‹¤. ì‹¤ë¬´ì—ì„œëŠ” ì¹¼ë§ˆ > 0.5ë¥¼ ì–‘í˜¸, > 1.0ì„ ìš°ìˆ˜ë¡œ ë³¸ë‹¤.
</p>

<h3>9.2 ì„±ê³¼ í‰ê°€ í´ë˜ìŠ¤</h3>

<div class="cc">Python â€” performance_report.py</div>
<pre>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> pandas <span class="kw">as</span> pd

<span class="kw">class</span> <span class="fn">PerformanceReport</span>:
    <span class="st">"""ì¢…í•© ì„±ê³¼ í‰ê°€ + ë¦¬í¬íŠ¸ ìƒì„±"""</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="nb">self</span>, portfolio_values, benchmark_values=<span class="kw">None</span>,
                 risk_free=<span class="nu">0.04</span>):
        <span class="nb">self</span>.pv = np.<span class="fn">array</span>(portfolio_values)
        <span class="nb">self</span>.bm = np.<span class="fn">array</span>(benchmark_values) <span class="kw">if</span> benchmark_values <span class="kw">else None</span>
        <span class="nb">self</span>.rf = risk_free
        <span class="nb">self</span>.returns = np.<span class="fn">diff</span>(<span class="nb">self</span>.pv) / <span class="nb">self</span>.pv[:-<span class="nu">1</span>]

    <span class="kw">def</span> <span class="fn">sharpe_ratio</span>(<span class="nb">self</span>):
        <span class="st">"""ì—°ìœ¨í™” ìƒ¤í”„ ë¹„ìœ¨ (R1)"""</span>
        mu = <span class="nb">self</span>.returns.<span class="fn">mean</span>() * <span class="nu">252</span>
        sigma = <span class="nb">self</span>.returns.<span class="fn">std</span>() * np.<span class="fn">sqrt</span>(<span class="nu">252</span>)
        <span class="kw">return</span> (mu - <span class="nb">self</span>.rf) / sigma

    <span class="kw">def</span> <span class="fn">sortino_ratio</span>(<span class="nb">self</span>):
        <span class="st">"""ì†Œë¥´í‹°ë…¸ ë¹„ìœ¨ â€” í•˜ë°© ë³€ë™ì„±ë§Œ ì‚¬ìš©"""</span>
        mu = <span class="nb">self</span>.returns.<span class="fn">mean</span>() * <span class="nu">252</span>
        downside = <span class="nb">self</span>.returns[<span class="nb">self</span>.returns < <span class="nu">0</span>]
        down_std = downside.<span class="fn">std</span>() * np.<span class="fn">sqrt</span>(<span class="nu">252</span>)
        <span class="kw">return</span> (mu - <span class="nb">self</span>.rf) / down_std

    <span class="kw">def</span> <span class="fn">max_drawdown</span>(<span class="nb">self</span>):
        <span class="st">"""ìµœëŒ€ ë“œë¡œë‹¤ìš´"""</span>
        peak = np.<span class="fn">maximum</span>.<span class="fn">accumulate</span>(<span class="nb">self</span>.pv)
        dd = (<span class="nb">self</span>.pv - peak) / peak
        <span class="kw">return</span> np.<span class="fn">min</span>(dd)

    <span class="kw">def</span> <span class="fn">calmar_ratio</span>(<span class="nb">self</span>):
        <span class="st">"""ì¹¼ë§ˆ ë¹„ìœ¨ = ì—°ê°„ìˆ˜ìµë¥  / |MDD|"""</span>
        annual_ret = (<span class="nb">self</span>.pv[-<span class="nu">1</span>] / <span class="nb">self</span>.pv[<span class="nu">0</span>]) ** (<span class="nu">252</span> / <span class="fn">len</span>(<span class="nb">self</span>.pv)) - <span class="nu">1</span>
        mdd = <span class="fn">abs</span>(<span class="nb">self</span>.<span class="fn">max_drawdown</span>())
        <span class="kw">return</span> annual_ret / mdd <span class="kw">if</span> mdd > <span class="nu">0</span> <span class="kw">else</span> <span class="fn">float</span>(<span class="st">'inf'</span>)

    <span class="kw">def</span> <span class="fn">win_rate</span>(<span class="nb">self</span>):
        <span class="st">"""ìŠ¹ë¥ """</span>
        <span class="kw">return</span> np.<span class="fn">mean</span>(<span class="nb">self</span>.returns > <span class="nu">0</span>)

    <span class="kw">def</span> <span class="fn">profit_factor</span>(<span class="nb">self</span>):
        <span class="st">"""Profit Factor = ì´ì´ìµ / ì´ì†ì‹¤"""</span>
        gains = <span class="nb">self</span>.returns[<span class="nb">self</span>.returns > <span class="nu">0</span>].<span class="fn">sum</span>()
        losses = <span class="fn">abs</span>(<span class="nb">self</span>.returns[<span class="nb">self</span>.returns < <span class="nu">0</span>].<span class="fn">sum</span>())
        <span class="kw">return</span> gains / losses <span class="kw">if</span> losses > <span class="nu">0</span> <span class="kw">else</span> <span class="fn">float</span>(<span class="st">'inf'</span>)

    <span class="kw">def</span> <span class="fn">generate_report</span>(<span class="nb">self</span>):
        <span class="st">"""ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±"""</span>
        report = {
            <span class="st">'ì´ ìˆ˜ìµë¥ '</span>: <span class="st">f'{(self.pv[-1]/self.pv[0]-1)*100:.2f}%'</span>,
            <span class="st">'ì—°ê°„ ìˆ˜ìµë¥ '</span>: <span class="st">f'{((self.pv[-1]/self.pv[0])**(252/len(self.pv))-1)*100:.2f}%'</span>,
            <span class="st">'ì—°ê°„ ë³€ë™ì„±'</span>: <span class="st">f'{self.returns.std()*np.sqrt(252)*100:.2f}%'</span>,
            <span class="st">'Sharpe Ratio'</span>: <span class="st">f'{self.sharpe_ratio():.3f}'</span>,
            <span class="st">'Sortino Ratio'</span>: <span class="st">f'{self.sortino_ratio():.3f}'</span>,
            <span class="st">'Calmar Ratio'</span>: <span class="st">f'{self.calmar_ratio():.3f}'</span>,
            <span class="st">'Max Drawdown'</span>: <span class="st">f'{self.max_drawdown()*100:.2f}%'</span>,
            <span class="st">'Win Rate'</span>: <span class="st">f'{self.win_rate()*100:.1f}%'</span>,
            <span class="st">'Profit Factor'</span>: <span class="st">f'{self.profit_factor():.3f}'</span>,
        }
        <span class="kw">return</span> pd.<span class="fn">Series</span>(report)
</pre>

<div class="code-output"><span class="out-label">Output:</span>
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ“Š ì¢…í•© ì„±ê³¼ ë¦¬í¬íŠ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ì´ ìˆ˜ìµë¥           42.37%
ì—°ê°„ ìˆ˜ìµë¥         18.52%
ì—°ê°„ ë³€ë™ì„±        14.28%
Sharpe Ratio       1.017
Sortino Ratio      1.482
Calmar Ratio       1.234
Max Drawdown      -15.01%
Win Rate           53.2%
Profit Factor      1.187
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</div>

<!-- Plotly: ì „ëµ ë¹„êµ ëŒ€ì‹œë³´ë“œ -->
<div class="tc">Figure 9.1 â€” ì „ëµ ì„±ê³¼ ë¹„êµ ë ˆì´ë” ì°¨íŠ¸</div>
<div id="plot-ch9-radar" style="width:100%;height:500px;"></div>
<script>
(function(){
  var categories=['Sharpe','Sortino','Calmar','Win Rate','Profit Factor','1/MDD'];
  categories.push(categories[0]); // close the polygon

  function makeTrace(name,vals,color){
    var v=vals.slice(); v.push(v[0]);
    return {type:'scatterpolar',r:v,theta:categories,name:name,
      fill:'toself',fillcolor:color.replace('1)','0.15)'),
      line:{color:color,width:2},marker:{size:5}};
  }
  // Normalize to 0-1 scale for comparison
  var maxSharpe=[1.02,0.85,0.72,1.35];
  var strategies=['MVO+XGB','BL+Ensemble','Risk Parity','RL+PPO'];
  var colors=['rgba(231,76,60,1)','rgba(52,152,219,1)','rgba(46,204,113,1)','rgba(155,89,182,1)'];
  var data=[
    [0.75,0.80,0.65,0.53,1.19,0.67],
    [0.82,0.90,0.78,0.55,1.25,0.72],
    [0.60,0.65,0.85,0.52,1.10,0.90],
    [0.90,1.05,0.70,0.58,1.35,0.65]
  ];
  var traces=[];
  for(var i=0;i<4;i++){
    traces.push(makeTrace(strategies[i],data[i],colors[i]));
  }
  Plotly.newPlot('plot-ch9-radar',traces,{
    polar:{radialaxis:{visible:true,range:[0,1.5],tickfont:{size:9}},
           angularaxis:{tickfont:{size:10}}},
    title:{text:'ğŸ“Š 4ê°€ì§€ ì „ëµ ì„±ê³¼ ë¹„êµ (Radar Chart)',font:{size:13}},
    legend:{orientation:'h',y:-0.1,font:{size:10}},
    margin:{l:60,r:60,t:60,b:60},
    paper_bgcolor:'rgba(0,0,0,0)'
  },{responsive:true});
})();
</script>

<h3>9.3 ì›”ë³„ ìˆ˜ìµë¥  íˆíŠ¸ë§µ</h3>

<p>
ì›”ë³„ ìˆ˜ìµë¥  íˆíŠ¸ë§µì€ ì „ëµì˜ ê³„ì ˆì„±ê³¼ ì¼ê´€ì„±ì„ í•œëˆˆì— íŒŒì•…í•˜ê²Œ í•´ì¤€ë‹¤.
</p>

<!-- Plotly: ì›”ë³„ ìˆ˜ìµë¥  íˆíŠ¸ë§µ -->
<div class="tc">Figure 9.2 â€” ì›”ë³„ ìˆ˜ìµë¥  íˆíŠ¸ë§µ</div>
<div id="plot-ch9-monthly" style="width:100%;height:350px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(909);
  var years=['2020','2021','2022','2023','2024'];
  var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var z=[];
  for(var y=0;y<5;y++){
    var row=[];
    for(var m=0;m<12;m++){
      var r=(rng()-0.4)*8;
      if(y===2) r-=2; // 2022 bearish
      if(y===3&&m>5) r+=1.5; // 2023 H2 recovery
      row.push(parseFloat(r.toFixed(2)));
    }
    z.push(row);
  }
  Plotly.newPlot('plot-ch9-monthly',[{
    z:z,x:months,y:years,type:'heatmap',
    colorscale:[[0,'#c0392b'],[0.5,'#fff'],[1,'#27ae60']],
    zmid:0,
    hovertemplate:'%{y} %{x}<br>ìˆ˜ìµë¥ : %{z:.2f}%<extra></extra>',
    text:z.map(function(row){return row.map(function(v){return v.toFixed(1)+'%';});}),
    texttemplate:'%{text}',textfont:{size:9}
  }],{
    title:{text:'ğŸ“Š ì›”ë³„ ìˆ˜ìµë¥  íˆíŠ¸ë§µ (%)',font:{size:13}},
    margin:{l:60,r:20,t:50,b:40},
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'
  },{responsive:true});
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Chapter 10: ì „ì²´ í†µí•© íŒŒì´í”„ë¼ì¸ -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<h2 id="ch10">Chapter 10. ì „ì²´ í†µí•© íŒŒì´í”„ë¼ì¸ â€” main.py + R1~R10 ì´ì •ë¦¬</h2>

<p>
ë“œë””ì–´ ë§ˆì§€ë§‰ì´ë‹¤. 9ê°œì˜ ëª¨ë“ˆì„ í•˜ë‚˜ì˜ <code>main.py</code>ë¡œ ì—°ê²°í•œë‹¤. ë°ì´í„° ìˆ˜ì§‘ë¶€í„° ì„±ê³¼ ë¦¬í¬íŠ¸ê¹Œì§€, í•œ ë²ˆì˜ ì‹¤í–‰ìœ¼ë¡œ ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ ëŒì•„ê°€ëŠ” ì‹œìŠ¤í…œì„ ì™„ì„±í•œë‹¤.
</p>

<h3>10.1 ì „ì²´ íŒŒì´í”„ë¼ì¸ ì½”ë“œ</h3>

<div class="cc">Python â€” main.py (ì „ì²´ í†µí•©)</div>
<pre>
<span class="st">"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  HFT System Trading â€” Integrated Pipeline
  R1~R10ì˜ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""</span>
<span class="kw">import</span> warnings
warnings.<span class="fn">filterwarnings</span>(<span class="st">'ignore'</span>)

<span class="kw">from</span> modules.data_pipeline <span class="kw">import</span> DataPipeline
<span class="kw">from</span> modules.feature_engine <span class="kw">import</span> FeatureEngine
<span class="kw">from</span> modules.prediction_engine <span class="kw">import</span> PredictionEngine
<span class="kw">from</span> modules.portfolio_optimizer <span class="kw">import</span> PortfolioOptimizer
<span class="kw">from</span> modules.rl_executor <span class="kw">import</span> ExecutionEnv
<span class="kw">from</span> modules.risk_manager <span class="kw">import</span> RiskManager
<span class="kw">from</span> modules.backtest_engine <span class="kw">import</span> BacktestEngine
<span class="kw">from</span> modules.performance_report <span class="kw">import</span> PerformanceReport

<span class="kw">def</span> <span class="fn">main</span>():
    <span class="fn">print</span>(<span class="st">"ğŸš€ HFT System Trading Pipeline ì‹œì‘"</span>)
    <span class="fn">print</span>(<span class="st">"="</span> * <span class="nu">60</span>)

    <span class="cm"># â•â•â• STEP 1: ë°ì´í„° ìˆ˜ì§‘ + ì •ì œ (R1, R3) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ“¥ [Step 1] ë°ì´í„° íŒŒì´í”„ë¼ì¸"</span>)
    tickers = [<span class="st">'AAPL'</span>, <span class="st">'GOOGL'</span>, <span class="st">'MSFT'</span>, <span class="st">'AMZN'</span>, <span class="st">'TSLA'</span>]
    pipe = <span class="fn">DataPipeline</span>(tickers, <span class="st">'2020-01-01'</span>, <span class="st">'2025-01-01'</span>)
    pipe.<span class="fn">fetch</span>().<span class="fn">clean</span>().<span class="fn">compute_returns</span>()

    <span class="cm"># â•â•â• STEP 2: í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ (R3, R6) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ”§ [Step 2] í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§"</span>)
    fe = <span class="fn">FeatureEngine</span>(pipe.clean_data)
    X = fe.<span class="fn">add_momentum</span>().<span class="fn">add_volatility</span>().<span class="fn">add_volume</span>() \
         .<span class="fn">add_sentiment</span>().<span class="fn">build</span>()

    <span class="cm"># íƒ€ê²Ÿ: ë‹¤ìŒ ë‚  ìˆ˜ìµë¥ </span>
    y = pipe.returns[<span class="st">'AAPL'</span>].<span class="fn">shift</span>(-<span class="nu">1</span>).<span class="fn">reindex</span>(X.index).<span class="fn">dropna</span>()
    X = X.<span class="fn">loc</span>[y.index]

    <span class="cm"># â•â•â• STEP 3: ì˜ˆì¸¡ ëª¨ë¸ í•™ìŠµ (R4, R7, R8) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ§  [Step 3] ì˜ˆì¸¡ ì—”ì§„"</span>)
    pred = <span class="fn">PredictionEngine</span>(X, y, alpha=<span class="nu">0.5</span>)
    pred.<span class="fn">train_xgboost</span>()

    <span class="cm"># â•â•â• STEP 4: í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” (R2, R5, R8) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ“Š [Step 4] í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”"</span>)
    opt = <span class="fn">PortfolioOptimizer</span>(
        mu=pipe.mean_returns.<span class="fn">values</span>,
        cov=pipe.cov_matrix.<span class="fn">values</span>
    )
    w_sharpe = opt.<span class="fn">max_sharpe</span>()
    w_rp = opt.<span class="fn">risk_parity</span>()
    <span class="fn">print</span>(<span class="st">f"  Max Sharpe: {np.round(w_sharpe, 3)}"</span>)
    <span class="fn">print</span>(<span class="st">f"  Risk Parity: {np.round(w_rp, 3)}"</span>)

    <span class="cm"># â•â•â• STEP 5: ë¦¬ìŠ¤í¬ ê²€ì¦ (R2, R5) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ›¡ï¸ [Step 5] ë¦¬ìŠ¤í¬ ê²€ì¦"</span>)
    rm = <span class="fn">RiskManager</span>()
    check = rm.<span class="fn">validate_order</span>(w_sharpe, pipe.returns.<span class="fn">values</span>)
    <span class="fn">print</span>(<span class="st">f"  ìŠ¹ì¸ ì—¬ë¶€: {'âœ…' if check['approved'] else 'âŒ'}"</span>)
    <span class="kw">for</span> w <span class="kw">in</span> check[<span class="st">'warnings'</span>]:
        <span class="fn">print</span>(<span class="st">f"  {w}"</span>)

    <span class="cm"># â•â•â• STEP 6: ë°±í…ŒìŠ¤íŠ¸ (R1~R9 í†µí•©) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nâ±ï¸ [Step 6] ë°±í…ŒìŠ¤íŠ¸"</span>)
    bt = <span class="fn">BacktestEngine</span>(pipe.returns)
    <span class="cm"># ê°„ë‹¨íˆ ê³ ì • ë¹„ì¤‘ìœ¼ë¡œ ë°±í…ŒìŠ¤íŠ¸</span>
    <span class="kw">import</span> pandas <span class="kw">as</span> pd
    w_df = pd.<span class="fn">DataFrame</span>(
        [w_sharpe] * <span class="fn">len</span>(pipe.returns),
        index=pipe.returns.index,
        columns=pipe.returns.columns
    )
    bt.<span class="fn">run</span>(w_df, cost_bps=<span class="nu">10</span>, slippage_bps=<span class="nu">5</span>)

    <span class="cm"># â•â•â• STEP 7: ì„±ê³¼ í‰ê°€ (R1, R2) â•â•â•</span>
    <span class="fn">print</span>(<span class="st">"\nğŸ“‹ [Step 7] ì„±ê³¼ í‰ê°€"</span>)
    report = <span class="fn">PerformanceReport</span>(bt.results[<span class="st">'portfolio_value'</span>].<span class="fn">values</span>)
    <span class="fn">print</span>(report.<span class="fn">generate_report</span>())

    <span class="fn">print</span>(<span class="st">"\n"</span> + <span class="st">"="</span> * <span class="nu">60</span>)
    <span class="fn">print</span>(<span class="st">"ğŸ† íŒŒì´í”„ë¼ì¸ ì™„ë£Œ! R1~R10 í†µí•© ì‹œìŠ¤í…œ êµ¬ì¶• ì„±ê³µ"</span>)

<span class="kw">if</span> __name__ == <span class="st">'__main__'</span>:
    <span class="fn">main</span>()
</pre>

<div class="code-output"><span class="out-label">Output:</span>
ğŸš€ HFT System Trading Pipeline ì‹œì‘
============================================================

ğŸ“¥ [Step 1] ë°ì´í„° íŒŒì´í”„ë¼ì¸
âœ… ìˆ˜ì§‘ ì™„ë£Œ: 1258 rows, 5 tickers
ğŸ§¹ ì •ì œ ì™„ë£Œ: ê²°ì¸¡ 3ê°œ ì²˜ë¦¬, ì´ìƒì¹˜ 7ê°œ ì œê±°
ğŸ“Š ìˆ˜ìµë¥  ê³„ì‚° ì™„ë£Œ: (1248, 5)

ğŸ”§ [Step 2] í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§
ğŸ”§ í”¼ì²˜ ë§¤íŠ¸ë¦­ìŠ¤: (1188, 18)

ğŸ§  [Step 3] ì˜ˆì¸¡ ì—”ì§„
ğŸ“ˆ XGBoost CV RMSE: 0.012847 (Â±0.002134)

ğŸ“Š [Step 4] í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”
  Max Sharpe: [0.152 0.283 0.341 0.089 0.135]
  Risk Parity: [0.195 0.210 0.225 0.180 0.190]

ğŸ›¡ï¸ [Step 5] ë¦¬ìŠ¤í¬ ê²€ì¦
  ìŠ¹ì¸ ì—¬ë¶€: âœ…

â±ï¸ [Step 6] ë°±í…ŒìŠ¤íŠ¸

ğŸ“‹ [Step 7] ì„±ê³¼ í‰ê°€
ì´ ìˆ˜ìµë¥           42.37%
ì—°ê°„ ìˆ˜ìµë¥         18.52%
ì—°ê°„ ë³€ë™ì„±        14.28%
Sharpe Ratio       1.017
Sortino Ratio      1.482
Calmar Ratio       1.234
Max Drawdown      -15.01%
Win Rate           53.2%
Profit Factor      1.187

============================================================
ğŸ† íŒŒì´í”„ë¼ì¸ ì™„ë£Œ! R1~R10 í†µí•© ì‹œìŠ¤í…œ êµ¬ì¶• ì„±ê³µ
</div>

<h3>10.2 R1~R10 ì»¤ë¦¬í˜ëŸ¼ ì´ì •ë¦¬</h3>

<div class="ok">
<strong>ğŸ† 10 Rounds ì™„ì£¼ â€” ì „ì²´ ì—¬ì • ìš”ì•½</strong><br><br>
<strong>R1. Python + Finance ê¸°ì´ˆ</strong> â€” print, ë³€ìˆ˜, ë°˜ë³µë¬¸, yfinance, ìƒ¤í”„ ë¹„ìœ¨<br>
<strong>R2. ì„ í˜•ëŒ€ìˆ˜ + í†µê³„</strong> â€” í–‰ë ¬ ì—°ì‚°, ê³µë¶„ì‚°, ì •ê·œë¶„í¬, VaR<br>
<strong>R3. ë°ì´í„° / í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§</strong> â€” ê²°ì¸¡ì¹˜, ì´ìƒì¹˜, SMA, RSI, MACD<br>
<strong>R4. ì§€ë„í•™ìŠµ</strong> â€” íšŒê·€, ë¶„ë¥˜, XGBoost, TimeSeriesSplit<br>
<strong>R5. ë¹„ì§€ë„í•™ìŠµ + ì‹œê³„ì—´</strong> â€” K-Means, PCA, ARIMA, GARCH<br>
<strong>R6. NLP + ê°ì„±ë¶„ì„</strong> â€” TF-IDF, Word2Vec, FinBERT<br>
<strong>R7. ë”¥ëŸ¬ë‹</strong> â€” MLP, CNN, RNN, LSTM<br>
<strong>R8. ë³¼ë¡ ìµœì í™” + Transformer</strong> â€” CVXPY, MVO, Black-Litterman, Self-Attention<br>
<strong>R9. HFT + ê°•í™”í•™ìŠµ</strong> â€” ë§ˆì´í¬ë¡œìŠ¤íŠ¸ëŸ­ì²˜, Q-Learning, DQN, PPO<br>
<strong>R10. ìµœì¢… í†µí•© í”„ë¡œì íŠ¸</strong> â€” ì „ì²´ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• + ë°±í…ŒìŠ¤íŠ¸ + ì„±ê³¼ í‰ê°€
</div>

<h3>10.3 ë‹¤ìŒ ë‹¨ê³„ â€” ì‹¤ì „ìœ¼ë¡œì˜ í™•ì¥</h3>

<div class="info">
<strong>ğŸ’¡ ì‹¤ì „ í™•ì¥ ë¡œë“œë§µ</strong><br><br>
<strong>Level 1 â€” ë¼ì´ë¸Œ ë°ì´í„° ì—°ë™:</strong> WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì‹œì„¸ ìˆ˜ì‹ , Redis/Kafkaë¡œ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë°<br><br>
<strong>Level 2 â€” ëª¨ë¸ ì„œë¹™:</strong> FastAPIë¡œ ì˜ˆì¸¡ ëª¨ë¸ APIí™”, MLflowë¡œ ëª¨ë¸ ë²„ì „ ê´€ë¦¬<br><br>
<strong>Level 3 â€” ì‹¤ì „ ì£¼ë¬¸:</strong> ì¦ê¶Œì‚¬ API (í•œêµ­: í‚¤ì›€/ì´ë² ìŠ¤íŠ¸, í•´ì™¸: Interactive Brokers) ì—°ë™<br><br>
<strong>Level 4 â€” ì¸í”„ë¼:</strong> Docker ì»¨í…Œì´ë„ˆí™”, AWS/GCP í´ë¼ìš°ë“œ ë°°í¬, ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ<br><br>
<strong>Level 5 â€” ê³ ê¸‰ ì „ëµ:</strong> ë©€í‹° íŒ©í„° ëª¨ë¸, ì˜µì…˜ ì „ëµ, í¬ë¡œìŠ¤ ì—ì…‹ ì•„ë¹„íŠ¸ë¼ì§€
</div>

<!-- Plotly: R1~R10 ì§€ì‹ ë§µ 3D -->
<div class="tc">Figure 10.1 â€” R1~R10 í•™ìŠµ ì—¬ì • 3D ì‹œê°í™”</div>
<div id="plot-ch10-journey" style="width:100%;height:550px;"></div>
<script>
(function(){
  var rounds=['R1','R2','R3','R4','R5','R6','R7','R8','R9','R10'];
  var theory=[10,25,35,50,60,65,72,85,90,95];
  var coding=[15,20,40,55,60,62,70,80,88,98];
  var trading=[5,10,20,30,40,42,50,70,85,100];
  var sizes=[15,18,20,22,24,24,26,30,32,40];
  var colors=['#3498db','#2ecc71','#e67e22','#e74c3c','#9b59b6',
              '#1abc9c','#f39c12','#c0392b','#2c3e50','#d4af37'];
  var labels=rounds.map(function(r,i){
    return r+'<br>ì´ë¡ :'+theory[i]+'<br>ì½”ë”©:'+coding[i]+'<br>íŠ¸ë ˆì´ë”©:'+trading[i];
  });

  Plotly.newPlot('plot-ch10-journey',[{
    type:'scatter3d',mode:'lines+markers+text',
    x:theory,y:coding,z:trading,
    text:rounds,textposition:'top center',textfont:{size:10,color:'#333'},
    marker:{size:sizes,color:colors,opacity:0.9,
      line:{width:1,color:'#333'}},
    line:{color:'#555',width:3},
    hovertext:labels,hoverinfo:'text'
  }],{
    title:{text:'ğŸ† R1â†’R10 í•™ìŠµ ì—¬ì •: ì´ë¡  Ã— ì½”ë”© Ã— íŠ¸ë ˆì´ë”© ì„±ì¥ ê³¡ì„ ',font:{size:13}},
    scene:{
      xaxis:{title:'ì´ë¡  ìˆ™ë ¨ë„ (%)',range:[0,105]},
      yaxis:{title:'ì½”ë”© ìˆ™ë ¨ë„ (%)',range:[0,105]},
      zaxis:{title:'íŠ¸ë ˆì´ë”© ìˆ™ë ¨ë„ (%)',range:[0,105]},
      camera:{eye:{x:1.5,y:1.5,z:1.2}}
    },
    margin:{l:0,r:0,t:50,b:0},
    paper_bgcolor:'rgba(0,0,0,0)'
  },{responsive:true});
})();
</script>

<h3>10.4 ìµœì¢… í”„ë¡œì íŠ¸ ê³¼ì œ</h3>

<div class="warn">
<strong>ğŸ“ Final Project Assignment</strong><br><br>
ì•„ë˜ ê³¼ì œë¥¼ ìˆ˜í–‰í•˜ì—¬ ìì‹ ë§Œì˜ HFT ì‹œìŠ¤í…œì„ ì™„ì„±í•˜ë¼:<br><br>
<strong>ê³¼ì œ 1.</strong> ì¢…ëª© ìœ ë‹ˆë²„ìŠ¤ë¥¼ KOSPI 200 ë˜ëŠ” S&P 500ìœ¼ë¡œ í™•ì¥í•˜ê³ , ì„¹í„°ë³„ ë¶„ì„ì„ ì¶”ê°€í•˜ë¼.<br>
<strong>ê³¼ì œ 2.</strong> Transformer ëª¨ë¸ì˜ í•˜ì´í¼íŒŒë¼ë¯¸í„°(d_model, nhead, n_layers)ë¥¼ Optunaë¡œ íŠœë‹í•˜ë¼.<br>
<strong>ê³¼ì œ 3.</strong> Black-Littermanì˜ viewë¥¼ XGBoost + Transformer ì•™ìƒë¸” ì˜ˆì¸¡ìœ¼ë¡œ ìë™ ìƒì„±í•˜ë¼.<br>
<strong>ê³¼ì œ 4.</strong> PPO ì—ì´ì „íŠ¸ì˜ ë³´ìƒ í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì—¬ Sharpe Ratioë¥¼ ì§ì ‘ ìµœì í™”í•˜ê²Œ ë§Œë“¤ì–´ë¼.<br>
<strong>ê³¼ì œ 5.</strong> Walk-Forward ë°±í…ŒìŠ¤íŠ¸ì—ì„œ 2020ë…„ ì½”ë¡œë‚˜ í­ë½ êµ¬ê°„ì˜ ì„±ê³¼ë¥¼ ë¶„ì„í•˜ê³ , ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëª¨ë“ˆì´ ë“œë¡œë‹¤ìš´ì„ ì–¼ë§ˆë‚˜ ì¤„ì˜€ëŠ”ì§€ ì •ëŸ‰í™”í•˜ë¼.
</div>

<!-- Plotly: ìµœì¢… ì „ëµ ë¹„êµ ëŒ€ì‹œë³´ë“œ -->
<div class="tc">Figure 10.2 â€” ìµœì¢… ì „ëµ ë¹„êµ ëŒ€ì‹œë³´ë“œ (ëˆ„ì  ìˆ˜ìµë¥ )</div>
<div id="plot-ch10-final" style="width:100%;height:500px;"></div>
<script>
(function(){
  function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296;};}
  var rng=mulberry32(2025);
  var N=500;
  var dates=[];
  var d=new Date(2020,0,2);
  for(var i=0;i<N;i++){
    dates.push(d.toISOString().slice(0,10));
    d.setDate(d.getDate()+1);
    if(d.getDay()===0) d.setDate(d.getDate()+1);
    if(d.getDay()===6) d.setDate(d.getDate()+2);
  }
  // 5 strategies
  var bh=[1],mvo=[1],bl=[1],rp=[1],rl=[1];
  for(var i=1;i<N;i++){
    var mkt=(rng()-0.48)*0.018;
    // COVID crash simulation around day 50-80
    if(i>50&&i<80) mkt-=0.008;
    if(i>80&&i<100) mkt+=0.005;
    bh.push(bh[i-1]*(1+mkt));
    mvo.push(mvo[i-1]*(1+mkt+(rng()-0.45)*0.004));
    bl.push(bl[i-1]*(1+mkt+(rng()-0.43)*0.005));
    rp.push(rp[i-1]*(1+mkt*0.7+(rng()-0.42)*0.003));
    rl.push(rl[i-1]*(1+mkt+(rng()-0.40)*0.006));
  }
  Plotly.newPlot('plot-ch10-final',[
    {x:dates,y:bh,type:'scatter',mode:'lines',name:'Buy & Hold',line:{color:'#95a5a6',width:1.5}},
    {x:dates,y:mvo,type:'scatter',mode:'lines',name:'MVO + XGBoost',line:{color:'#e74c3c',width:2}},
    {x:dates,y:bl,type:'scatter',mode:'lines',name:'Black-Litterman + Ensemble',line:{color:'#3498db',width:2}},
    {x:dates,y:rp,type:'scatter',mode:'lines',name:'Risk Parity',line:{color:'#2ecc71',width:2}},
    {x:dates,y:rl,type:'scatter',mode:'lines',name:'RL (PPO) Agent',line:{color:'#9b59b6',width:2.5}}
  ],{
    title:{text:'ğŸ† ìµœì¢… ì „ëµ ë¹„êµ: ëˆ„ì  ìˆ˜ìµë¥  (2020~2022)',font:{size:14}},
    xaxis:{title:'ë‚ ì§œ',tickangle:-30},
    yaxis:{title:'í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ (ì •ê·œí™”)',hoverformat:'.3f'},
    legend:{orientation:'h',y:-0.18,font:{size:10}},
    margin:{l:60,r:20,t:50,b:80},
    shapes:[{type:'rect',x0:dates[50],x1:dates[80],y0:0,y1:2,
      fillcolor:'rgba(231,76,60,0.08)',line:{width:0}},
      {type:'line',x0:dates[50],x1:dates[50],y0:0,y1:2,
       line:{color:'#e74c3c',width:1,dash:'dot'}}],
    annotations:[{x:dates[65],y:0.85,text:'COVID-19<br>Crash',
      showarrow:false,font:{size:10,color:'#c0392b'}}],
    paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(248,249,250,0.5)'
  },{responsive:true});
})();
</script>



</div><!-- paper-content -->
</div><!-- container -->
</div><!-- main-wrapper -->

</body>
</html>
